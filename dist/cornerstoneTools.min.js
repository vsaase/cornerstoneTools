/*! cornerstone-tools - 4.0.1 - 2021-04-12 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/cornerstoneTools */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("cornerstone-tools",[],t):"object"==typeof exports?exports["cornerstone-tools"]=t():e.cornerstoneTools=t()}(window,(function(){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=101)}([function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}e.exports=function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}},function(e,t,n){var a=n(9),r=n(5);e.exports=function(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?r(e):t}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var a=n(67);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t,n){var a=n(68),r=n(69),o=n(70);e.exports=function(e){return a(e)||r(e)||o()}},function(e,t){e.exports={Text:"Text",Binary:"Binary",Image:"Image",Mesh:"Mesh",vtkPolyData:"vtkPolyData"}},function(e,t,n){var a=n(72),r=n(73),o=n(74);e.exports=function(e,t){return a(e)||r(e,t)||o()}},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=a=function(e){return n(e)}:e.exports=a=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},a(t)}e.exports=a},function(e,t){e.exports=function(e){var t=e.slice(2+(e.lastIndexOf(".")-1>>>0));if("gz"===t.toLowerCase()){var n=e.slice(0,-3).lastIndexOf(".");t=e.slice(2+(n-1>>>0))}return t}},function(e,t){function n(e,t){if(!(e instanceof Blob))throw new TypeError("Must be a File or Blob");return new Promise((function(n,a){var r=new FileReader;r.onload=function(e){n(e.target.result)},r.onerror=function(t){a(new Error("Error reading"+e.name+": "+t.target.result))},r["readAs"+t](e)}))}e.exports={readAsDataURL:function(e){return n(e,"DataURL")},readAsText:function(e){return n(e,"Text")},readAsArrayBuffer:function(e){return n(e,"ArrayBuffer")}}},function(e,t,n){"use strict";var a=n(36),r=Object.prototype.toString;function o(e){return"[object Array]"===r.call(e)}function i(e){return void 0===e}function s(e){return null!==e&&"object"==typeof e}function l(e){if("[object Object]"!==r.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function c(e){return"[object Function]"===r.call(e)}function u(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),o(e))for(var n=0,a=e.length;n<a;n++)t.call(null,e[n],n,e);else for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.call(null,e[r],r,e)}e.exports={isArray:o,isArrayBuffer:function(e){return"[object ArrayBuffer]"===r.call(e)},isBuffer:function(e){return null!==e&&!i(e)&&null!==e.constructor&&!i(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:s,isPlainObject:l,isUndefined:i,isDate:function(e){return"[object Date]"===r.call(e)},isFile:function(e){return"[object File]"===r.call(e)},isBlob:function(e){return"[object Blob]"===r.call(e)},isFunction:c,isStream:function(e){return s(e)&&c(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:u,merge:function e(){var t={};function n(n,a){l(t[a])&&l(n)?t[a]=e(t[a],n):l(n)?t[a]=e({},n):o(n)?t[a]=n.slice():t[a]=n}for(var a=0,r=arguments.length;a<r;a++)u(arguments[a],n);return t},extend:function(e,t,n){return u(t,(function(t,r){e[r]=n&&"function"==typeof t?a(t,n):t})),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},function(e,t){e.exports={Int8:"int8_t",UInt8:"uint8_t",Int16:"int16_t",UInt16:"uint16_t",Int32:"int32_t",UInt32:"uint32_t",Int64:"int64_t",UInt64:"uint64_t",SizeValueType:"uint64_t",IdentifierType:"uint64_t",IndexValueType:"int64_t",OffsetValueType:"int64_t"}},function(e,t){var n=new Map([["gen","VTKExodusFileReader"],["e","VTKExodusFileReader"],["exo","VTKExodusFileReader"],["exii","VTKExodusFileReader"],["ex2","VTKExodusFileReader"],["vtk","VTKLegacyFileReader"],["VTK","VTKLegacyFileReader"],["vtp","VTKXMLFileReader"],["VTP","VTKXMLFileReader"],["vtu","VTKXMLFileReader"],["VTU","VTKXMLFileReader"],["vtr","VTKXMLFileReader"],["VTR","VTKXMLFileReader"],["ply","VTKPLYFileReader"],["PLY","VTKPLYFileReader"]]);e.exports=n},function(e,t,n){e.exports=n(24)},function(e,t){e.exports={Unknown:0,Scalar:1,RGB:2,RGBA:3,Offset:4,Vector:5,Point:6,CovariantVector:7,SymmetricSecondRankTensor:8,DiffusionTensor3D:9,Complex:10,FixedArray:11,Array:12,Matrix:13,VariableLengthVector:14,VariableSizeMatrix:15}},function(e,t){var n=new Map([["vtk","itkVTKPolyDataMeshIOJSBinding"],["VTK","itkVTKPolyDataMeshIOJSBinding"],["byu","itkBYUMeshIOJSBinding"],["BYU","itkBYUMeshIOJSBinding"],["fsa","itkFreeSurferAsciiMeshIOJSBinding"],["FSA","itkFreeSurferAsciiMeshIOJSBinding"],["fsb","itkFreeSurferBinaryMeshIOJSBinding"],["FSB","itkFreeSurferBinaryMeshIOJSBinding"],["obj","itkOBJMeshIOJSBinding"],["OBJ","itkOBJMeshIOJSBinding"],["off","itkOFFMeshIOJSBinding"],["OFF","itkOFFMeshIOJSBinding"],["stl","itkSTLMeshIOJSBinding"],["STL","itkSTLMeshIOJSBinding"]]);e.exports=n},function(e,t){function n(e,t,n,a,r,o,i){try{var s=e[o](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(a,r)}e.exports=function(e){return function(){var t=this,a=arguments;return new Promise((function(r,o){var i=e.apply(t,a);function s(e){n(i,r,o,s,l,"next",e)}function l(e){n(i,r,o,s,l,"throw",e)}s(void 0)}))}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){var n=new Map([]);e.exports=n},function(e,t){e.exports={Float32:"float",Float64:"double",SpacePrecisionType:"double"}},function(e,t){var n=new Map([]);e.exports=n},function(e,t,n){e.exports=n(76)},function(e,t){function n(e,t){if(e instanceof n){var a=e;this.rows=a.rows,this.columns=a.columns,this.data=a.data.slice()}else this.rows=e,this.columns=t,this.data=new Array(e*t),this.data.fill(0)}n.prototype.setIdentity=function(){for(var e=0;e<this.rows;++e)for(var t=0;t<this.columns;++t)this.data[t+e*this.columns]=e===t?1:0},n.prototype.setElement=function(e,t,n){this.data[t+e*this.columns]=n},n.prototype.getElement=function(e,t){return this.data[t+e*this.columns]},e.exports=n},function(e,t,n){var a=function(e){"use strict";var t=Object.prototype,n=t.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",i=a.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function l(e,t,n,a){var r=t&&t.prototype instanceof d?t:d,o=Object.create(r.prototype),i=new w(a||[]);return o._invoke=function(e,t,n){var a="suspendedStart";return function(r,o){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===r)throw o;return E()}for(n.method=r,n.arg=o;;){var i=n.delegate;if(i){var s=T(i,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===a)throw a="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a="executing";var l=c(e,t,n);if("normal"===l.type){if(a=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(a="completed",n.method="throw",n.arg=l.arg)}}}(e,n,i),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function d(){}function h(){}function f(){}var v={};v[r]=function(){return this};var g=Object.getPrototypeOf,p=g&&g(g(C([])));p&&p!==t&&n.call(p,r)&&(v=p);var m=f.prototype=d.prototype=Object.create(v);function y(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){var a;this._invoke=function(r,o){function i(){return new t((function(a,i){!function a(r,o,i,s){var l=c(e[r],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){a("next",e,i,s)}),(function(e){a("throw",e,i,s)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return a("throw",e,i,s)}))}s(l.arg)}(r,o,a,i)}))}return a=a?a.then(i,i):i()}}function T(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var a=c(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,u;var r=a.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function C(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,o=function t(){for(;++a<e.length;)if(n.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:E}}function E(){return{value:void 0,done:!0}}return h.prototype=m.constructor=f,f.constructor=h,h.displayName=s(f,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},y(x.prototype),x.prototype[o]=function(){return this},e.AsyncIterator=x,e.async=function(t,n,a,r,o){void 0===o&&(o=Promise);var i=new x(l(t,n,a,r),o);return e.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},y(m),s(m,i,"Generator"),m[r]=function(){return this},m.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var a=t.pop();if(a in e)return n.value=a,n.done=!1,n}return n.done=!0,n}},e.values=C,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function a(n,a){return i.type="throw",i.arg=e,t.next=n,a&&(t.method="next",t.arg=void 0),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],i=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(s&&l){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(e,t){for(var a=this.tryEntries.length-1;a>=0;--a){var r=this.tryEntries[a];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var r=a.arg;I(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=a}catch(e){Function("r","regeneratorRuntime = r")(a)}},function(e,t,n){var a=n(29),r=n(23);e.exports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new a;this.imageType=e,this.name="Image";var t=e.dimension;this.origin=new Array(t),this.origin.fill(0),this.spacing=new Array(t),this.spacing.fill(1),this.direction=new r(t,t),this.direction.setIdentity(),this.size=new Array(t),this.size.fill(0),this.data=null}},function(e,t,n){"use strict";(function(e){var a=n(45),r={formatArgs:function(e){if(e[0]="".concat((this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" "),"+").concat(o.humanize(this.diff)),!this.useColors)return;var t="color: ".concat(this.color);e.splice(1,0,t,"color: inherit");var n=0,a=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(n++,"%c"===e&&(a=n))})),e.splice(a,0,t)},save:function(e){try{e?r.storage.setItem("debug",e):r.storage.removeItem("debug")}catch(e){}},load:function(){var t;try{t=r.storage.getItem("debug")}catch(e){}!t&&void 0!==e&&"env"in e&&(t=e.env.DEBUG);return t},useColors:function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},storage:function(){try{return localStorage}catch(e){}}()};r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],r.log=console.debug||console.log||function(){};var o=Object(a.a)(r);o.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: ".concat(e.message)}},t.a=o}).call(this,n(35))},function(e,t,n){"use strict";var a=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{!a&&s.return&&s.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var i=n(75),s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._messageId=1,n._messages=new Map,n._worker=e,n._worker.onmessage=n._onMessage.bind(n),n._id=Math.ceil(1e7*Math.random()),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"terminate",value:function(){this._worker.terminate()}},{key:"isFree",value:function(){return 0===this._messages.size}},{key:"jobsLength",value:function(){return this._messages.size}},{key:"exec",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments[3];return new Promise((function(o,i){var s=n._messageId++;n._messages.set(s,[o,i,r]),n._worker.postMessage([s,t,e],a||[])}))}},{key:"postMessage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments[2];return new Promise((function(r,o){var i=t._messageId++;t._messages.set(i,[r,o,a]),t._worker.postMessage([i,e],n||[])}))}},{key:"emit",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];this._worker.postMessage({eventName:e,args:n})}},{key:"_onMessage",value:function(e){var n;if(!Array.isArray(e.data)&&e.data.eventName)return(n=function e(t,n,a){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,a)}if("value"in r)return r.value;var i=r.get;return void 0!==i?i.call(a):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"emit",this)).call.apply(n,[this,e.data.eventName].concat(o(e.data.args)));var a,r=(a=e.data,Array.isArray(a)?a:Array.from(a)),i=r[0],s=r.slice(1);if(1===i)this._onEvent.apply(this,o(s));else{if(0!==i)throw new Error("Wrong message type '"+i+"'");this._onResult.apply(this,o(s))}}},{key:"_onResult",value:function(e,t,n){var r=this._messages.get(e),o=a(r,2),i=o[0],s=o[1];return this._messages.delete(e),1===t?i(n):s(n)}},{key:"_onEvent",value:function(e,t,n){var r=this._messages.get(e),o=a(r,3)[2];o&&o(t,n)}}]),t}(i);e.exports=s},function(e,t,n){var a=n(25),r=n(23);e.exports=function(e){var t=new a(e.imageType);t.name=e.name;var n=e.imageType.dimension;return t.origin=Array.from(e.origin),t.spacing=Array.from(e.spacing),t.direction=new r(n,n),t.direction.data=Array.from(e.direction.data),t.size=Array.from(e.size),t.data=new e.data.constructor(e.data.length),t.data.set(e.data,0),t}},function(e,t,n){var a=n(13),r=n(16);e.exports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.UInt8,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.Scalar,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.dimension=e,this.componentType=t,this.pixelType=n,this.components=o}},function(e,t,n){var a=n(13),r=n(20),o=n(16);e.exports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.Float32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.Float32,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.Scalar,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:a.Int32,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:r.Float32,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:o.Scalar,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1;this.dimension=e,this.pointComponentType=t,this.pointPixelComponentType=n,this.pointPixelType=i,this.pointPixelComponents=s,this.cellComponentType=l,this.cellPixelComponentType=c,this.cellPixelType=u,this.cellPixelComponents=d}},function(e,t,n){var a=n(13),r=n(20);e.exports=function(e,t){var n=null;switch(e){case a.UInt8:n=new Uint8Array(t);break;case a.Int8:n=new Int8Array(t);break;case a.UInt16:n=new Uint16Array(t);break;case a.Int16:n=new Int16Array(t);break;case a.UInt32:n=new Uint32Array(t);break;case a.Int32:n=new Int32Array(t);break;case a.UInt64:throw new BigUint64Array(t);case a.Int64:throw new BigInt64Array(t);case r.Float32:n=new Float32Array(t);break;case r.Float64:n=new Float64Array(t);break;case"null":case null:n=null;break;default:throw new Error("Type is not supported as a TypedArray")}return n}},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){var a=n(94),r=n(95),o=n(96),i=n(97);e.exports=function(e){return a(e)||r(e)||o(e)||i()},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){e.exports=n(99)},function(e,t){var n,a,r=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{a="function"==typeof clearTimeout?clearTimeout:i}catch(e){a=i}}();var l,c=[],u=!1,d=-1;function h(){u&&l&&(u=!1,l.length?c=l.concat(c):d=-1,c.length&&f())}function f(){if(!u){var e=s(h);u=!0;for(var t=c.length;t;){for(l=c,c=[];++d<t;)l&&l[d].run();d=-1,t=c.length}l=null,u=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===i||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function v(e,t){this.fun=e,this.array=t}function g(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new v(e,t)),1!==c.length||u||s(f)},v.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,n){"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),a=0;a<n.length;a++)n[a]=arguments[a];return e.apply(t,n)}}},function(e,t,n){"use strict";var a=n(12);function r(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var o;if(n)o=n(t);else if(a.isURLSearchParams(t))o=t.toString();else{var i=[];a.forEach(t,(function(e,t){null!=e&&(a.isArray(e)?t+="[]":e=[e],a.forEach(e,(function(e){a.isDate(e)?e=e.toISOString():a.isObject(e)&&(e=JSON.stringify(e)),i.push(r(t)+"="+r(e))})))})),o=i.join("&")}if(o){var s=e.indexOf("#");-1!==s&&(e=e.slice(0,s)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}},function(e,t,n){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,n){"use strict";(function(t){var a=n(12),r=n(81),o={"Content-Type":"application/x-www-form-urlencoded"};function i(e,t){!a.isUndefined(e)&&a.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var s,l={adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==t&&"[object process]"===Object.prototype.toString.call(t))&&(s=n(40)),s),transformRequest:[function(e,t){return r(t,"Accept"),r(t,"Content-Type"),a.isFormData(e)||a.isArrayBuffer(e)||a.isBuffer(e)||a.isStream(e)||a.isFile(e)||a.isBlob(e)?e:a.isArrayBufferView(e)?e.buffer:a.isURLSearchParams(e)?(i(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):a.isObject(e)?(i(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300}};l.headers={common:{Accept:"application/json, text/plain, */*"}},a.forEach(["delete","get","head"],(function(e){l.headers[e]={}})),a.forEach(["post","put","patch"],(function(e){l.headers[e]=a.merge(o)})),e.exports=l}).call(this,n(35))},function(e,t,n){"use strict";var a=n(12),r=n(82),o=n(84),i=n(37),s=n(85),l=n(88),c=n(89),u=n(41);e.exports=function(e){return new Promise((function(t,n){var d=e.data,h=e.headers;a.isFormData(d)&&delete h["Content-Type"];var f=new XMLHttpRequest;if(e.auth){var v=e.auth.username||"",g=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";h.Authorization="Basic "+btoa(v+":"+g)}var p=s(e.baseURL,e.url);if(f.open(e.method.toUpperCase(),i(p,e.params,e.paramsSerializer),!0),f.timeout=e.timeout,f.onreadystatechange=function(){if(f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))){var a="getAllResponseHeaders"in f?l(f.getAllResponseHeaders()):null,o={data:e.responseType&&"text"!==e.responseType?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:a,config:e,request:f};r(t,n,o),f=null}},f.onabort=function(){f&&(n(u("Request aborted",e,"ECONNABORTED",f)),f=null)},f.onerror=function(){n(u("Network Error",e,null,f)),f=null},f.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(u(t,e,"ECONNABORTED",f)),f=null},a.isStandardBrowserEnv()){var m=(e.withCredentials||c(p))&&e.xsrfCookieName?o.read(e.xsrfCookieName):void 0;m&&(h[e.xsrfHeaderName]=m)}if("setRequestHeader"in f&&a.forEach(h,(function(e,t){void 0===d&&"content-type"===t.toLowerCase()?delete h[t]:f.setRequestHeader(t,e)})),a.isUndefined(e.withCredentials)||(f.withCredentials=!!e.withCredentials),e.responseType)try{f.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&f.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&f.upload&&f.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){f&&(f.abort(),n(e),f=null)})),d||(d=null),f.send(d)}))}},function(e,t,n){"use strict";var a=n(83);e.exports=function(e,t,n,r,o){var i=new Error(e);return a(i,t,n,r,o)}},function(e,t,n){"use strict";var a=n(12);e.exports=function(e,t){t=t||{};var n={},r=["url","method","data"],o=["headers","auth","proxy","params"],i=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],s=["validateStatus"];function l(e,t){return a.isPlainObject(e)&&a.isPlainObject(t)?a.merge(e,t):a.isPlainObject(t)?a.merge({},t):a.isArray(t)?t.slice():t}function c(r){a.isUndefined(t[r])?a.isUndefined(e[r])||(n[r]=l(void 0,e[r])):n[r]=l(e[r],t[r])}a.forEach(r,(function(e){a.isUndefined(t[e])||(n[e]=l(void 0,t[e]))})),a.forEach(o,c),a.forEach(i,(function(r){a.isUndefined(t[r])?a.isUndefined(e[r])||(n[r]=l(void 0,e[r])):n[r]=l(void 0,t[r])})),a.forEach(s,(function(a){a in t?n[a]=l(e[a],t[a]):a in e&&(n[a]=l(void 0,e[a]))}));var u=r.concat(o).concat(i).concat(s),d=Object.keys(e).concat(Object.keys(t)).filter((function(e){return-1===u.indexOf(e)}));return a.forEach(d,c),n}},function(e,t,n){"use strict";function a(e){this.message=e}a.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},a.prototype.__CANCEL__=!0,e.exports=a},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){"use strict";var a=n(6),r=n.n(a);t.a=function(e){function t(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return a.colors[Math.abs(t)%a.colors.length]}function a(e){var n;function r(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];if(r.enabled){var i=r,s=Number(new Date),l=s-(n||s);i.diff=l,i.prev=n,i.curr=s,n=s,t[0]=a.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var c=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(function(e,n){if("%%"===e)return e;c++;var r=a.formatters[n];if("function"==typeof r){var o=t[c];e=r.call(i,o),t.splice(c,1),c--}return e})),a.formatArgs.call(i,t);var u=i.log||a.log;u.apply(i,t)}}return r.namespace=e,r.enabled=a.enabled(e),r.useColors=a.useColors(),r.color=t(e),r.destroy=o,r.extend=i,"function"==typeof a.init&&a.init(r),a.instances.push(r),r}function o(){var e=a.instances.indexOf(this);return-1!==e&&(a.instances.splice(e,1),!0)}function i(e,t){var n=a(this.namespace+(void 0===t?":":t)+e);return n.log=this.log,n}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return a.debug=a,a.default=a,a.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},a.disable=function(){var e=[].concat(r()(a.names.map(s)),r()(a.skips.map(s).map((function(e){return"-".concat(e)})))).join(",");return a.enable(""),e},a.enable=function(e){var t;a.save(e),a.names=[],a.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length;for(t=0;t<r;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?a.skips.push(new RegExp("^".concat(e.substr(1),"$"))):a.names.push(new RegExp("^".concat(e,"$"))));for(t=0;t<a.instances.length;t++){var o=a.instances[t];o.enabled=a.enabled(o.namespace)}},a.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=a.skips.length;t<n;t++)if(a.skips[t].test(e))return!1;for(t=0,n=a.names.length;t<n;t++)if(a.names[t].test(e))return!0;return!1},a.humanize=n(71),Object.keys(e).forEach((function(t){a[t]=e[t]})),a.instances=[],a.names=[],a.skips=[],a.formatters={},a.selectColor=t,a.enable(a.load()),a}},function(e,t){var n=new Map([["bmp","itkBMPImageIOJSBinding"],["BMP","itkBMPImageIOJSBinding"],["dcm","itkGDCMImageIOJSBinding"],["DCM","itkGDCMImageIOJSBinding"],["gipl","itkGiplImageIOJSBinding"],["gipl.gz","itkGiplImageIOJSBinding"],["hdf5","itkHDF5ImageIOJSBinding"],["jpg","itkJPEGImageIOJSBinding"],["JPG","itkJPEGImageIOJSBinding"],["jpeg","itkJPEGImageIOJSBinding"],["JPEG","itkJPEGImageIOJSBinding"],["json","itkJSONImageIOJSBinding"],["lsm","itkLSMImageIOJSBinding"],["mnc","itkMINCImageIOJSBinding"],["MNC","itkMINCImageIOJSBinding"],["mnc.gz","itkMINCImageIOJSBinding"],["MNC.GZ","itkMINCImageIOJSBinding"],["mnc2","itkMINCImageIOJSBinding"],["MNC2","itkMINCImageIOJSBinding"],["mgh","itkMGHImageIOJSBinding"],["mgz","itkMGHImageIOJSBinding"],["mgh.gz","itkMGHImageIOJSBinding"],["mha","itkMetaImageIOJSBinding"],["mhd","itkMetaImageIOJSBinding"],["mrc","itkMRCImageIOJSBinding"],["nia","itkNiftiImageIOJSBinding"],["nii","itkNiftiImageIOJSBinding"],["nii.gz","itkNiftiImageIOJSBinding"],["hdr","itkNiftiImageIOJSBinding"],["nrrd","itkNrrdImageIOJSBinding"],["NRRD","itkNrrdImageIOJSBinding"],["nhdr","itkNrrdImageIOJSBinding"],["NHDR","itkNrrdImageIOJSBinding"],["png","itkPNGImageIOJSBinding"],["PNG","itkPNGImageIOJSBinding"],["pic","itkBioRadImageIOJSBinding"],["PIC","itkBioRadImageIOJSBinding"],["tif","itkTIFFImageIOJSBinding"],["TIF","itkTIFFImageIOJSBinding"],["tiff","itkTIFFImageIOJSBinding"],["TIFF","itkTIFFImageIOJSBinding"],["vtk","itkVTKImageIOJSBinding"],["VTK","itkVTKImageIOJSBinding"],["isq","itkScancoImageIOJSBinding"],["ISQ","itkScancoImageIOJSBinding"],["fdf","itkFDFImageIOJSBinding"],["FDF","itkFDFImageIOJSBinding"]]);e.exports=n},function(e,t){e.exports=function(e,t,n){return e.data[n+t*e.columns]}},function(e,t,n){var a=n(13),r=n(20);e.exports=function(e,t){var n=null;switch(t){case e.IOComponentType.UCHAR:n=a.UInt8;break;case e.IOComponentType.CHAR:n=a.Int8;break;case e.IOComponentType.USHORT:n=a.UInt16;break;case e.IOComponentType.SHORT:n=a.Int16;break;case e.IOComponentType.UINT:n=a.UInt32;break;case e.IOComponentType.INT:n=a.Int32;break;case e.IOComponentType.ULONG:n=a.UInt64;break;case e.IOComponentType.LONG:n=a.Int64;break;case e.IOComponentType.ULONGLONG:n=a.UInt64;break;case e.IOComponentType.LONGLONG:n=a.Int64;break;case e.IOComponentType.FLOAT:n=r.Float32;break;case e.IOComponentType.DOUBLE:n=r.Float64;break;default:throw new Error("Unknown IO component type")}return n}},function(e,t){e.exports=["itkPNGImageIOJSBinding","itkMetaImageIOJSBinding","itkDCMTKImageIOJSBinding","itkTIFFImageIOJSBinding","itkNiftiImageIOJSBinding","itkJPEGImageIOJSBinding","itkNrrdImageIOJSBinding","itkVTKImageIOJSBinding","itkBMPImageIOJSBinding","itkHDF5ImageIOJSBinding","itkMINCImageIOJSBinding","itkMRCImageIOJSBinding","itkLSMImageIOJSBinding","itkMGHImageIOJSBinding","itkBioRadImageIOJSBinding","itkGiplImageIOJSBinding","itkGEAdwImageIOJSBinding","itkGE4ImageIOJSBinding","itkGE5ImageIOJSBinding","itkGDCMImageIOJSBinding","itkScancoImageIOJSBinding","itkFDFImageIOJSBinding","itkJSONImageIOJSBinding"]},function(e,t,n){var a=n(16);e.exports=function(e,t){var n=null;switch(t){case e.IOPixelType.UNKNOWNPIXELTYPE:n=a.Unknown;break;case e.IOPixelType.SCALAR:n=a.Scalar;break;case e.IOPixelType.RGB:n=a.RGB;break;case e.IOPixelType.RGBA:n=a.RGBA;break;case e.IOPixelType.OFFSET:n=a.Offset;break;case e.IOPixelType.VECTOR:n=a.Vector;break;case e.IOPixelType.POINT:n=a.Point;break;case e.IOPixelType.COVARIANTVECTOR:n=a.CovariantVector;break;case e.IOPixelType.SYMMETRICSECONDRANKTENSOR:n=a.SymmetricSecondRankTensor;break;case e.IOPixelType.DIFFUSIONTENSOR3D:n=a.DiffusionTensor3D;break;case e.IOPixelType.COMPLEX:n=a.Complex;break;case e.IOPixelType.FIXEDARRAY:n=a.FixedArray;break;case e.IOPixelType.MATRIX:n=a.Matrix;break;default:throw new Error("Unknown IO pixel type")}return n}},function(e,t,n){var a=n(13),r=n(20);e.exports=function(e,t){var n=null;switch(t){case a.UInt8:n=e.IOComponentType.UCHAR;break;case a.Int8:n=e.IOComponentType.CHAR;break;case a.UInt16:n=e.IOComponentType.USHORT;break;case a.Int16:n=e.IOComponentType.SHORT;break;case a.UInt32:n=e.IOComponentType.UINT;break;case a.Int32:n=e.IOComponentType.INT;break;case a.UInt64:n=e.IOComponentType.ULONGLONG;break;case a.Int64:n=e.IOComponentType.LONGLONG;break;case r.Float32:n=e.IOComponentType.FLOAT;break;case r.Float64:n=e.IOComponentType.DOUBLE;break;default:throw new Error("Unknown IO component type")}return n}},function(e,t,n){var a=n(16);e.exports=function(e,t){var n=null;switch(t){case a.Unknown:n=e.IOPixelType.UNKNOWNPIXELTYPE;break;case a.Scalar:n=e.IOPixelType.SCALAR;break;case a.RGB:n=e.IOPixelType.RGB;break;case a.RGBA:n=e.IOPixelType.RGBA;break;case a.Offset:n=e.IOPixelType.OFFSET;break;case a.Vector:n=e.IOPixelType.VECTOR;break;case a.Point:n=e.IOPixelType.POINT;break;case a.CovariantVector:n=e.IOPixelType.COVARIANTVECTOR;break;case a.SymmetricSecondRankTensor:n=e.IOPixelType.SYMMETRICSECONDRANKTENSOR;break;case a.DiffusionTensor3D:n=e.IOPixelType.DIFFUSIONTENSOR3D;break;case a.Complex:n=e.IOPixelType.COMPLEX;break;case a.FixedArray:n=e.IOPixelType.FIXEDARRAY;break;case a.Matrix:n=e.IOPixelType.MATRIX;break;default:throw new Error("Unknown IO pixel type")}return n}},function(e,t,n){var a=n(13),r=n(20);e.exports=function(e,t){var n=null;switch(t){case e.IOComponentType.UNKNOWNCOMPONENTTYPE:n=null;break;case e.IOComponentType.UCHAR:n=a.UInt8;break;case e.IOComponentType.CHAR:n=a.Int8;break;case e.IOComponentType.USHORT:n=a.UInt16;break;case e.IOComponentType.SHORT:n=a.Int16;break;case e.IOComponentType.UINT:n=a.UInt32;break;case e.IOComponentType.INT:n=a.Int32;break;case e.IOComponentType.ULONG:n=a.UInt64;break;case e.IOComponentType.LONG:n=a.Int64;break;case e.IOComponentType.ULONGLONG:n=a.UInt64;break;case e.IOComponentType.LONGLONG:n=a.Int64;break;case e.IOComponentType.FLOAT:n=r.Float32;break;case e.IOComponentType.DOUBLE:n=r.Float64;break;default:throw new Error("Unknown IO component type")}return n}},function(e,t){e.exports=["itkBYUMeshIOJSBinding","itkFreeSurferAsciiMeshIOJSBinding","itkFreeSurferBinaryMeshIOJSBinding","itkOBJMeshIOJSBinding","itkOFFMeshIOJSBinding","itkSTLMeshIOJSBinding","itkVTKPolyDataMeshIOJSBinding"]},function(e,t,n){var a=n(16);e.exports=function(e,t){var n=null;switch(t){case e.IOPixelType.UNKNOWNPIXELTYPE:n=a.Unknown;break;case e.IOPixelType.SCALAR:n=a.Scalar;break;case e.IOPixelType.RGB:n=a.RGB;break;case e.IOPixelType.RGBA:n=a.RGBA;break;case e.IOPixelType.OFFSET:n=a.Offset;break;case e.IOPixelType.VECTOR:n=a.Vector;break;case e.IOPixelType.POINT:n=a.Point;break;case e.IOPixelType.COVARIANTVECTOR:n=a.CovariantVector;break;case e.IOPixelType.SYMMETRICSECONDRANKTENSOR:n=a.SymmetricSecondRankTensor;break;case e.IOPixelType.DIFFUSIONTENSOR3D:n=a.DiffusionTensor3D;break;case e.IOPixelType.COMPLEX:n=a.Complex;break;case e.IOPixelType.FIXEDARRAY:n=a.FixedArray;break;case e.IOPixelType.ARRAY:n=a.Array;break;case e.IOPixelType.MATRIX:n=a.Matrix;break;case e.IOPixelType.VARIABLELENGTHVECTOR:n=a.VariableLengthVector;break;case e.IOPixelType.VARIABLESIZEMATRIX:n=a.VariableSizeMatrix;break;default:throw new Error("Unknown IO pixel type")}return n}},function(e,t,n){var a=n(30);e.exports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new a;this.meshType=e,this.name="Mesh",this.numberOfPoints=0,this.points=null,this.numberOfPointPixels=0,this.pointData=null,this.numberOfCells=0,this.cells=null,this.numberOfCellPixels=0,this.cellData=null,this.cellBufferSize=0}},function(e,t,n){var a=n(13),r=n(20);e.exports=function(e,t){var n=null;switch(t){case null:n=e.IOComponentType.UNKNOWNCOMPONENTTYPE;break;case a.UInt8:n=e.IOComponentType.UCHAR;break;case a.Int8:n=e.IOComponentType.CHAR;break;case a.UInt16:n=e.IOComponentType.USHORT;break;case a.Int16:n=e.IOComponentType.SHORT;break;case a.UInt32:n=e.IOComponentType.UINT;break;case a.Int32:n=e.IOComponentType.INT;break;case a.UInt64:n=e.IOComponentType.ULONGLONG;break;case a.Int64:n=e.IOComponentType.LONGLONG;break;case r.Float32:n=e.IOComponentType.FLOAT;break;case r.Float64:n=e.IOComponentType.DOUBLE;break;default:throw new Error("Unknown IO component type")}return n}},function(e,t,n){var a=n(16);e.exports=function(e,t){var n=null;switch(t){case a.Unknown:n=e.IOPixelType.UNKNOWNPIXELTYPE;break;case a.Scalar:n=e.IOPixelType.SCALAR;break;case a.RGB:n=e.IOPixelType.RGB;break;case a.RGBA:n=e.IOPixelType.RGBA;break;case a.Offset:n=e.IOPixelType.OFFSET;break;case a.Vector:n=e.IOPixelType.VECTOR;break;case a.Point:n=e.IOPixelType.POINT;break;case a.CovariantVector:n=e.IOPixelType.COVARIANTVECTOR;break;case a.SymmetricSecondRankTensor:n=e.IOPixelType.SYMMETRICSECONDRANKTENSOR;break;case a.DiffusionTensor3D:n=e.IOPixelType.DIFFUSIONTENSOR3D;break;case a.Complex:n=e.IOPixelType.COMPLEX;break;case a.FixedArray:n=e.IOPixelType.FIXEDARRAY;break;case a.Array:n=e.IOPixelType.ARRAY;break;case a.Matrix:n=e.IOPixelType.MATRIX;break;case a.VariableLengthVector:n=e.IOPixelType.VARIABLELENGTHVECTOR;break;case a.VariableSizeMatrix:n=e.IOPixelType.VARIABLESIZEMATRIX;break;default:throw new Error("Unknown IO pixel type")}return n}},function(e,t){var n=new Map([["image/jpeg","itkJPEGImageIOJSBinding"],["image/png","itkPNGImageIOJSBinding"],["image/tiff","itkTIFFImageIOJSBinding"],["image/x-ms-bmp","itkBMPImageIOJSBinding"],["image/x-bmp","itkBMPImageIOJSBinding"],["image/bmp","itkBMPImageIOJSBinding"],["application/dicom","itkGDCMImageIOJSBinding"]]);e.exports=n},function(e,t,n){var a=n(93);e.exports=function(e,t){if(null==e)return{};var n,r,o=a(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}e.exports=function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=n=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),n(t)}e.exports=n,e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){(function(t){var a=n(7),r=n(31),o=!1;o="undefined"!=typeof window?"function"==typeof window.SharedArrayBuffer:"function"==typeof t.SharedArrayBuffer;var i=function(e,n){return new("undefined"!=typeof window?window[e]:t[e])(n)},s=function(e,t){var n=e.open(t,"r"),a=e.stat(t).size,r=null;r=o?new SharedArrayBuffer(a):new ArrayBuffer(a);var i=new Uint8Array(r);return e.read(n,i,0,a,0),e.close(n),i};e.exports=function(e,t,n,o){o&&o.forEach((function(t){switch(t.type){case a.Text:case a.Binary:e.writeFile(t.path,t.data);break;case a.Image:var n={};for(var r in t.data)Object.prototype.hasOwnProperty.call(t.data,r)&&"data"!==r&&(n[r]=t.data[r]);n.data=t.path+".data",e.writeFile(t.path,JSON.stringify(n)),e.writeFile(n.data,new Uint8Array(t.data.data.buffer));break;case a.Mesh:var o={};for(var i in t.data)Object.prototype.hasOwnProperty.call(t.data,i)&&"points"!==i&&"pointData"!==i&&"cells"!==i&&"cellData"!==i&&(o[i]=t.data[i]);o.points=t.path+".points.data",o.pointData=t.path+".pointData.data",o.cells=t.path+".cells.data",o.cellData=t.path+".cellData.data",e.writeFile(t.path,JSON.stringify(o)),o.numberOfPoints&&e.writeFile(o.points,new Uint8Array(t.data.points.buffer)),o.numberOfPointPixels&&e.writeFile(o.pointData,new Uint8Array(t.data.pointData.buffer)),o.numberOfCells&&e.writeFile(o.cells,new Uint8Array(t.data.cells.buffer)),o.numberOfCellPixels&&e.writeFile(o.cellData,new Uint8Array(t.data.cellData.buffer));break;default:throw Error("Unsupported input IOType")}})),e.resetModuleStdout(),e.resetModuleStderr(),e.callMain(t);var l=e.getModuleStdout(),c=e.getModuleStderr(),u=[];return n&&n.forEach((function(t){var n={};switch(Object.assign(n,t),t.type){case a.Text:n.data=e.readFile(t.path,{encoding:"utf8"});break;case a.Binary:n.data=s(e,t.path);break;case a.Image:var o=e.readFile(t.path,{encoding:"utf8"}),l=JSON.parse(o),c=s(e,l.data);l.data=r(l.imageType.componentType,c.buffer),n.data=l;break;case a.Mesh:var d=e.readFile(t.path,{encoding:"utf8"}),h=JSON.parse(d);if(h.numberOfPoints){var f=s(e,h.points);h.points=r(h.meshType.pointComponentType,f.buffer)}else h.points=r(h.meshType.pointComponentType,new ArrayBuffer(0));if(h.numberOfPointPixels){var v=s(e,h.pointData);h.pointData=r(h.meshType.pointPixelComponentType,v.buffer)}else h.pointData=r(h.meshType.pointPixelComponentType,new ArrayBuffer(0));if(h.numberOfCells){var g=s(e,h.cells);h.cells=r(h.meshType.cellComponentType,g.buffer)}else h.cells=r(h.meshType.cellComponentType,new ArrayBuffer(0));if(h.numberOfCellPixels){var p=s(e,h.cellData);h.cellData=r(h.meshType.cellPixelComponentType,p.buffer)}else h.cellData=r(h.meshType.cellPixelComponentType,new ArrayBuffer(0));n.data=h;break;case a.vtkPolyData:var m=e.readFile("".concat(t.path,"/index.json"),{encoding:"utf8"}),y=JSON.parse(m);["points","verts","lines","polys","strips"].forEach((function(n){if(y[n]){var a=y[n];if(a.ref){var r=s(e,"".concat(t.path,"/").concat(a.ref.basepath,"/").concat(a.ref.id));y[n].buffer=r.buffer,y[n].values=i(y[n].dataType,r.buffer),delete a.ref}}}));["pointData","cellData","fieldData"].forEach((function(n){y[n]&&y[n].arrays.forEach((function(n){if(n.data.ref){var a=s(e,"".concat(t.path,"/").concat(n.data.ref.basepath,"/").concat(n.data.ref.id));n.data.buffer=a.buffer,n.data.values=i(n.data.dataType,a.buffer),delete n.data.ref}}))})),n.data=y;break;default:throw Error("Unsupported output IOType")}u.push(n)})),{stdout:l,stderr:c,outputs:u}}}).call(this,n(98))},function(e,t,n){var a=n(23);e.exports=function(e,t,n,r){var o=new a(e);return o.data[n+t*o.columns]=r,o}},function(e,t){function n(e,t,n,a,r,o,i){try{var s=e[o](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(a,r)}e.exports=function(e){return function(){var t=this,a=arguments;return new Promise((function(r,o){var i=e.apply(t,a);function s(e){n(i,r,o,s,l,"next",e)}function l(e){n(i,r,o,s,l,"throw",e)}s(void 0)}))}}},function(e,t){function n(t,a){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,a)}e.exports=n},function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(e,t){var n=1e3,a=6e4,r=60*a,o=24*r;function i(e,t,n,a){var r=t>=1.5*n;return Math.round(e/n)+" "+a+(r?"s":"")}e.exports=function(e,t){t=t||{};var s=typeof e;if("string"===s&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\-?\d?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var i=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*i;case"weeks":case"week":case"w":return 6048e5*i;case"days":case"day":case"d":return i*o;case"hours":case"hour":case"hrs":case"hr":case"h":return i*r;case"minutes":case"minute":case"mins":case"min":case"m":return i*a;case"seconds":case"second":case"secs":case"sec":case"s":return i*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}(e);if("number"===s&&!1===isNaN(e))return t.long?function(e){var t=Math.abs(e);if(t>=o)return i(e,t,o,"day");if(t>=r)return i(e,t,r,"hour");if(t>=a)return i(e,t,a,"minute");if(t>=n)return i(e,t,n,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=o)return Math.round(e/o)+"d";if(t>=r)return Math.round(e/r)+"h";if(t>=a)return Math.round(e/a)+"m";if(t>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{a||null==s.return||s.return()}finally{if(r)throw o}}return n}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){"use strict";var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperty(this,"__listeners",{value:{},enumerable:!1,writable:!1})}return a(e,[{key:"emit",value:function(e){if(!this.__listeners[e])return this;for(var t=arguments.length,n=Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var r=!0,o=!1,i=void 0;try{for(var s,l=this.__listeners[e][Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var c=s.value;c.apply(void 0,n)}}catch(e){o=!0,i=e}finally{try{!r&&l.return&&l.return()}finally{if(o)throw i}}return this}},{key:"once",value:function(e,t){var n=this,a=function a(){n.off(e,a),t.apply(void 0,arguments)};return this.on(e,a)}},{key:"on",value:function(e,t){return this.__listeners[e]||(this.__listeners[e]=[]),this.__listeners[e].push(t),this}},{key:"off",value:function(e,t){return this.__listeners[e]=t?this.__listeners[e].filter((function(e){return e!==t})):[],this}}]),e}();e.exports=r},function(e,t,n){"use strict";var a=n(12),r=n(36),o=n(77),i=n(42);function s(e){var t=new o(e),n=r(o.prototype.request,t);return a.extend(n,o.prototype,t),a.extend(n,t),n}var l=s(n(39));l.Axios=o,l.create=function(e){return s(i(l.defaults,e))},l.Cancel=n(43),l.CancelToken=n(90),l.isCancel=n(38),l.all=function(e){return Promise.all(e)},l.spread=n(91),l.isAxiosError=n(92),e.exports=l,e.exports.default=l},function(e,t,n){"use strict";var a=n(12),r=n(37),o=n(78),i=n(79),s=n(42);function l(e){this.defaults=e,this.interceptors={request:new o,response:new o}}l.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=s(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=[i,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach((function(e){t.unshift(e.fulfilled,e.rejected)})),this.interceptors.response.forEach((function(e){t.push(e.fulfilled,e.rejected)}));t.length;)n=n.then(t.shift(),t.shift());return n},l.prototype.getUri=function(e){return e=s(this.defaults,e),r(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},a.forEach(["delete","get","head","options"],(function(e){l.prototype[e]=function(t,n){return this.request(s(n||{},{method:e,url:t,data:(n||{}).data}))}})),a.forEach(["post","put","patch"],(function(e){l.prototype[e]=function(t,n,a){return this.request(s(a||{},{method:e,url:t,data:n}))}})),e.exports=l},function(e,t,n){"use strict";var a=n(12);function r(){this.handlers=[]}r.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},r.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},r.prototype.forEach=function(e){a.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=r},function(e,t,n){"use strict";var a=n(12),r=n(80),o=n(38),i=n(39);function s(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return s(e),e.headers=e.headers||{},e.data=r(e.data,e.headers,e.transformRequest),e.headers=a.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),a.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||i.adapter)(e).then((function(t){return s(e),t.data=r(t.data,t.headers,e.transformResponse),t}),(function(t){return o(t)||(s(e),t&&t.response&&(t.response.data=r(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},function(e,t,n){"use strict";var a=n(12);e.exports=function(e,t,n){return a.forEach(n,(function(n){e=n(e,t)})),e}},function(e,t,n){"use strict";var a=n(12);e.exports=function(e,t){a.forEach(e,(function(n,a){a!==t&&a.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[a])}))}},function(e,t,n){"use strict";var a=n(41);e.exports=function(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(a("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}},function(e,t,n){"use strict";e.exports=function(e,t,n,a,r){return e.config=t,n&&(e.code=n),e.request=a,e.response=r,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},function(e,t,n){"use strict";var a=n(12);e.exports=a.isStandardBrowserEnv()?{write:function(e,t,n,r,o,i){var s=[];s.push(e+"="+encodeURIComponent(t)),a.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),a.isString(r)&&s.push("path="+r),a.isString(o)&&s.push("domain="+o),!0===i&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,n){"use strict";var a=n(86),r=n(87);e.exports=function(e,t){return e&&!a(t)?r(e,t):t}},function(e,t,n){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,n){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,n){"use strict";var a=n(12),r=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,o,i={};return e?(a.forEach(e.split("\n"),(function(e){if(o=e.indexOf(":"),t=a.trim(e.substr(0,o)).toLowerCase(),n=a.trim(e.substr(o+1)),t){if(i[t]&&r.indexOf(t)>=0)return;i[t]="set-cookie"===t?(i[t]?i[t]:[]).concat([n]):i[t]?i[t]+", "+n:n}})),i):i}},function(e,t,n){"use strict";var a=n(12);e.exports=a.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){var a=e;return t&&(n.setAttribute("href",a),a=n.href),n.setAttribute("href",a),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){var n=a.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},function(e,t,n){"use strict";var a=n(43);function r(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new a(e),t(n.reason))}))}r.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},r.source=function(){var e;return{token:new r((function(t){e=t})),cancel:e}},e.exports=r},function(e,t,n){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},function(e,t,n){"use strict";e.exports=function(e){return"object"==typeof e&&!0===e.isAxiosError}},function(e,t){e.exports=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){var a=n(44);e.exports=function(e){if(Array.isArray(e))return a(e)},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){var a=n(44);e.exports=function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var a=function(){return this||"object"==typeof self&&self}()||Function("return this")(),r=a.regeneratorRuntime&&Object.getOwnPropertyNames(a).indexOf("regeneratorRuntime")>=0,o=r&&a.regeneratorRuntime;if(a.regeneratorRuntime=void 0,e.exports=n(100),r)a.regeneratorRuntime=o;else try{delete a.regeneratorRuntime}catch(e){a.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";var n=Object.prototype,a=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag",l="object"==typeof e,c=t.regeneratorRuntime;if(c)l&&(e.exports=c);else{(c=t.regeneratorRuntime=l?e.exports:{}).wrap=g;var u={},d={};d[o]=function(){return this};var h=Object.getPrototypeOf,f=h&&h(h(M([])));f&&f!==n&&a.call(f,o)&&(d=f);var v=x.prototype=m.prototype=Object.create(d);y.prototype=v.constructor=x,x.constructor=y,x[s]=y.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(v),e},c.awrap=function(e){return{__await:e}},T(b.prototype),b.prototype[i]=function(){return this},c.AsyncIterator=b,c.async=function(e,t,n,a){var r=new b(g(e,t,n,a));return c.isGeneratorFunction(t)?r:r.next().then((function(e){return e.done?e.value:r.next()}))},T(v),v[s]="Generator",v[o]=function(){return this},v.toString=function(){return"[object Generator]"},c.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var a=t.pop();if(a in e)return n.value=a,n.done=!1,n}return n.done=!0,n}},c.values=M,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,a){return i.type="throw",i.arg=e,t.next=n,a&&(t.method="next",t.arg=void 0),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],i=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=a.call(o,"catchLoc"),l=a.call(o,"finallyLoc");if(s&&l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var r=a.arg;C(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:M(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}}}function g(e,t,n,a){var r=t&&t.prototype instanceof m?t:m,o=Object.create(r.prototype),i=new E(a||[]);return o._invoke=function(e,t,n){var a="suspendedStart";return function(r,o){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===r)throw o;return k()}for(n.method=r,n.arg=o;;){var i=n.delegate;if(i){var s=I(i,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===a)throw a="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a="executing";var l=p(e,t,n);if("normal"===l.type){if(a=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(a="completed",n.method="throw",n.arg=l.arg)}}}(e,n,i),o}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function m(){}function y(){}function x(){}function T(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function b(e){var t;this._invoke=function(n,r){function o(){return new Promise((function(t,o){!function t(n,r,o,i){var s=p(e[n],e,r);if("throw"!==s.type){var l=s.arg,c=l.value;return c&&"object"==typeof c&&a.call(c,"__await")?Promise.resolve(c.__await).then((function(e){t("next",e,o,i)}),(function(e){t("throw",e,o,i)})):Promise.resolve(c).then((function(e){l.value=e,o(l)}),(function(e){return t("throw",e,o,i)}))}i(s.arg)}(n,r,t,o)}))}return t=t?t.then(o,o):o()}}function I(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,I(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var a=p(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,u;var r=a.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function M(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(a.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:k}}function k(){return{value:void 0,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"drawBrushPixels",(function(){return te})),n.d(a,"eraseIfSegmentIndex",(function(){return ee})),n.d(a,"eraseOutsideBoundingBox",(function(){return ne})),n.d(a,"eraseInsideShape",(function(){return se})),n.d(a,"eraseOutsideShape",(function(){return le})),n.d(a,"fillOutsideBoundingBox",(function(){return ce})),n.d(a,"fillInsideShape",(function(){return he})),n.d(a,"fillOutsideShape",(function(){return fe})),n.d(a,"floodFill",(function(){return ve})),n.d(a,"getBoundingBoxAroundCircle",(function(){return xe})),n.d(a,"getBoundingBoxAroundPolygon",(function(){return Te})),n.d(a,"getCircle",(function(){return be})),n.d(a,"getPixelPathBetweenPixels",(function(){return Ce})),n.d(a,"isSameSegment",(function(){return oe})),n.d(a,"triggerLabelmapModifiedEvent",(function(){return De})),n.d(a,"getDiffBetweenPixelData",(function(){return Le}));var r={};n.r(r),n.d(r,"angleCursor",(function(){return dr})),n.d(r,"arrowAnnotateCursor",(function(){return hr})),n.d(r,"bidirectionalCursor",(function(){return fr})),n.d(r,"cobbAngleCursor",(function(){return vr})),n.d(r,"circleRoiCursor",(function(){return gr})),n.d(r,"ellipticalRoiCursor",(function(){return pr})),n.d(r,"freehandRoiCursor",(function(){return mr})),n.d(r,"freehandRoiSculptorCursor",(function(){return yr})),n.d(r,"lengthCursor",(function(){return xr})),n.d(r,"probeCursor",(function(){return Tr})),n.d(r,"rectangleRoiCursor",(function(){return br})),n.d(r,"textMarkerCursor",(function(){return Ir})),n.d(r,"crosshairsCursor",(function(){return wr})),n.d(r,"eraserCursor",(function(){return Cr})),n.d(r,"magnifyCursor",(function(){return Er})),n.d(r,"panCursor",(function(){return Mr})),n.d(r,"rotateCursor",(function(){return kr})),n.d(r,"stackScrollCursor",(function(){return Sr})),n.d(r,"wwwcRegionCursor",(function(){return Or})),n.d(r,"wwwcCursor",(function(){return Pr})),n.d(r,"zoomCursor",(function(){return _r})),n.d(r,"freehandEraseInsideCursor",(function(){return Hr})),n.d(r,"freehandFillInsideCursor",(function(){return Nr})),n.d(r,"freehandEraseOutsideCursor",(function(){return Fr})),n.d(r,"freehandFillOutsideCursor",(function(){return Vr})),n.d(r,"segRectangleEraseInsideCursor",(function(){return jr})),n.d(r,"segRectangleFillInsideCursor",(function(){return qr})),n.d(r,"segRectangleEraseOutsideCursor",(function(){return zr})),n.d(r,"segRectangleFillOutsideCursor",(function(){return Gr})),n.d(r,"segCircleEraseInsideCursor",(function(){return Wr})),n.d(r,"segCircleFillInsideCursor",(function(){return Jr})),n.d(r,"segCircleEraseOutsideCursor",(function(){return Yr})),n.d(r,"segCircleFillOutsideCursor",(function(){return Kr}));var o=n(0),i=n.n(o),s=n(1),l=n.n(s),c=n(2),u=n.n(c),d=n(3),h=n.n(d),f=n(4),v=n.n(f),g=window.cornerstone,p=window.cornerstoneMath,m=window.Hammer,y={set cornerstone(e){g=e},get cornerstone(){return g},set cornerstoneMath(e){p=e},get cornerstoneMath(){return p},set Hammer(e){m=e},get Hammer(){return m}},x=n(9),T=n.n(x),b={MOUSE_DOWN:"cornerstonetoolsmousedown",MOUSE_UP:"cornerstonetoolsmouseup",MOUSE_DOWN_ACTIVATE:"cornerstonetoolsmousedownactivate",MOUSE_DRAG:"cornerstonetoolsmousedrag",MOUSE_MOVE:"cornerstonetoolsmousemove",MOUSE_CLICK:"cornerstonetoolsmouseclick",MOUSE_DOUBLE_CLICK:"cornerstonetoolsmousedoubleclick",MOUSE_WHEEL:"cornerstonetoolsmousewheel",TOUCH_START:"cornerstonetoolstouchstart",TOUCH_START_ACTIVE:"cornerstonetoolstouchstartactive",TOUCH_END:"cornerstonetoolstouchend",TOUCH_DRAG:"cornerstonetoolstouchdrag",TOUCH_DRAG_END:"cornerstonetoolstouchdragend",TOUCH_PINCH:"cornerstonetoolstouchpinch",TOUCH_ROTATE:"cornerstonetoolstouchrotate",TOUCH_PRESS:"cornerstonetoolstouchpress",TAP:"cornerstonetoolstap",DOUBLE_TAP:"cornerstonetoolsdoubletap",MULTI_TOUCH_START:"cornerstonetoolsmultitouchstart",MULTI_TOUCH_START_ACTIVE:"cornerstonetoolsmultitouchstartactive",MULTI_TOUCH_DRAG:"cornerstonetoolsmultitouchdrag",KEY_DOWN:"cornerstonetoolskeydown",KEY_UP:"cornerstonetoolskeyup",KEY_PRESS:"cornerstonetoolskeypress",MEASUREMENT_ADDED:"cornerstonetoolsmeasurementadded",MEASUREMENT_MODIFIED:"cornerstonetoolsmeasurementmodified",MEASUREMENT_COMPLETED:"cornerstonetoolsmeasurementcompleted",MEASUREMENT_REMOVED:"cornerstonetoolsmeasurementremoved",TOOL_DEACTIVATED:"cornerstonetoolstooldeactivated",CLIP_STOPPED:"cornerstonetoolsclipstopped",STACK_SCROLL:"cornerstonetoolsstackscroll",STACK_PREFETCH_IMAGE_LOADED:"cornerstonetoolsstackprefetchimageloaded",STACK_PREFETCH_DONE:"cornerstonetoolsstackprefetchdone",LABELMAP_MODIFIED:"cornersontetoolslabelmapmodified"};function I(e,t){var n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return"function"==typeof window.CustomEvent?n=new CustomEvent(t,{detail:a,cancelable:!0}):(n=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,a),e.dispatchEvent(n)}function w(e){return e instanceof HTMLElement?e:yt.enabledElementByUID(e)}var C={UINT_16_ARRAY:0,FLOAT_32_ARRAY:1},E=C.UINT_16_ARRAY,M=C.FLOAT_32_ARRAY;function k(e,t,n){var a,r=Tt("segmentation").configuration;switch(r.arrayType){case E:a=2;break;case M:a=4;break;default:throw new Error("Unsupported Array Type ".concat(r.arrayType))}e.labelmaps3D[t]={buffer:new ArrayBuffer(n*a),labelmaps2D:[],metadata:[],activeSegmentIndex:1,colorLUTIndex:0,segmentsHidden:[],undo:[],redo:[]}}function S(){var e={};function t(t,n,a){!1===e.hasOwnProperty(t)&&(e[t]={});var r=e[t];!1===r.hasOwnProperty(n)&&(r[n]={data:[]}),r[n].data.push(a)}function n(t,n){if(!1!==e.hasOwnProperty(t)){var a=e[t];if(!1!==a.hasOwnProperty(n))return a[n]}}function a(t){!1!==e.hasOwnProperty(t)&&delete e[t]}return{get:function(e,t){var a=y.cornerstone.getEnabledElement(e);if(a.image)return n(a.image.imageId,t)},add:function(e,n,a){var r=y.cornerstone.getEnabledElement(e);r.image&&t(r.image.imageId,n,a)},clear:function(e){var t=y.cornerstone.getEnabledElement(e);t.image&&a(t.image.imageId)},getImageIdToolState:n,addImageIdToolState:t,clearImageIdToolState:a,saveImageIdToolState:function(t){return e[t]},restoreImageIdToolState:function(t,n){e[t]=n},saveToolState:function(){return e},restoreToolState:function(t){e=t},toolState:e}}var O=S();function P(e){var t=y.cornerstone.getEnabledElement(e);return void 0===t.toolStateManager&&(t.toolStateManager=O),t.toolStateManager}function _(e,t,n){var a=P(e);n.uuid=n.uuid||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),a.add(e,t,n),I(e,b.MEASUREMENT_ADDED,{toolName:t,toolType:t,element:e,measurementData:n})}function D(e,t){return P(e).get(e,t)}function L(e,t,n){var a=P(e).get(e,t);if(a&&a.data&&a.data.length){for(var r=-1,o=0;o<a.data.length;o++)a.data[o]===n&&(r=o);if(-1!==r)a.data.splice(r,1),I(e,b.MEASUREMENT_REMOVED,{toolName:t,toolType:t,element:e,measurementData:n})}}function A(e,t){var n=P(e).get(e,t);void 0!==n&&(n.data=[])}function R(e,t){y.cornerstone.getEnabledElement(e).toolStateManager=t}var U=n(26),B=Object(U.a)("cornerstoneTools");var H=function(e){var t=B.extend(e);return{log:t,warn:t,error:void 0}},N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"".concat("cornerstoneTools",":*");return U.a.enable(e)},F=function(){return U.a.disable()},V={series:{},colorLutTables:[]},j=H("store:modules:segmentationModule:metadata");function q(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"increase",n=Tt("segmentation"),a=n.configuration,r=D(e,"stack"),o=r.data[0],i=o.imageIds[0],s=V.series[i];if(s){var l=s.activeLabelmapIndex,c=s.labelmaps3D[l];switch(t){case"increase":c.activeSegmentIndex++,c.activeSegmentIndex>a.segmentsPerLabelmap&&(c.activeSegmentIndex=1);break;case"decrease":c.activeSegmentIndex--,c.activeSegmentIndex<=0&&(c.activeSegmentIndex=a.segmentsPerLabelmap)}}}var z=H("store:modules:segmentationModule:segmentVisibility");var G=H("store:modules:segmentationModule:getLabelmaps3D");function W(e){var t=w(e);if(t){var n=D(t,"stack");if(n){var a,r,o=n.data[0],i=o.imageIds[0],s=V.series[i];return s&&(a=s.labelmaps3D,r=s.activeLabelmapIndex),{labelmaps3D:a,activeLabelmapIndex:r,currentImageIdIndex:o.currentImageIdIndex}}G.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.")}}function J(e,t){var n=W(e),a=n.labelmaps3D,r=n.activeLabelmapIndex;return a[t=void 0!==t?t:r]}var Y=C.UINT_16_ARRAY,K=C.FLOAT_32_ARRAY;function X(e,t){var n=w(e);if(n){var a=W(n).labelmaps3D;if(!a)return[];var r,o,i=Tt("segmentation").configuration;switch(i.arrayType){case Y:r="Uint16Array",o="2";break;case K:r="Float32Array",o="4";break;default:throw new Error("Unsupported Array Type ".concat(i.arrayType))}var s=V.colorLutTables;if(void 0!==t){var l=a[t];return l?{labelmapIndex:t,bytesPerVoxel:o,type:r,buffer:l.buffer,colorLUT:s[l.colorLUTIndex]}:void 0}for(var c=[],u=0;u<a.length;u++){var d=a[u];d&&c.push({labelmapIndex:u,bytesPerVoxel:2,buffer:d.buffer,colorLUT:s[d.colorLUTIndex]})}return c}}function Z(e){for(var t=new Set(e).values(),n=[],a=!1;!a;){var r=t.next();(a=r.done)||n.push(r.value)}return n}var Q=n(6),$=n.n(Q);function ee(e,t,n){t[e]===n&&(t[e]=0)}function te(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=function(e,t){return t*a+e};e.forEach((function(e){var a=o.apply(void 0,$()(e));r?ee(a,t,n):t[a]=n}))}function ne(e,t,n,a){for(var r=e.detail,o=t.pixelData,i=t.segmentIndex,s=r.image,l=s.width,c=s.height,u=0;u<l;u++)for(var d=0;d<n[1];d++)ee(d*l+u,o,i);for(var h=0;h<n[0];h++)for(var f=n[1];f<a[1];f++)ee(f*l+h,o,i);for(var v=a[0];v<l;v++)for(var g=n[1];g<a[1];g++)ee(g*l+v,o,i);for(var p=0;p<l;p++)for(var m=a[1];m<c;m++)ee(m*l+p,o,i)}var ae=n(8),re=n.n(ae);function oe(e,t,n){return t[e]===n}H("util:segmentation:operations:eraseOutsideCircle");function ie(e,t,n,a,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"inside",i=e.detail.image.width,s=t.pixelData,l=t.segmentIndex,c=re()(a,2),u=c[0],d=c[1],h=re()(r,2),f=h[0],v=h[1];"outside"===o&&ne(e,t,a,r);for(var g=u;g<f;g++)for(var p=d;p<v;p++){var m=p*i+g;oe(m,s,l)&&n({x:g,y:p})&&(s[m]=0)}}function se(e,t,n,a,r){ie(e,t,n,a,r,"inside")}function le(e,t,n,a,r){ie(e,t,(function(e){return!n(e)}),a,r,"outside")}function ce(e,t,n,a){for(var r=t.pixelData,o=t.segmentIndex,i=e.detail.image,s=i.width,l=i.height,c=0;c<s;c++)for(var u=0;u<n[1];u++)r[u*s+c]=o;for(var d=0;d<n[0];d++)for(var h=n[1];h<a[1];h++)r[h*s+d]=o;for(var f=a[0];f<s;f++)for(var v=n[1];v<a[1];v++)r[v*s+f]=o;for(var g=0;g<s;g++)for(var p=a[1];p<l;p++)r[p*s+g]=o}var ue=H("util:segmentation:operations:helpers:fillShape");function de(e,t,n,a,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"inside",i=t.pixelData,s=t.segmentIndex;if(void 0!==i&&void 0!==s){var l=e.detail.image.width,c=re()(a,2),u=c[0],d=c[1],h=re()(r,2),f=h[0],v=h[1];"outside"===o&&ce(e,t,a,r);for(var g=u;g<f;g++)for(var p=d;p<v;p++){var m=p*l+g;n({x:g,y:p})&&(i[m]=s)}}else ue.error("fillInsideShape requires operationData to contain pixelData and segmentIndex")}function he(e,t,n,a,r){de(e,t,n,a,r,"inside")}function fe(e,t,n,a,r){de(e,t,(function(e){return!n(e)}),a,r,"outside")}var ve=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.onFlood||function(){},r=n.onBoundary||function(){},o=n.equals||ge,i=n.diagonals||!1,s=T(t),l=I(),c=[],u=[],d={},h={};for(c.push({currentArgs:t});c.length>0;)f(c.pop());return{flooded:u,boundaries:C()};function f(e){var t=e.currentArgs,n=e.previousArgs;v(t)||(g(t),p(t)?(m(t),x(t)):y(n))}function v(e){return!0===d[e]}function g(e){d[e]=!0}function p(e){var t=b(T,[e]);return b(o,[t,s])}function m(e){u.push(e),a.apply(void 0,$()(e))}function y(e){h[e]=e,r.apply(void 0,$()(e))}function x(e){for(var t=0;t<l.length;t+=1){for(var n=l[t],a=e.slice(0),r=0;r<e.length;r+=1)a[r]+=n[r];c.push({currentArgs:a,previousArgs:e})}}function T(t){return e.apply(void 0,$()(t))}function b(e,t){try{return e.apply(void 0,$()(t))}catch(e){return}}function I(){return w(t.length).filter((function(e){var t=pe(e);return 0!==t&&(1===t||i)}))}function w(e){for(var t=[],n=function(e){return e.split("").map((function(e){return parseInt(e,10)-1}))},a=0;a<Math.pow(3,e);a+=1){var r=me(a.toString(3),"0",e);t.push(n(r))}return t}function C(){var e=[];for(var t in h)h.hasOwnProperty(t)&&e.unshift(h[t]);return e}};function ge(e,t){return e===t}function pe(e){for(var t=0,n=0;n<e.length;n+=1)0!==e[n]&&(t+=1);return t}function me(e,t,n){return(new Array(n+1).join(t)+e).slice(-n)}function ye(e,t){var n=(0,y.cornerstoneMath.point.distance)(e,t);return{left:Math.floor(Math.min(e.x-n,t.x)),top:Math.floor(Math.min(e.y-n,t.y)),width:2*n,height:2*n}}function xe(e){var t=e.detail.handles,n=e.detail.image,a=n.width,r=n.height,o=ye(t.start,t.end),i=o.width+o.left,s=o.left,l=o.top+o.height,c=o.top;return s=Math.floor(s),c=Math.floor(c),i=Math.floor(i),l=Math.floor(l),i=Math.min(a,i),s=Math.max(0,s),l=Math.min(r,l),[[s,c=Math.max(0,c)],[i,l]]}function Te(e,t){var n=1/0,a=0,r=1/0,o=0,i=t.width,s=t.height;return e.forEach((function(e){n=Math.min(e[0],n),a=Math.max(e[0],a),r=Math.min(e[1],r),o=Math.max(e[1],o)})),n=Math.floor(n),r=Math.floor(r),a=Math.floor(a),o=Math.floor(o),a=Math.min(i,a),n=Math.max(0,n),o=Math.min(s,o),r=Math.max(0,r),[[n,r],[a,o]]}function be(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=Math.floor(a),i=Math.floor(r);if(1===e)return[[o,i]];for(var s=[],l=0,c=-e;c<=e;c++){var u=i+c;if(!(u>t||u<0))for(var d=-e;d<=e;d++){var h=o+d;h>=n||h<0||d*d+c*c<e*e&&(s[l++]=[o+d,i+c])}}return s}var Ie=1/Math.sqrt(2),we={up:{x:0,y:1},upRight:{x:Ie,y:Ie},right:{x:1,y:0},downRight:{x:Ie,y:-Ie},down:{x:0,y:1},downLeft:{x:-Ie,y:-Ie},left:{x:-1,y:0},upLeft:{x:-Ie,y:Ie}},Ce=function(e,t){for(var n={x:e.x,y:e.y},a=[];t.x!==n.x||t.y!==n.y;)t.x===n.x?t.y>n.y?n.y++:n.y--:t.y===n.y?t.x>n.x?n.x++:n.x--:t.y>n.y?t.x>n.x?Ee(n,t):Me(n,t):t.x>n.x?ke(n,t):Se(n,t),a.push({x:n.x,y:n.y});return a.pop(),a};function Ee(e,t){var n=Oe(e,t);switch(_e([Pe(n,we.up),Pe(n,we.right),Pe(n,we.upRight)])){case 0:e.y++;break;case 1:e.x++;break;case 2:e.y++,e.x++}}function Me(e,t){var n=Oe(e,t);switch(_e([Pe(n,we.up),Pe(n,we.left),Pe(n,we.upLeft)])){case 0:e.y++;break;case 1:e.x--;break;case 2:e.y++,e.x--}}function ke(e,t){var n=Oe(e,t);switch(_e([Pe(n,we.down),Pe(n,we.right),Pe(n,we.downRight)])){case 0:e.y--;break;case 1:e.x++;break;case 2:e.y--,e.x++}}function Se(e,t){var n=Oe(e,t);switch(_e([Pe(n,we.down),Pe(n,we.left),Pe(n,we.downLeft)])){case 0:e.y--;break;case 1:e.x--;break;case 2:e.y--,e.x--}}function Oe(e,t){var n=y.cornerstoneMath.point.distance(e,t);return{x:(t.x-e.x)/n,y:(t.y-e.y)/n}}function Pe(e,t){return e.x*t.x+e.y*t.y}function _e(e){var t=e[0]>e[1]?0:1;return e[2]>e[t]&&(t=2),t}function De(e,t){var n=Tt("segmentation").getters;t=void 0===t?n.activeLabelmapIndex(e):t,y.cornerstone.triggerEvent(e,b.LABELMAP_MODIFIED,{labelmapIndex:t})}function Le(e,t){for(var n=[],a=0;a<e.length;a++)e[a]!==t[a]&&n.push([a,e[a],t[a]]);return n}var Ae=C.UINT_16_ARRAY,Re=C.FLOAT_32_ARRAY;function Ue(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=Tt("segmentation"),l=s.configuration,c=V.series[e];c||(V.series[e]={activeLabelmapIndex:n,labelmaps3D:[]},c=V.series[e]),c.labelmaps3D[n]={buffer:t,labelmaps2D:[],metadata:a,activeSegmentIndex:1,colorLUTIndex:i,segmentsHidden:[],undo:[],redo:[]};for(var u=c.labelmaps3D[n].labelmaps2D,d=t.byteLength/r,h=0;h<r;h++){var f=void 0;switch(l.arrayType){case Ae:f=new Uint16Array(t,d*h,d/2);break;case Re:f=new Float32Array(t,d*h,d/4);break;default:throw new Error("Unsupported Array Type ".concat(l.arrayType))}var v=o?o[h]:Z(f);v&&v.some((function(e){return e}))&&(u[h]={pixelData:f,segmentsOnLabelmap:v})}}var Be=H("store:modules:segmentationModule:getLabelmapStats");function He(e,t,n){var a=e.length,r=t[n].imagePositionPatient;if(0===n)return Ne(r,t[n+1].imagePositionPatient);if(n===a-1)return Ne(r,t[n-1].imagePositionPatient);var o=t[n-1].imagePositionPatient,i=t[n+1].imagePositionPatient;return(Ne(r,o)+Ne(r,i))/2}function Ne(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}var Fe=C.UINT_16_ARRAY,Ve=C.FLOAT_32_ARRAY;function je(e,t,n,a,r){var o,i=Tt("segmentation").configuration,s=a*r,l=s*n;switch(i.arrayType){case Fe:o=new Uint16Array(e.labelmaps3D[t].buffer,2*l,s);break;case Ve:o=new Float32Array(e.labelmaps3D[t].buffer,4*l,s);break;default:throw new Error("Unsupported Array Type ".concat(i.arrayType))}e.labelmaps3D[t].labelmaps2D[n]={pixelData:o,segmentsOnLabelmap:[]}}var qe=C.UINT_16_ARRAY,ze=C.FLOAT_32_ARRAY,Ge=H("store:modules:segmentationModule:getLabelmap2D");function We(e,t,n){var a=e.x,r=e.y;return a<n&&a>=0&&r<t&&r>=0}var Je=H("store:modules:segmentationModule:getSegmentOfActiveLabelmapAtEvent");var Ye=H("store:modules:segmentationModule:setColorLUT");function Ke(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=Tt("segmentation"),a=n.configuration,r=a.segmentsPerLabelmap;t?(Ze(t,r),t.length<r&&(t=[].concat($()(t),$()(Qe(r-t.length))))):t=t||Qe(r),t.unshift([0,0,0,0]),V.colorLutTables[e]=t}function Xe(e){return"number"==typeof e?V.colorLutTables[e]:V.colorLutTables[e.colorLUTIndex]}function Ze(e,t){e.length<t?Ye.warn("The provided colorLUT only provides ".concat(e.length," labels, whereas segmentsPerLabelmap is set to ").concat(t,". Autogenerating the rest.")):e.length>t&&Ye.warn("segmentsPerLabelmap is set to ".concat(t,", and the provided colorLUT provides ").concat(e.length,". Using the first ").concat(t," colors from the LUT."))}function Qe(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:255,t=[],n=0;n<e;n++)t.push(at(et(),nt()));return t}var $e=222.5;function et(){return($e+=137.5)>=360&&($e-=360),$e}var tt=.6;function nt(){(tt+=.07)>.82&&(tt=.3+(tt-.82));return tt}function at(e){var t,n,a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.6,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,s=(1-Math.abs(2*o-1))*r,l=s*(1-Math.abs(e/60%2-1)),c=o-s/2;return e<60?(t=s,n=l,a=0):e<120?(t=l,n=s,a=0):e<180?(t=0,n=s,a=l):e<240?(t=0,n=l,a=s):e<300?(t=l,n=0,a=s):e<360&&(t=s,n=0,a=l),[255*(t+c),255*(n+c),255*(a+c),i]}var rt=H("store:modules:segmentationModule:getBrushColor");var ot={renderOutline:!1,renderFill:!0,shouldRenderInactiveLabelmaps:!0,radius:10,minRadius:1,maxRadius:50,fillAlpha:.2,fillAlphaInactive:.1,outlineAlpha:.7,outlineAlphaInactive:.35,outlineWidth:3,storeHistory:!0,segmentsPerLabelmap:65535,arrayType:C.UINT_16_ARRAY},it=H("util:segmentation:labelmap3DHistory");function st(e,t,n){var a=e.labelmaps2D;t.forEach((function(e){for(var t=e.imageIdIndex,r=e.diff,o=a[t].pixelData,i=0;i<r.length;i++){var s=r[i];o[s[0]]=s[n]}}))}var lt={state:V,configuration:ot,onRegisterCallback:function(){Ke(0)},getters:{metadata:function(e,t,n){var a=w(e);if(a){var r=D(a,"stack").data[0].imageIds[0],o=V.series[r];if(o){if(t=void 0===t?o.activeLabelmapIndex:t,o.labelmaps3D[t]){var i=o.labelmaps3D[t];return void 0===n?i.metadata:i.metadata[n]}j.warn("No labelmap3D of labelmap index ".concat(t," on stack."))}else j.warn("brushStackState is undefined")}},labelmap3D:J,labelmaps3D:W,activeLabelmapIndex:function(e){var t=w(e);if(t){var n=D(t,"stack").data[0].imageIds[0],a=V.series[n];if(a)return a.activeLabelmapIndex}},activeSegmentIndex:function(e,t){var n=w(e);if(n){var a=D(n,"stack").data[0].imageIds[0],r=V.series[a];if(r){t=void 0===t?r.activeLabelmapIndex:t;var o=r.labelmaps3D[t];if(o)return o.activeSegmentIndex}return 1}},isSegmentVisible:function(e,t,n){if(t){var a=w(e);if(a){var r=D(a,"stack").data[0].imageIds[0],o=V.series[r];if(o){if(n=void 0===n?o.activeLabelmapIndex:n,o.labelmaps3D[n])return!o.labelmaps3D[n].segmentsHidden[t];z.warn("No labelmap3D of labelmap index ".concat(n," on stack."))}else z.warn("brushStackState is undefined")}}},labelmap2D:function(e){var t=w(e);if(t){var n=y.cornerstone,a=D(t,"stack");if(a){var r,o=a.data[0],i=n.getEnabledElement(t),s=o.currentImageIdIndex,l=i.image,c=l.rows,u=l.columns,d=o.imageIds.length,h=o.imageIds[0],f=V.series[h];if(f){if(r=f.activeLabelmapIndex,!f.labelmaps3D[r])k(f,r,c*u*d);f.labelmaps3D[r].labelmaps2D[s]||je(f,r,s,c,u)}else{r=0,V.series[h]={activeLabelmapIndex:r,labelmaps3D:[]},k(f=V.series[h],r,c*u*d),je(f,r,s,c,u)}var v=f.labelmaps3D[r];return{labelmap2D:v.labelmaps2D[s],labelmap3D:v,currentImageIdIndex:s,activeLabelmapIndex:r}}Ge.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.")}},labelmap2DByImageIdIndex:function(e,t,n,a){if(!e.labelmaps2D[t]){var r,o=Tt("segmentation").configuration,i=n*a,s=i*t;switch(o.arrayType){case qe:r=new Uint16Array(e.buffer,2*s,i);break;case ze:r=new Float32Array(e.buffer,4*s,i);break;default:throw new Error("Unsupported Array Type ".concat(o.arrayType))}e.labelmaps2D[t]={pixelData:r,segmentsOnLabelmap:Z(r)}}return e.labelmaps2D[t]},labelmapStats:function(e,t,n){var a=y.cornerstone,r=w(e);if(!r)return null;var o=D(r,"stack").data[0].imageIds,i=o[0];return new Promise((function(e){var r=V.series[i];r||e(null);var s=function(e){for(var t=[],n=y.cornerstone.metaData,a=!0,r=0;r<e.length;r++){var o=n.get("imagePlaneModule",e[r]);if(!o){a=!1;break}t.push(o)}return{sufficientMetadata:a,imagePlanes:t}}(o),l=s.sufficientMetadata,c=s.imagePlanes;l||(Be.warn("Insufficient imagePlaneModule information to calculate volume statistics."),e(null)),n=void 0===n?r.activeLabelmapIndex:n;for(var u=r.labelmaps3D[n],d=[],h=0;h<o.length;h++)d.push(a.loadAndCacheImage(o[h]));Promise.all(d).then((function(n){var a=function(e,t,n,a){for(var r=function(e,t,n,a){for(var r=t[0],o=r.rowPixelSpacing,i=r.columnPixelSpacing,s=e.labelmaps2D,l=[],c=0;c<s.length;c++){var u=s[c];if(u&&u.segmentsOnLabelmap.includes(a)){for(var d=He(t,n,c)*o*i,h=u.pixelData,f=t[c].getPixelData(),v=[],g=0;g<h.length;g++)h[g]===a&&v.push(f[g]);l.push({voxelInMM3:d,values:v})}}return l}(e,t,n,a),o=0,i=r[0].values[0],s=i,l=0,c=0;c<r.length;c++){var u=r[c],d=u.values,h=u.voxelInMM3;l+=h*d.length;var f=0;d.forEach((function(e){e>i?i=e:e<s&&(s=e),f+=e})),o+=f*h}o/=l;for(var v=0,g=0;g<r.length;g++){var p=r[g],m=(d=p.values,h=p.voxelInMM3,0);d.forEach((function(e){m+=Math.pow(e-o,2)})),v+=m*h}return v/=l,v=Math.sqrt(v),{volume:l,mean:o,stdDev:v,max:i,min:s}}(u,n,c,t);e(a)}))}))},segmentOfActiveLabelmapAtEvent:function(e){var t=e.detail,n=t.element,a=t.image,r=t.currentPoints;if(r){var o=a.width,i=a.height;if(n){var s=D(n,"stack").data[0],l=s.currentImageIdIndex,c=s.imageIds[0],u=V.series[c],d=u.activeLabelmapIndex,h=u.labelmaps3D[d];if(h){var f=h.labelmaps2D[l];if(f){var v=f.pixelData,g=r.image,p=g.x,m=g.y;if(We({x:p=Math.floor(p),y:m=Math.floor(m)},i,o)){var y=v[m*o+p];if(0===y)return;return{segmentIndex:y,metadata:h.metadata[y]}}}}}}else Je.warn("Not a cornerstone input event.")},brushColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=w(e);if(n){var a=D(n,"stack");if(a){var r,o=a.data[0],i=o.imageIds[0],s=V.series[i];if(s){var l=s.activeLabelmapIndex,c=s.labelmaps3D[l],u=c.activeSegmentIndex;r=V.colorLutTables[c.colorLUTIndex][u]}else r=V.colorLutTables[0][1];return t?"rgba(".concat(r[0],", ").concat(r[1],", ").concat(r[2],", 1.0 )"):"rgba(".concat(r[0],", ").concat(r[1],", ").concat(r[2],", 0.8 )")}rt.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.")}},labelmapBuffers:X,activeLabelmapBuffer:function(e){var t=w(e);if(t){var n=D(t,"stack").data[0].imageIds[0],a=V.series[n];if(a)return X(t,a.activeLabelmapIndex)}},colorLUT:Xe,colorForSegmentIndexColorLUT:function(e,t){return Xe(e)[t]}},setters:{metadata:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,r=w(e);if(r){var o=y.cornerstone,i=D(r,"stack"),s=i.data[0],l=s.imageIds[0],c=V.series[l];if(c||(V.series[l]={labelmapIndex:t,labelmaps3D:[]},c=V.series[l]),!c.labelmaps3D[t]){var u=o.getEnabledElement(r),d=u.image,h=d.rows,f=d.columns,v=s.imageIds.length,g=h*f*v;k(c,t,g)}var p=c.labelmaps3D[t];p.metadata[n]=a}},labelmap3DForElement:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4?arguments[4]:void 0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=w(e);if(i){var s=D(i,"stack"),l=s.data[0].imageIds.length,c=s.data[0].imageIds[0];Ue(c,t,n,a,l,r,o),De(i,n)}},labelmap3DByFirstImageId:Ue,incrementActiveSegmentIndex:function(e){var t=w(e);t&&q(t,"increase")},decrementActiveSegmentIndex:function(e){var t=w(e);t&&q(t,"decrease")},activeSegmentIndex:function(e,t){var n=w(e);if(n){var a=D(n,"stack").data[0].imageIds[0],r=V.series[a];if(r){var o=r.activeLabelmapIndex,i=r.labelmaps3D[o],s=Tt("segmentation").configuration;t<=0?t=1:t>s.segmentsPerLabelmap&&(t=s.segmentsPerLabelmap),i.activeSegmentIndex=t}}},toggleSegmentVisibility:function(e,t,n){if(t){var a=w(e);if(a){var r=D(a,"stack").data[0].imageIds[0],o=V.series[r];if(o){if(n=void 0===n?o.activeLabelmapIndex:n,o.labelmaps3D[n]){var i=o.labelmaps3D[n].segmentsHidden;return i[t]=!i[t],!i[t]}z.warn("No labelmap3D of labelmap index ".concat(n," on stack."))}else z.warn("brushStackState is undefined")}}},updateSegmentsOnLabelmap2D:function(e){e.segmentsOnLabelmap=Z(e.pixelData),e.canvasElementNeedsUpdate=!0},deleteSegment:function(e,t,n){if(t){var a=w(e);if(a){var r=D(a,"stack").data[0].imageIds[0],o=V.series[r];if(o){n=void 0===n?o.activeLabelmapIndex:n;var i=o.labelmaps3D[n];if(i){delete i.metadata[t];for(var s=i.labelmaps2D,l=0;l<s.length;l++){var c=s[l];if(c&&c.segmentsOnLabelmap.includes(t)){var u=c.pixelData,d=c.segmentsOnLabelmap.indexOf(t);c.segmentsOnLabelmap.splice(d,1);for(var h=0;h<u.length;h++)u[h]===t&&(u[h]=0)}}y.cornerstone.updateImage(a)}}}}},colorLUT:Ke,colorLUTIndexForLabelmap3D:function(e,t){e.colorLUTIndex=t},colorForSegmentIndexOfColorLUT:function(e,t,n){Xe(e)[t]=n},activeLabelmapIndex:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=w(e);if(n){var a=y.cornerstone,r=D(n,"stack"),o=r.data[0],i=a.getEnabledElement(n),s=i.image,l=s.rows,c=s.columns,u=o.imageIds.length,d=l*c*u,h=o.imageIds[0],f=V.series[h];f?(f.activeLabelmapIndex=t,f.labelmaps3D[t]||k(f,t,d)):(V.series[h]={activeLabelmapIndex:t,labelmaps3D:[]},k(f=V.series[h],t,d)),a.updateImage(n)}},radius:function(e){var t=Tt("segmentation").configuration;t.radius=Math.min(Math.max(e,t.minRadius),t.maxRadius)},pushState:function(e,t,n){var a=J(e,n);a.undo.push(t),a.redo=[]},undo:function(e,t){var n=J(e,t),a=n.undo,r=n.redo;if(a.length){var o=a.pop();st(n,o,1),r.push(o),y.cornerstone.updateImage(e)}else it.warn("No undos left.")},redo:function(e,t){var n=J(e,t),a=n.undo,r=n.redo;if(r.length){var o=r.pop();st(n,o,2),a.push(o),y.cornerstone.updateImage(e)}else it.warn("No redos left.")}}},ct={activeManipulators:{}};function ut(e){var t=y.cornerstone.getEnabledElement(e).uuid;delete ct.activeManipulators[t]}function dt(e){var t=ct.activeManipulators,n=t[e];"function"==typeof n&&n(),delete t[e]}function ht(e){ut(e.detail.element)}var ft={setters:{addActiveManipulatorForElement:function(e,t){var n=y.cornerstone.getEnabledElement(e).uuid;ct.activeManipulators[n]=t},removeActiveManipulatorForElement:ut,cancelActiveManipulatorsForElement:function(e){dt(y.cornerstone.getEnabledElement(e).uuid)},cancelActiveManipulators:function(){var e=ct.activeManipulators;Object.keys(e).forEach((function(e){return dt(e)}))}},state:ct,enabledElementCallback:function(e){var t=y.cornerstone.EVENTS.NEW_IMAGE;e.removeEventListener(t,ht),e.addEventListener(t,ht)},removeEnabledElementCallback:function(e){var t=y.cornerstone.EVENTS.NEW_IMAGE;e.removeEventListener(t,ht),ut(e)}},vt={iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:'\n    <path stroke="ACTIVE_COLOR" d="M8 16L8 0"></path>\n    <path stroke="ACTIVE_COLOR" d="M16 8L0 8"></path>\n  '},gt={configuration:vt,getters:{defaultOptions:function(){return vt}},setters:{defaultOptions:function(e){Object.assign(vt,e)}}},pt={configuration:{mouseEnabled:!0,touchEnabled:!0,globalToolSyncEnabled:!1,showSVGCursors:!1,autoResizeViewports:!0,lineDash:[4,4]}},mt=(H("store:modules:storeLogger"),{globalTools:{},globalToolChangeHistory:[],enabledElements:[],tools:[],isToolLocked:!1,activeMultiPartTool:null,mousePositionImage:{},clickProximity:6,touchProximity:10,handleRadius:6,deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1,svgCursorUrl:null}),yt={mouseTools:function(){return mt.tools.filter((function(e){return e.supportedInteractionTypes.includes("Mouse")}))},touchTools:function(){return mt.tools.filter((function(e){return e.supportedInteractionTypes.includes("Touch")}))},enabledElementByUID:function(e){return mt.enabledElements.find((function(t){return y.cornerstone.getEnabledElement(t).uuid===e}))}},xt={segmentation:lt,cursor:gt,globalConfiguration:pt,manipulatorState:ft};function Tt(e){return xt[e]}var bt={modules:xt,state:mt,getters:yt},It=function(e,t){return mt.tools.find((function(n){return n.element===e&&n.name===t}))},wt=xt.globalConfiguration;function Ct(e,t){if(wt.configuration.showSVGCursors){var n=t.getIconWithPointerSVG(),a=t.mousePoint,r=window.URL.createObjectURL(n);e.style.cursor="url('".concat(r,"') ").concat(a,", auto"),mt.svgCursorUrl=r}}function Et(e){wt.configuration.showSVGCursors&&Mt(e,"none")}function Mt(e,t){mt.svgCursorUrl&&window.URL.revokeObjectURL(mt.svgCursorUrl),mt.svgCursorUrl=null,e.style.cursor=t}var kt=Tt("globalConfiguration"),St=H("store:setToolMode"),Ot=function(e,t,n,a){void 0===a&&Array.isArray(n)&&(a=n,n=null);var r=It(e,t);r&&(function(e,t,n,a){t.supportedInteractionTypes.forEach((function(r){if(void 0===a||a.includes(r)){var o=Vt[r];o?o(t,e,n):St.warn("Unable to resolve input conflicts for type %s",r)}})),bt.state.tools.filter((function(t){return t.element===e&&"active"===t.mode&&t.supportedInteractionTypes.length>0})).forEach((function(t){var n=!1;t.supportedInteractionTypes.forEach((function(e){t.options["is".concat(e,"Active")]&&(n=!0)})),n||(St.log("Setting tool %s's to PASSIVE",t.name),Rt(e,t.name))}))}(e,r,n,a),r.supportedInteractionTypes.forEach((function(e){void 0===a||a.includes(e)?n["is".concat(e,"Active")]=!0:n["is".concat(e,"Active")]=!1})),kt.configuration.showSVGCursors&&r.supportedInteractionTypes.includes("Mouse")&&function(e,t,n){var a;a="number"==typeof t?[t]:t.mouseButtonMask;a.includes(1)&&(n.svgCursor?Ct(n.element,n.svgCursor):n.hideDefaultCursor?Et(e):function(e){Mt(e,"initial")}(e))}(e,n,r)),Bt("active",null,e,t,n)};var Pt=function(e,t,n){Ft("active",e,t,n),bt.state.enabledElements.forEach((function(a){Ot(a,e,t,n)}))},_t=Bt.bind(null,"disabled",null),Dt=Ht.bind(null,"disabled",null),Lt=Bt.bind(null,"enabled",null),At=Ht.bind(null,"enabled",null),Rt=Bt.bind(null,"passive",b.TOOL_DEACTIVATED),Ut=Ht.bind(null,"passive",b.TOOL_DEACTIVATED);function Bt(e,t,n,a,r){var o,i,s=It(n,a);s?(r=jt(r),Array.isArray(r.mouseButtonMask)&&0!==r.mouseButtonMask.length&&Array.isArray(s.options.mouseButtonMask)&&(r.mouseButtonMask=(o=r.mouseButtonMask,i=s.options.mouseButtonMask,o.concat(i).reduce((function(e,t){return-1===e.indexOf(t)&&e.push(t),e}),[]))),s.mode=e,s.mergeOptions(r),s["".concat(e,"Callback")]&&s["".concat(e,"Callback")](n,r),t&&I(n,t,{options:r,toolName:a,toolType:a,type:t})):St.warn('Unable to find tool "%s" for enabledElement',a)}function Ht(e,t,n,a){Ft(e,n,a),bt.state.enabledElements.forEach((function(r){Bt(e,t,r,n,a)}))}function Nt(e,t,n){var a="is".concat(e,"Active"),r=bt.state.tools.find((function(e){return e.element===n&&"active"===e.mode&&!0===e.options[a]}));r&&(St.log("Setting tool %s's %s to false",r.name,a),r.options[a]=!1)}function Ft(e,t,n,a){if(kt.configuration.globalToolSyncEnabled){var r={mode:e,args:[t,n]};a&&r.push(a),bt.state.globalToolChangeHistory.push(r);bt.state.globalToolChangeHistory.length>50&&bt.state.globalToolChangeHistory.shift();var o=bt.state.globalTools[t];if(o)if("active"===e){var i=function(e,t,n){void 0===n&&Array.isArray(t)&&(n=t,t=null);var a=[],r=bt.state.globalTools[e];if(r){var o=new r.tool(r.props);o.supportedInteractionTypes.forEach((function(e){if(void 0===n||n.includes(e))if("Mouse"===e){var r=jt(t).mouseButtonMask;Array.isArray(r)&&r.length>0?r.forEach((function(t){return a.push("".concat(e,"-").concat(t))})):Array.isArray(r)&&0===r.length&&a.push("".concat(e,"-DELETE"))}else"MultiTouch"===e?a.push("".concat(e,"-").concat(o.configuration.touchPointers)):a.push(e)}))}return a}(t,n,a);Object.keys(bt.state.globalTools).forEach((function(e){var t=bt.state.globalTools[e];t.activeBindings=t.activeBindings.filter((function(e){return!i.includes(e)}))})),i.some((function(e){return e.includes("Mouse-DELETE")}))&&(o.activeBindings=o.activeBindings.filter((function(e){return!e.includes("Mouse")})),i=i.filter((function(e){return!e.includes("Mouse")}))),o.activeBindings=o.activeBindings.concat(i)}else o.activeBindings=[];else St.warn("setToolMode call for tool not available globally: ".concat(t))}}var Vt={Mouse:function(e,t,n){var a=jt(n).mouseButtonMask;if(Array.isArray(a)&&a.length>0){var r=bt.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isMouseActive&&Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.some((function(e){return a.includes(e)}))}));r&&(r.options.mouseButtonMask=r.options.mouseButtonMask.filter((function(e){return!a.includes(e)})),0===r.options.mouseButtonMask.length&&(r.options.isMouseActive=!1))}},MouseWheel:Nt.bind(void 0,"MouseWheel"),Touch:function(e,t){var n=bt.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isTouchActive})),a=bt.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isMultiTouchActive&&1===e.configuration.touchPointers}));n&&(St.log("Setting tool %s's isTouchActive to false",n.name),n.options.isTouchActive=!1),a&&(St.log("Setting tool %s's isTouchActive to false",a.name),a.options.isMultiTouchActive=!1)},TouchPinch:Nt.bind(void 0,"TouchPinch"),TouchRotate:Nt.bind(void 0,"TouchRotate"),DoubleTap:Nt.bind(void 0,"DoubleTap"),MultiTouch:function(e,t){var n,a=bt.state.tools.find((function(n){return n.element===t&&"active"===n.mode&&!0===n.options.isMultiTouchActive&&n.configuration.touchPointers===e.configuration.touchPointers}));1===e.configuration.touchPointers&&(n=bt.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isTouchActive}))),a&&(St.log("Setting tool %s's isMultiTouchActive to false",a.name),a.options.isMultiTouchActive=!1),n&&(St.log("Setting tool %s's isTouchActive to false",n.name),n.options.isTouchActive=!1)}};function jt(e){return Array.isArray(e)?e={mouseButtonMask:e}:e!==Object(e)&&(e={mouseButtonMask:[e]}),e.hasOwnProperty("mouseButtonMask")||(e.mouseButtonMask=[]),Array.isArray(e.mouseButtonMask)||(e.mouseButtonMask=[e.mouseButtonMask]),e.mouseButtonMask=e.mouseButtonMask.filter((function(e){return"number"==typeof e&&0!==e})),e}var qt={passiveCallback:function(e){_t(e,this.name)},enabledCallback:function(e){Ot(e,this.name)}};var zt={passiveCallback:function(e){_t(e,this.name)},activeCallback:function(e){Lt(e,this.name)}},Gt=function(e,t){e.save(),t(e),e.restore()},Wt=1,Jt=2;var Yt={setToolWidth:function(e){Wt=e},getToolWidth:function(){return Wt},setActiveWidth:function(e){Jt=e},getActiveWidth:function(){return Jt}},Kt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,a=t.color,r=t.lineWidth,o=t.fillStyle,i=t.lineDash,s=t.shouldDrawLines,l=void 0===s||s;e.beginPath(),e.strokeStyle=a||e.strokeStyle,e.lineWidth=r||void 0===r&&Yt.getToolWidth()||e.lineWidth,i&&e.setLineDash(i),n(e),o&&(e.fillStyle=o,e.fill()),l&&e.stroke(),i&&e.setLineDash([])};function Xt(e,t,n,a,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";Kt(e,r,(function(e){"pixel"===o&&(n=y.cornerstone.pixelToCanvas(t,n),a=y.cornerstone.pixelToCanvas(t,a)),e.moveTo(n.x,n.y),e.lineTo(a.x,a.y)}))}var Zt=function(e,t,n,a,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";Kt(e,r,(function(e){"pixel"===o&&(n=y.cornerstone.pixelToCanvas(t,n),a=a.map((function(e){return y.cornerstone.pixelToCanvas(t,e)}))),e.moveTo(n.x,n.y),a.forEach((function(t){var n=t.x,a=t.y;e.lineTo(n,a)}))}))},Qt=function(e,t,n,a,r,o){var i=Math.atan2(n.y-t.y,n.x-t.x),s={color:a,lineWidth:r};o&&(s.lineDash=o),Xt(e,void 0,t,n,s,"canvas"),s={color:a,lineWidth:r,fillStyle:a};var l=[{x:n.x-10*Math.cos(i-Math.PI/7),y:n.y-10*Math.sin(i-Math.PI/7)},{x:n.x-10*Math.cos(i+Math.PI/7),y:n.y-10*Math.sin(i+Math.PI/7)},n];Zt(e,void 0,n,l,s,"canvas")},$t=function(e,t,n,a,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";"pixel"===o&&(n=y.cornerstone.pixelToCanvas(t,n)),Kt(e,r,(function(e){e.arc(n.x,n.y,a,0,2*Math.PI)}))};function en(e){var t=y.cornerstoneMath;if(e instanceof t.Vector3)return e;var n=Object.keys(e);return n.includes("x")&&n.includes("y")&&n.includes("z")?new t.Vector3(e.x,e.y,e.z):new t.Vector3(e[0],e[1],e[2])}function tn(e,t){var n=en(t.rowCosines),a=en(t.columnCosines),r=en(t.imagePositionPatient),o=e.clone().sub(r);return{x:n.dot(o)/t.columnPixelSpacing,y:a.dot(o)/t.rowPixelSpacing}}function nn(e,t){var n=en(t.rowCosines),a=en(t.columnCosines),r=en(t.imagePositionPatient),o=n.clone().multiplyScalar(e.x);o.multiplyScalar(t.columnPixelSpacing);var i=a.clone().multiplyScalar(e.y);i.multiplyScalar(t.rowPixelSpacing);var s=o.add(i);return s.add(r),s}function an(e,t){var n=en(e.rowCosines),a=en(e.columnCosines),r=en(e.imagePositionPatient),o=en(t.rowCosines),i=en(t.columnCosines),s=en(t.imagePositionPatient),l=n.clone().cross(a),c=new y.cornerstoneMath.Plane;c.setFromNormalAndCoplanarPoint(l,r);var u=o.clone().cross(i),d=new y.cornerstoneMath.Plane;d.setFromNormalAndCoplanarPoint(u,s);var h=d.clone().intersectPlane(c),f=h.origin,v=h.direction,g=nn({x:t.columns,y:t.rows},t),p=s.distanceTo(g),m=new y.cornerstoneMath.Line3;m.start=f,m.end=f.clone().add(v.multiplyScalar(p));var x=function(e,t){var n=[];return Object.keys(t).forEach((function(a){var r=t[a],o=e.intersectLine(r);o&&n.push(o)})),n}(m,function(e){var t=nn({x:0,y:0},e),n=nn({x:e.columns,y:0},e),a=nn({x:0,y:e.rows},e),r=nn({x:e.columns,y:e.rows},e);return{top:new y.cornerstoneMath.Line3(t,n),left:new y.cornerstoneMath.Line3(t,a),right:new y.cornerstoneMath.Line3(n,r),bottom:new y.cornerstoneMath.Line3(a,r)}}(t));if(2===x.length)return{start:x[0],end:x[1]}}function rn(e,t,n){var a=n*(Math.PI/180);return{x:Math.cos(a)*(e.x-t.x)-Math.sin(a)*(e.y-t.y)+t.x,y:Math.sin(a)*(e.x-t.x)+Math.cos(a)*(e.y-t.y)+t.y}}var on=function(e,t,n,a,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel",i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;"pixel"===o&&(n=y.cornerstone.pixelToCanvas(t,n),a=y.cornerstone.pixelToCanvas(t,a));var s=y.cornerstone.getViewport(t),l=t.clientWidth,c=t.clientHeight,u=s.scale,d=s.translation,h=s.rotation-i,f={x:l/2+d.x*u,y:c/2+d.y*u};Math.abs(h)>.05&&(n=rn(n,f,-h),a=rn(a,f,-h));var v=Math.abs(n.x-a.x),g=Math.abs(n.y-a.y),p=Math.min(n.x,a.x),m=Math.min(n.y,a.y),x={x:p+v/2,y:m+g/2};Math.abs(h)>.05&&(x=rn(x,f,h));var T=h*Math.PI/180;Kt(e,r,(function(e){e.ellipse(x.x,x.y,v/2,g/2,T,0,2*Math.PI),e.closePath()}))},sn="white",ln="greenyellow",cn="transparent";var un={setFillColor:function(e){cn=e},getFillColor:function(){return cn},setToolColor:function(e){sn=e},getToolColor:function(){return sn},setActiveColor:function(e){ln=e},getActiveColor:function(){return ln},getColorIfActive:function(e){return e.color?e.color:e.active?ln:sn}},dn=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=t.element,o=un.getToolColor();e.strokeStyle=a.color||o;for(var i=Object.keys(n),s=function(t){var o=i[t],s=n[o];if(!0===s.drawnIndependently)return"continue";if(!0===a.drawHandlesIfActive&&!s.active)return"continue";if(a.hideHandlesIfMoving&&s.moving)return"continue";var l={lineWidth:s.active?Yt.getActiveWidth():Yt.getToolWidth(),fillStyle:a.fill};a.lineDash&&(l.lineDash=a.lineDash),Kt(e,l,(function(e){var t=y.cornerstone.pixelToCanvas(r,s),n=s.radius||a.handleRadius||mt.handleRadius;e.arc(t.x,t.y,n,0,2*Math.PI)}))},l=0;l<i.length;l++)s(l)},hn=function(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"pixel";Kt(e,a,(function(e){n.forEach((function(n){var a=n.start,o=n.end;if("pixel"===r){var i=y.cornerstone;a=i.pixelToCanvas(t,a),o=i.pixelToCanvas(t,o)}e.moveTo(a.x,a.y),e.lineTo(o.x,o.y)}))}))},fn=function(e,t,n,a,r,o){var i=e.length>0?y.cornerstoneMath.point.findClosestPoint(e,t):t,s=[{x:n.left+n.width/2,y:n.top},{x:n.left,y:n.top+n.height/2},{x:n.left+n.width/2,y:n.top+n.height},{x:n.left+n.width,y:n.top+n.height/2}];Xt(a,void 0,i,y.cornerstoneMath.point.findClosestPoint(s,i),{color:r,lineWidth:o,lineDash:[2,3]},"canvas")},vn=15,gn="".concat(vn,"px Arial"),pn="transparent";var mn={setFont:function(e){gn=e},getFont:function(){return gn},setFontSize:function(e){vn=e},getFontSize:function(){return vn},setBackgroundColor:function(e){pn=e},getBackgroundColor:function(){return pn}},yn=function(e,t,n,a,r){var o=mn.getFontSize();e.font=mn.getFont(),e.textBaseline="top",e.fillStyle=a,n.forEach((function(n,a){e.fillText(n,t.left+r,t.top+r+a*(o+r))}))},xn=function(e,t,n){e.fillStyle=n,e.fillRect(t.left,t.top,t.width,t.height)};function Tn(e,t,n){var a=mn.getFont(),r=e.font;a&&a!==r&&(e.font=a);var o=e.measureText(t).width;return a&&a!==r&&(e.font=r),o+2*n}var bn=function(e,t,n,a,r,o){"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);var i=mn.getFontSize(),s=mn.getBackgroundColor(),l=0;t.forEach((function(t){var n=Tn(e,t,5);l=Math.max(l,n)}));var c={width:l,height:5+t.length*(i+5)};return Gt(e,(function(e){e.strokeStyle=r,o&&o.centering&&!0===o.centering.x&&(n-=c.width/2),o&&o.centering&&!0===o.centering.y&&(a-=c.height/2),c.left=n,c.top=a;var i=o&&!0===o.debug?"#FF0000":s;xn(e,c,i),yn(e,c,t,r,5)})),c},In=function(e,t,n,a,r,o,i,s,l,c){var u=y.cornerstone,d=u.pixelToCanvas(t,n);l&&(d.x+=l);var h={centering:{x:!1,y:c}};if(n.boundingBox=bn(e,a,d.x,d.y,i,h),n.hasMoved){var f=o(r).map((function(e){return u.pixelToCanvas(t,e)}));fn(f,d,n.boundingBox,e,i,s)}},wn=function(e,t,n,a,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel",i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if("pixel"===o){var s=y.cornerstone;n=s.pixelToCanvas(t,n),a=s.pixelToCanvas(t,a)}var l=y.cornerstone.getViewport(t),c=t.clientWidth,u=t.clientHeight,d=l.scale,h=l.translation,f=l.rotation-i,v={x:c/2+h.x*d,y:u/2+h.y*d};Math.abs(f)>.05&&(n=rn(n,v,-f),a=rn(a,v,-f));var g=Math.abs(n.x-a.x),p=Math.abs(n.y-a.y);n={x:Math.min(n.x,a.x),y:Math.min(n.y,a.y)},a={x:n.x+g,y:n.y+p};var m={x:n.x+g,y:n.y},x={x:n.x,y:n.y+p};Math.abs(f)>.05&&(n=rn(n,v,f),a=rn(a,v,f),m=rn(m,v,f),x=rn(x,v,f)),Kt(e,r,(function(e){e.moveTo(n.x,n.y),e.lineTo(m.x,m.y),e.lineTo(a.x,a.y),e.lineTo(x.x,x.y),e.lineTo(n.x,n.y)}))},Cn=function(e){var t=e.getContext("2d");return t.setTransform(1,0,0,1,0,0),t},En=function(e,t){return void 0===e?t:e},Mn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.shadow&&(e.shadowColor=En(t.shadowColor,"#000000"),e.shadowBlur=En(t.shadowBlur,0),e.shadowOffsetX=En(t.shadowOffsetX,1),e.shadowOffsetY=En(t.shadowOffsetY,1))},kn=function(e){return 0===Object.keys(e).length&&e.constructor===Object},Sn=Tt("segmentation"),On=Sn.getters,Pn=Sn.setters;function _n(){this.handles={start:{},end:{}}}function Dn(e){var t=e.detail.element,n=e.detail.currentPoints.image;return kn(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),y.cornerstone.updateImage(t),!0}function Ln(e){var t=e.detail,n=t.element,a=t.currentPoints.image;this.handles.end=a,y.cornerstone.updateImage(n)}function An(e){e.detail.handles=this.handles;var t=e.detail.element,n=On.labelmap2D(t),a=n.labelmap2D,r=n.labelmap3D,o=n.currentImageIdIndex,i=a.pixelData,s=i.slice(),l={points:{start:{x:this.handles.start.x,y:this.handles.start.y},end:{x:this.handles.end.x,y:this.handles.end.y}},pixelData:i,segmentIndex:r.activeSegmentIndex,segmentationMixinType:"circleSegmentationMixin"};this.applyActiveStrategy(e,l);var c={imageIdIndex:o,diff:Le(s,i)};Pn.pushState(this.element,[c]),Pn.updateSegmentsOnLabelmap2D(a),y.cornerstone.updateImage(t),this._resetHandles()}var Rn={postTouchStartCallback:Dn,postMouseDownCallback:Dn,mouseClickCallback:Dn,touchDragCallback:Ln,mouseDragCallback:Ln,mouseMoveCallback:Ln,touchEndCallback:An,mouseUpCallback:An,initializeMixin:_n,renderToolData:function(e){var t=this,n=e.detail,a=n.element,r=On.brushColor(a,!0),o=Cn(n.canvasContext.canvas),i=y.cornerstoneMath.point.distance;Gt(o,(function(e){if(!t.handles)return null;var n=y.cornerstone.pixelToCanvas(a,t.handles.start),o=y.cornerstone.pixelToCanvas(a,t.handles.end),s=i(n,o);$t(e,a,t.handles.start,s,{color:r})}))},_resetHandles:_n,_applyStrategy:An},Un=H("tools:ScissorsTool"),Bn=Tt("segmentation"),Hn=Bn.getters,Nn=Bn.setters;function Fn(e){var t=e.detail.element,n=e.detail.currentPoints.image,a=this.handles.points;if(!a.length)return Un.warn("Something went wrong, empty handles detected."),null;a.push({x:n.x,y:n.y,lines:[]}),this.currentHandle+=1,y.cornerstone.updateImage(t)}function Vn(e){var t=e.detail,n=e.detail.element;this._addPoint(t),y.cornerstone.updateImage(n)}function jn(e){var t=this.handles.points,n=e.detail.element,a=Hn.labelmap2D(n),r=a.labelmap2D,o=a.labelmap3D,i=a.currentImageIdIndex,s=r.pixelData,l=s.slice(),c={points:t,pixelData:s,segmentIndex:o.activeSegmentIndex,segmentationMixinType:"freehandSegmentationMixin"};this.applyActiveStrategy(e,c);var u={imageIdIndex:i,diff:Le(l,s)};Nn.pushState(this.element,[u]),Nn.updateSegmentsOnLabelmap2D(r),y.cornerstone.updateImage(n),this._resetHandles()}function qn(){this.handles={points:[]},this.currentHandle=0}var zn={postTouchStartCallback:Fn,postMouseDownCallback:Fn,mouseClickCallback:Fn,touchDragCallback:Vn,mouseDragCallback:Vn,mouseMoveCallback:Vn,touchEndCallback:jn,mouseUpCallback:jn,initializeMixin:qn,renderToolData:function(e){var t=e.detail,n=t.element,a=Hn.brushColor(n,!0),r=Cn(t.canvasContext.canvas),o=this.handles.points;o.length<2||Gt(r,(function(e){for(var t=0;t<o.length;t++){var r=$()(o[t].lines);t===o.length-1&&r.push(o[0]),Zt(e,n,o[t],r,{color:a})}}))},_resetHandles:qn,_addPoint:function(e){var t=this.handles.points;t.length&&t[this.currentHandle-1].lines.push({x:e.currentPoints.image.x,y:e.currentPoints.image.y,lines:[]}),t.push({x:e.currentPoints.image.x,y:e.currentPoints.image.y,lines:[]}),this.currentHandle+=1,y.cornerstone.updateImage(e.element)},_applyStrategy:jn},Gn=Tt("segmentation").getters;var Wn=Object.assign({},zn,{renderToolData:function(e){var t=this,n=e.detail,a=n.element,r=Gn.brushColor(a,!0),o=Cn(n.canvasContext.canvas),i=this.handles;Gt(o,(function(e){if(i.points.length>1)for(var n=0;n<i.points.length;n++){var o=$()(i.points[n].lines);Zt(e,a,t.handles.points[n],o,{color:r})}}))}}),Jn=Tt("segmentation"),Yn=Jn.getters,Kn=Jn.setters;function Xn(e){var t=e.detail.element,n=e.detail.currentPoints.image;return kn(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),y.cornerstone.updateImage(t),!0}function Zn(e){var t=e.detail,n=t.element,a=t.currentPoints.image;this.handles.end=a,y.cornerstone.updateImage(n)}function Qn(e){e.detail.handles=this.handles;var t=e.detail.element,n=Yn.labelmap2D(t),a=n.labelmap2D,r=n.labelmap3D,o=n.currentImageIdIndex,i=a.pixelData,s=i.slice(),l={points:[{x:this.handles.start.x,y:this.handles.start.y},{x:this.handles.end.x,y:this.handles.end.y}],pixelData:i,segmentIndex:r.activeSegmentIndex,segmentationMixinType:"rectangleSegmentationMixin"};this.applyActiveStrategy(e,l);var c={imageIdIndex:o,diff:Le(s,i)};Kn.pushState(this.element,[c]),Kn.updateSegmentsOnLabelmap2D(a),y.cornerstone.updateImage(t),this._resetHandles()}function $n(){this.handles={start:{},end:{}}}var ea={activeOrDisabledBinaryTool:qt,enabledOrDisabledBinaryTool:zt,circleSegmentationMixin:Rn,polylineSegmentationMixin:Wn,freehandSegmentationMixin:zn,rectangleSegmentationMixin:{postTouchStartCallback:Xn,postMouseDownCallback:Xn,mouseClickCallback:Xn,touchDragCallback:Zn,mouseDragCallback:Zn,mouseMoveCallback:Zn,touchEndCallback:Qn,mouseUpCallback:Qn,initializeMixin:$n,renderToolData:function(e){var t=this,n=e.detail,a=n.element,r=Yn.brushColor(a,!0),o=Cn(n.canvasContext.canvas);Gt(o,(function(e){wn(e,a,t.handles.start,t.handles.end,{color:r})}))},_resetHandles:$n,_applyStrategy:Qn},renderBrushMixin:{renderBrush:function(e){var t,n=y.cornerstone,a=Tt("segmentation"),r=a.getters,o=a.configuration,i=e.detail,s=i.viewport;if(this._drawing?t=this._lastImageCoords:this._mouseUpRender?(t=this._lastImageCoords,this._mouseUpRender=!1):t=bt.state.mousePositionImage,t){var l=i.image,c=l.rows,u=l.columns,d=t,h=d.x,f=d.y;if(!(h<0||h>u||f<0||f>c)){var v=o.radius,g=i.canvasContext,p=i.element,m=r.brushColor(p,this._drawing);g.setTransform(1,0,0,1,0,0);var x=v*s.scale,T=n.pixelToCanvas(p,t);g.beginPath(),g.strokeStyle=m,g.ellipse(T.x,T.y,x,x,0,0,2*Math.PI),g.stroke()}}}}},ta=function(e){return e&&"object"===T()(e)&&"[object RegExp]"!==Object.prototype.toString.call(e)&&"[object Date]"!==Object.prototype.toString.call(e)},na=function(e,t){var n;return t&&!0===t.clone&&ta(e)?oa((n=e,Array.isArray(n)?[]:{}),e,t):e},aa=function(e,t,n){var a=e.slice();return t.forEach((function(t,r){void 0===a[r]?a[r]=na(t,n):ta(t)?a[r]=oa(e[r],t,n):-1===e.indexOf(t)&&a.push(na(t,n))})),a},ra=function(e,t,n){var a={};return ta(e)&&Object.keys(e).forEach((function(t){a[t]=na(e[t],n)})),Object.keys(t).forEach((function(r){ta(t[r])&&e[r]?a[r]=oa(e[r],t[r],n):a[r]=na(t[r],n)})),a},oa=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,a=Array.isArray(t),r=n||{arrayMerge:aa},o=r.arrayMerge||aa;return a?Array.isArray(e)?o(e,t,n):na(t,n):ra(e,t,n)},ia=oa,sa=H("tools:base:BaseTool"),la=Tt("globalConfiguration"),ca=function(){function e(t,n){i()(this,e),this.initialConfiguration=ia(n,t);var a=this.initialConfiguration,r=a.name,o=a.strategies,s=a.defaultStrategy,l=a.configuration,c=a.supportedInteractionTypes,u=a.mixins,d=a.svgCursor;this.name=r,this.mode="disabled",this.element=void 0,this.supportedInteractionTypes=c||[],this.strategies=o||{},this.defaultStrategy=s||Object.keys(this.strategies)[0]||void 0,this.activeStrategy=this.defaultStrategy,d&&(this.svgCursor=d),this._options={},this._configuration=Object.assign({},l),this.updateOnMouseMove=!1,this.hideDefaultCursor=!1,u&&u.length&&this._applyMixins(u),this._cursors=Object.assign({},this.initialConfiguration.cursors);var h=this.defaultStrategy&&this._cursors[this.activeStrategy];h&&(this.svgCursor=h)}return l()(e,[{key:"mergeOptions",value:function(e){this._options=Object.assign({},this._options,e)}},{key:"clearOptions",value:function(){this._options={}}},{key:"applyActiveStrategy",value:function(e,t){return this.strategies[this.activeStrategy].call(this,e,t)}},{key:"_applyMixins",value:function(e){for(var t=0;t<e.length;t++){var n=ea["".concat(e[t])];"object"===T()(n)?(Object.assign(this,n),"function"==typeof this.initializeMixin&&this.initializeMixin()):sa.warn("".concat(this.name,": mixin ").concat(ea[t]," does not exist."))}"function"===this.initializeMixin&&delete this.initializeMixin}},{key:"setActiveStrategy",value:function(e){this.activeStrategy=e,la.configuration.showSVGCursors&&this.changeCursor(this.element,e)}},{key:"changeCursor",value:function(e,t){if(e){var n=this._cursors[t];n&&(this.svgCursor=n,"active"===this.mode&&Ct(e,n))}}},{key:"configuration",get:function(){return this._configuration},set:function(e){this._configuration=e}},{key:"options",get:function(){return this._options}}],[{key:"configuration",get:function(){}}]),e}(),ua=function(e,t){if(e.boundingBox)return y.cornerstoneMath.point.insideRect(t,e.boundingBox)},da=function(e,t,n,a){if(e.hasOwnProperty("pointNearHandle")){if(e.pointNearHandle(t,e,n))return!0}else if(!0===e.hasBoundingBox){if(ua(e,n))return!0}else{var r=y.cornerstone.pixelToCanvas(t,e);if(y.cornerstoneMath.point.distance(r,n)<=a)return!0}return!1},ha=function e(t,n,a,r){var o;if(n){if(Array.isArray(n))for(var i=Object.keys(n),s=0;s<i.length;s++){var l=n[i[s]];if(l.hasOwnProperty("x")&&l.hasOwnProperty("y")&&da(l,t,a,r)){o=l;break}}else if("object"===T()(n))for(var c=Object.keys(n),u=0;u<c.length;u++){var d=c[u];if(Array.isArray(n[d])){if(o=e(t,n[d],a,r))break}else{var h=n[d];if(da(h,t,a,r)){o=h;break}}}return o}},fa=function(e,t,n,a){a||(a=6);var r=function(e){var t;return Object.keys(e).forEach((function(n){var a=e[n];!0!==a.active||(t=a)})),t}(t),o=ha(e,t,n,a);return r!==o&&(void 0!==o&&(o.active=!0),void 0!==r&&(r.active=!1),!0)};var va=function(e,t){var n=e.image,a={left:0,top:0,width:n.width,height:n.height},r=!1;return Object.keys(t).forEach((function(e){var n=t[e];!0!==n.allowedOutsideImage&&!1===y.cornerstoneMath.point.insideRect(n,a)&&(r=!0)})),r};function ga(e,t,n){return Math.min(Math.max(t,e),n)}function pa(e,t){e.x=ga(e.x,0,t.width),e.y=ga(e.y,0,t.height)}var ma=ga,ya=function(e,t,n){return t.filter((function(t){return t.element===e&&"active"===t.mode&&(void 0===n||t.options["is".concat(n,"Active")])}))},xa=n(5),Ta=n.n(xa),ba=function(e,t){return"active"===It(e,t).mode},Ia=Tt("segmentation"),wa=function(e){function t(e){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i()(this,t),a.configuration||(a.configuration={alwaysEraseOnClick:!1}),(n=u()(this,h()(t).call(this,e,a))).updateOnMouseMove=!0,n.hideDefaultCursor=!0,n._drawing=!1,n._drawingMouseUpCallback=n._drawingMouseUpCallback.bind(Ta()(n)),n}return v()(t,e),l()(t,[{key:"renderBrush",value:function(e){throw new Error("Method renderBrush not implemented for ".concat(this.name,"."))}},{key:"_paint",value:function(e){throw new Error("Method _paint not implemented for ".concat(this.name,"."))}},{key:"mouseDragCallback",value:function(e){var t=e.detail.currentPoints;this._lastImageCoords=t.image,this._drawing&&this._paint(e)}},{key:"preMouseDownCallback",value:function(e){var t=e.detail,n=t.element,a=t.currentPoints;return this._startPainting(e),this._lastImageCoords=a.image,this._drawing=!0,this._startListeningForMouseUp(n),this._paint(e),!0}},{key:"_startPainting",value:function(e){var t=e.detail,n=t.element,a=Ia.configuration,r=Ia.getters.labelmap2D(n),o=r.labelmap2D,i=r.labelmap3D,s=r.currentImageIdIndex,l=r.activeLabelmapIndex,c=this._isCtrlDown(t)||this.configuration.alwaysEraseOnClick;if(this.paintEventData={labelmap2D:o,labelmap3D:i,currentImageIdIndex:s,activeLabelmapIndex:l,shouldErase:c},a.storeHistory){var u=o.pixelData.slice();this.paintEventData.previousPixelData=u}}},{key:"_endPainting",value:function(e){for(var t=Ia.configuration,n=Ia.setters,a=this.paintEventData,r=a.labelmap2D,o=a.currentImageIdIndex,i=new Set(r.pixelData).values(),s=[],l=!1;!l;){var c=i.next();(l=c.done)||s.push(c.value)}if(r.segmentsOnLabelmap=s,t.storeHistory){var u={imageIdIndex:o,diff:Le(this.paintEventData.previousPixelData,r.pixelData)};n.pushState(this.element,[u])}De(this.element)}},{key:"mouseMoveCallback",value:function(e){var t=e.detail.currentPoints;this._lastImageCoords=t.image}},{key:"renderToolData",value:function(e){var t=e.detail.element;ba(t,this.name)&&this.renderBrush(e)}},{key:"passiveCallback",value:function(e){try{y.cornerstone.updateImage(this.element)}catch(e){return}}},{key:"_drawingMouseUpCallback",value:function(e){var t=e.detail.element;this._endPainting(e),this._drawing=!1,this._mouseUpRender=!0,this._stopListeningForMouseUp(t)}},{key:"newImageCallback",value:function(e){this._drawing&&(this._endPainting(e),this._startPainting(e))}},{key:"_startListeningForMouseUp",value:function(e){e.removeEventListener(b.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(b.MOUSE_CLICK,this._drawingMouseUpCallback),e.addEventListener(b.MOUSE_UP,this._drawingMouseUpCallback),e.addEventListener(b.MOUSE_CLICK,this._drawingMouseUpCallback),y.cornerstone.updateImage(e)}},{key:"_stopListeningForMouseUp",value:function(e){e.removeEventListener(b.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(b.MOUSE_CLICK,this._drawingMouseUpCallback),y.cornerstone.updateImage(e)}},{key:"increaseBrushSize",value:function(){var e=Ia.configuration,t=Ia.setters,n=e.radius,a=Math.floor(1.2*n);a===n&&(a+=1),t.radius(a)}},{key:"decreaseBrushSize",value:function(){var e=Ia.configuration,t=Ia.setters,n=e.radius,a=Math.floor(.8*n);t.radius(a)}},{key:"_isCtrlDown",value:function(e){return e.event&&e.event.ctrlKey||e.ctrlKey}}]),t}(ca),Ca=function(e){return e.filter((function(e){return!(e.isMultiPartTool||e instanceof ir||e instanceof wa)}))};function Ea(e,t){var n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mouse";if("touch"===a?n=(n=ya(e,yt.touchTools())).filter((function(e){return e.options.isTouchActive})):(n=(n=ya(e,yt.mouseTools())).filter((function(e){return Array.isArray(e.options.mouseButtonMask)&&t&&e.options.mouseButtonMask.includes(t)&&e.options.isMouseActive})),mt.isMultiPartToolActive&&(n=Ca(n))),0!==n.length)return n[0]}var Ma=H("manipulators:moveAllHandles"),ka=Tt("manipulatorState"),Sa={mouse:[b.MOUSE_DRAG],touch:[b.TOUCH_DRAG]},Oa={mouse:[b.MOUSE_UP,b.MOUSE_CLICK],touch:[b.TOUCH_END,b.TOUCH_DRAG_END,b.TOUCH_PINCH,b.TOUCH_PRESS,b.TAP]},Pa=function(e,t,n,a){var r=e.element,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse",s=arguments.length>6?arguments[6]:void 0;o=Object.assign({deleteIfHandleOutsideImage:mt.deleteIfHandleOutsideImage,preventHandleOutsideImage:mt.preventHandleOutsideImage},o);var l=_a.bind(this,t,n,o,i),c=function e(a){La(t,n,o,i,{dragHandler:l,upOrEndHandler:e},a,s)};ka.setters.addActiveManipulatorForElement(r,Da.bind(null,n,o,i,{dragHandler:l,upOrEndHandler:c},r,s)),n.active=!0,mt.isToolLocked=!0,Sa[i].forEach((function(e){r.addEventListener(e,l)})),Oa[i].forEach((function(e){r.addEventListener(e,c)}))};function _a(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,o=r.detail,i=o.element,s=o.image,l=o.buttons,c=r.detail.deltaPoints.image,u=c.x,d=c.y;t.active=!0,t.invalidated=!0;for(var h=Object.keys(t.handles),f=0;f<h.length;f++){var v=h[f],g=t.handles[v];!0!==g.movesIndependently&&g.hasOwnProperty("x")&&g.hasOwnProperty("y")&&(g.x+=u,g.y+=d,n.preventHandleOutsideImage&&pa(g,s))}y.cornerstone.updateImage(i);var p=Ea(i,l,a);p instanceof ir&&p.updateCachedStats(s,i,t);var m=b.MEASUREMENT_MODIFIED,x={toolName:e,toolType:e,element:i,measurementData:t};I(i,m,x),r.preventDefault(),r.stopPropagation()}function Da(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,r=a.dragHandler,o=a.upOrEndHandler,i=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0;Aa(e,t,n,{dragHandler:r,upOrEndHandler:o},i,s,!1)}function La(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,o=r.dragHandler,i=r.upOrEndHandler,s=arguments.length>5?arguments[5]:void 0,l=arguments.length>6?arguments[6]:void 0,c=s.detail,u=c.element;ka.setters.removeActiveManipulatorForElement(u),n.deleteIfHandleOutsideImage&&va(c,t.handles)&&L(u,e,t),Aa(t,n,a,{dragHandler:o,upOrEndHandler:i},u,l,!0)}function Aa(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,r=a.dragHandler,o=a.upOrEndHandler,i=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];e.active=!1,e.invalidated=!0,mt.isToolLocked=!1,Sa[n].forEach((function(e){i.removeEventListener(e,r)})),Oa[n].forEach((function(e){i.removeEventListener(e,o)})),"function"==typeof t.doneMovingCallback&&(Ma.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),t.doneMovingCallback(l)),"function"==typeof s&&s(l),y.cornerstone.updateImage(i)}var Ra=H("manipulators:moveHandle"),Ua=Tt("manipulatorState"),Ba={value:!1},Ha={mouse:[b.MOUSE_DRAG],touch:[b.TOUCH_DRAG]},Na={mouse:[b.MOUSE_UP,b.MOUSE_CLICK],touch:[b.TOUCH_END,b.TOUCH_DRAG_END,b.TOUCH_PINCH,b.TOUCH_PRESS,b.TAP]},Fa=function(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse",i=arguments.length>6?arguments[6]:void 0;r=Object.assign({deleteIfHandleOutsideImage:mt.deleteIfHandleOutsideImage,preventHandleOutsideImage:mt.preventHandleOutsideImage},r);var s=e.element,l=Va.bind(this,t,n,a,r,o),c=function s(){qa(t,e,n,a,r,o,{dragHandler:l,upOrEndHandler:s},i)};if(Ua.setters.addActiveManipulatorForElement(s,ja.bind(null,t,e,n,a,r,o,{dragHandler:l,upOrEndHandler:c},i)),a.active=!0,a.moving=!0,n.active=!0,mt.isToolLocked=!0,Ha[o].forEach((function(e){s.addEventListener(e,l)})),Na[o].forEach((function(e){s.addEventListener(e,c)})),"touch"===o){Ba.value=!0;var u=y.cornerstone.getEnabledElement(s),d=-57,h={x:e.currentPoints.page.x,y:e.currentPoints.page.y+d},f=y.cornerstone.pageToPixel(s,h.x,h.y);Ga(a,Ba,u,f)}};function Va(e,t,n,a,r,o){var i=o.detail,s=i.image,l=i.currentPoints,c=i.element,u=i.buttons,d=l.page,h=y.cornerstone.pageToPixel(c,d.x,"touch"===r?d.y+-57:d.y);Ba.value=!1,n.active=!0,n.hasMoved=!0,n.x=h.x,n.y=h.y,t.invalidated=!0,a.preventHandleOutsideImage&&pa(n,s),y.cornerstone.updateImage(c);var f=Ea(c,u,r);f instanceof ir&&f.updateCachedStats(s,c,t),I(c,b.MEASUREMENT_MODIFIED,{toolName:e,toolType:e,element:c,measurementData:t})}function ja(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0,s=i.dragHandler,l=i.upOrEndHandler,c=arguments.length>7?arguments[7]:void 0;za(e,t,n,a,r,o,{dragHandler:s,upOrEndHandler:l},c,!1)}function qa(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0,s=i.dragHandler,l=i.upOrEndHandler,c=arguments.length>7?arguments[7]:void 0,u=t.element;Ua.setters.removeActiveManipulatorForElement(u),za(e,t,n,a,r,o,{dragHandler:s,upOrEndHandler:l},c,!0)}function za(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0,s=i.dragHandler,l=i.upOrEndHandler,c=arguments.length>7?arguments[7]:void 0,u=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],d=t.element;a.active=!1,a.moving=!1,n.active=!1,n.invalidated=!0,Ba.value=!1,mt.isToolLocked=!1,Ha[o].forEach((function(e){d.removeEventListener(e,s)})),Na[o].forEach((function(e){d.removeEventListener(e,l)})),r.deleteIfHandleOutsideImage&&va(t,n.handles)&&L(d,e,n),"function"==typeof r.doneMovingCallback&&(Ra.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),r.doneMovingCallback(u)),"function"==typeof c&&c(u),y.cornerstone.updateImage(d)}function Ga(e,t,n,a){if(t.value){var r=Math.abs(e.y-a.y),o=r/10;if(r<1)return e.y=a.y,void(t.value=!1);e.y>a.y?e.y-=o:e.y<a.y&&(e.y+=o),y.cornerstone.updateImage(n.element),y.cornerstone.requestAnimationFrame((function(){Ga(e,t,n,a)}))}}var Wa=H("manipulators:moveNewHandle"),Ja=Tt("manipulatorState"),Ya={mouse:[b.MOUSE_MOVE,b.MOUSE_DRAG],touch:[b.TOUCH_DRAG]},Ka={mouse:[b.MOUSE_UP,b.MOUSE_CLICK],touch:[b.TOUCH_END,b.TOUCH_PINCH,b.TAP]},Xa=function(e,t,n,a,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse",i=arguments.length>6?arguments[6]:void 0;(r=Object.assign({deleteIfHandleOutsideImage:mt.deleteIfHandleOutsideImage,preventHandleOutsideImage:mt.preventHandleOutsideImage},r)).hasMoved=!1;var s=e.element;function l(e){Za(t,n,a,r,o,e)}function c(e){$a(t,n,a,r,o,{moveHandler:l,moveEndHandler:c},e,i)}n.active=!0,a.moving=!0,a.active=!0,mt.isToolLocked=!0,Ya[o].forEach((function(e){s.addEventListener(e,l)})),s.addEventListener(b.TOUCH_START,tr),Ka[o].forEach((function(e){s.addEventListener(e,c)})),Ja.setters.addActiveManipulatorForElement(s,er.bind(null,n,a,r,o,{moveHandler:l,moveEndHandler:c},s,i))};function Za(e,t,n,a,r,o){var i=o.detail,s=i.currentPoints,l=i.image,c=i.element,u=i.buttons;a.hasMoved=!0;var d=s.page,h=y.cornerstone.pageToPixel(c,"touch"===r?d.x+-57:d.x,"touch"===r?d.y+-57:d.y);t.invalidated=!0,n.active=!0,n.x=h.x,n.y=h.y,a&&a.preventHandleOutsideImage&&pa(n,l),y.cornerstone.updateImage(c);var f=Ea(c,u,r);f instanceof ir&&f.updateCachedStats(l,c,t),I(c,b.MEASUREMENT_MODIFIED,{toolName:e,toolType:e,element:c,measurementData:t})}function Qa(e,t,n,a,r){var o=a.moveHandler,i=a.moveEndHandler,s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];Ya[e].forEach((function(e){n.removeEventListener(e,o)})),Ka[e].forEach((function(e){n.removeEventListener(e,i)})),n.removeEventListener(b.TOUCH_START,tr),mt.isToolLocked=!1,"function"==typeof r&&r(s),"function"==typeof t.doneMovingCallback&&(Wa.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),t.doneMovingCallback(s)),y.cornerstone.updateImage(n)}function $a(e,t,n,a,r,o,i,s){var l=o.moveHandler,c=o.moveEndHandler,u=i.detail,d=u.element,h=u.currentPoints,f=!0;if(!1!==a.hasMoved){var v=h.page,g=y.cornerstone.pageToPixel(d,"touch"===r?v.x+-57:v.x,"touch"===r?v.y+-57:v.y);t.active=!1,t.invalidated=!0,n.active=!1,n.moving=!1,n.x=g.x,n.y=g.y,Ja.setters.removeActiveManipulatorForElement(d),a.preventHandleOutsideImage&&pa(n,i.detail.image),a.deleteIfHandleOutsideImage&&va(i.detail,t.handles)&&(t.cancelled=!0,f=!1,L(d,e,t)),Qa(r,a,d,{moveHandler:l,moveEndHandler:c},s,f)}}function er(e,t,n,a,r,o,i){var s=r.moveHandler,l=r.moveEndHandler;e.active=!1,e.invalidated=!0,t.active=!1,Qa(a,n,o,{moveHandler:s,moveEndHandler:l},i,!1)}function tr(e){return e.stopImmediatePropagation(),!1}var nr=function(e,t,n,a,r){n.active=!0,mt.isToolLocked=!0,Fa(e.detail,t.name,n,a,t.options,r),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},ar=function(e,t,n,a){for(var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"mouse",o=0;o<t.data.length;o++){var i=t.data[o],s=ha(e,i.handles,a,"mouse"===r?mt.clickProximity:mt.touchProximity);if(s)return{handle:s,data:i}}},rr=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";n.active=!0,mt.isToolLocked=!0,Pa(e.detail,t.name,n,null,t.options,a,(function(){n.active=!1,mt.isToolLocked=!1})),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},or=H("baseAnnotationTool"),ir=function(e){function t(){return i()(this,t),u()(this,h()(t).apply(this,arguments))}return v()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){throw new Error("Method createNewMeasurement not implemented for ".concat(this.name,"."))}},{key:"pointNearTool",value:function(e,t,n){arguments.length>3&&void 0!==arguments[3]&&arguments[3];throw new Error("Method pointNearTool not implemented for ".concat(this.name,"."))}},{key:"distanceFromPoint",value:function(e,t,n){throw new Error("Method distanceFromPoint not implemented for ".concat(this.name,"."))}},{key:"renderToolData",value:function(e){throw new Error("renderToolData not implemented for ".concat(this.name,"."))}},{key:"mouseMoveCallback",value:function(e){for(var t=e.detail,n=t.element,a=t.currentPoints.canvas,r=D(n,this.name),o=!1,i=0;i<r.data.length;i++){var s=r.data[i];!0===fa(n,s.handles,a)&&(o=!0);var l=this.pointNearTool(n,s,a,"mouse")&&!s.active,c=!this.pointNearTool(n,s,a,"mouse")&&s.active;(l||c)&&(s.active=!s.active,o=!0)}return o}},{key:"handleSelectedCallback",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";nr(e,this,t,n,a)}},{key:"toolSelectedCallback",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mouse";rr(e,this,t,n)}},{key:"updateCachedStats",value:function(e,t,n){or.warn("updateCachedStats not implemented for ".concat(this.name,"."))}}]),t}(ca),sr=function(e,t,n,a){var r=y.cornerstone,o={start:r.pixelToCanvas(e,t),end:r.pixelToCanvas(e,n)};return y.cornerstoneMath.lineSegment.distanceToPoint(o,a)},lr=function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n},cr=xt.cursor,ur=function(){function e(t,n){i()(this,e),this.iconGroupString=t,this.options=Object.assign({},cr.getters.defaultOptions(),n)}return l()(e,[{key:"getIconSVG",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._generateIconSVGString(e);return new Blob([t],{type:"image/svg+xml"})}},{key:"getIconSVGString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._generateIconSVGString(e)}},{key:"getIconWithPointerSVG",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._generateIconWithPointerSVGString(e);return new Blob([t],{type:"image/svg+xml"})}},{key:"getIconWithPointerString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._generateIconWithPointerSVGString(e)}},{key:"_generateIconWithPointerSVGString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},this.options,e),n=t.mousePointerGroupString,a=t.iconSize,r=t.viewBox,o=a/Math.max(r.x,r.y),i=16+a,s='\n        <svg\n        data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"\n        width="'.concat(i,'" height="').concat(i,'" viewBox="0 0 ').concat(i," ").concat(i,'"\n      >\n        <g>\n          ').concat(n,'\n        </g>\n        <g transform="translate(16, 16) scale(').concat(o,')">\n          ').concat(this.iconGroupString,"\n        </g>\n      </svg>");return this._injectColors(s,t)}},{key:"_generateIconSVGString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},this.options,e),n=t.iconSize,a=t.viewBox,r='\n      <svg\n        data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"\n        width="'.concat(n,'" height="').concat(n,'" viewBox="0 0\n        ').concat(a.x," ").concat(a.y,'"\n      >\n        ').concat(this.iconGroupString,"\n      </svg>");return this._injectColors(r,t)}},{key:"_injectColors",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.activeColor||un.getActiveColor(),a=t.toolColor||un.getToolColor(),r=t.fillColor||un.getFillColor();return e.replace(/ACTIVE_COLOR/g,"".concat(n)).replace(/TOOL_COLOR/g,"".concat(a)).replace(/FILL_COLOR/g,"".concat(r))}},{key:"mousePoint",get:function(){var e=this.options.mousePoint;return"".concat(e.x," ").concat(e.y)}}]),e}(),dr=new ur('<path fill="ACTIVE_COLOR" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50\n        50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23\n        10l50 50q10 10 10 23z"\n      />',{viewBox:{x:1792,y:1792}}),hr=new ur('<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />\n  </g>',{viewBox:{x:24,y:24}}),fr=new ur('<g fill="ACTIVE_COLOR" stroke-width="3" stroke="ACTIVE_COLOR">\n    <path d="M27.63 3.21L3.12 28.81"></path>\n    <path d="M27.63 15.75L15.27 4.43"></path>\n    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>\n    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>\n    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>\n    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>\n  </g>',{viewBox:{x:48,y:48}}),vr=new ur('<g stroke="ACTIVE_COLOR" stroke-width="3">\n    <path d="M28.59 2.34L3.82 12.32"></path>\n    <path d="M28.59 29.66L3.82 19.68"></path>\n    <path stroke-dasharray="2" fill-opacity="0" d="M12.37\n      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15\n      9.33C13.11 9.24 13.02 9 12.88 8.63">\n    </path>\n  </g>',{viewBox:{x:32,y:32}}),gr=new ur('<circle stroke="ACTIVE_COLOR" fill="none" stroke-width="3" cx="16" cy="16" r="14" />',{viewBox:{x:32,y:32}}),pr=new ur('<path stroke="ACTIVE_COLOR" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16\n    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14\n    6.3 30.74 10.54 30.74 15.76Z"\n    />',{viewBox:{x:32,y:32}}),mr=new ur('\n  <g fill="ACTIVE_COLOR" stroke="ACTIVE_COLOR" stroke-width="2">\n    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>\n    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>\n    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>\n    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>\n    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>\n    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>\n    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>\n    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>\n    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>\n    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>\n    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>\n    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>\n    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>\n    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>\n    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>\n    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>\n    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>\n    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>\n    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>\n    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>\n    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>\n    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>\n    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>\n    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>\n    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>\n    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>\n    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>\n    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>\n    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>\n    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>\n  </g>',{viewBox:{x:18,y:18}}),yr=new ur('<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n      <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>\n      <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>\n      <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>\n      <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>\n      <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>\n      <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>\n      <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>\n      <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>\n      <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>\n      <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>\n      <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>\n      <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>\n      <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>\n      <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>\n      <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>\n      <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>\n      <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>\n      <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>\n      <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>\n      <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>\n      <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>\n      <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>\n      <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>\n      <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>\n      <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>\n      <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>\n      <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>\n      <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>\n      <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>\n      <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>\n      <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>\n      <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>\n    </g>',{viewBox:{x:18,y:18}}),xr=new ur('<g id="length-group" fill="none" stroke-width="1" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />\n  </g>',{viewBox:{x:24,y:24}}),Tr=new ur('<path fill="ACTIVE_COLOR" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75\n    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73\n    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5\n    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5\n    385.5-103 385.5 103 279.5 279.5 103 385.5z"\n  />',{viewBox:{x:1792,y:1792}}),br=new ur('<path fill="ACTIVE_COLOR" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47\n    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0\n    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119\n    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z"\n  />',{viewBox:{x:1792,y:1792}}),Ir=new ur('<path fill="ACTIVE_COLOR" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0\n    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29\n    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15\n    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5\n    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0\n    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11\n    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0\n    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58\n    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z"\n  />',{viewBox:{x:1792,y:1792}}),wr=new ur('<path fill="ACTIVE_COLOR" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26\n    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45\n    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26\n    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5\n    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32\n    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5\n    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26\n    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26\n    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161\n    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161\n    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z"\n  />',{viewBox:{x:1792,y:1792}}),Cr=new ur('<path transform="translate(0,1792) scale(1,-1)" fill="ACTIVE_COLOR" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15\n      34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38\n      0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38\n      0 69.5 20.5t47.5 54.5z"\n    />',{viewBox:{x:2048,y:1792}}),Er=new ur('<path fill="ACTIVE_COLOR" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n      312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n      0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n      0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n      32s176 78.7 176 176-78.7 176-176 176z"\n    />',{viewBox:{x:512,y:512}}),Mr=new ur('<path fill="ACTIVE_COLOR" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17\n      39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355\n      355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59\n      39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12\n      0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144\n      144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19\n      45v448q0 42-39 59-13 5-25 5-26 0-45-19z"\n    />',{viewBox:{x:1792,y:1792}}),kr=new ur('<path fill="ACTIVE_COLOR" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39\n      14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5\n      163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0\n      225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109\n      132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298\n      164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14\n      39 17 39 59z"\n    />',{viewBox:{x:1792,y:1792}}),Sr=new ur('<path fill="ACTIVE_COLOR" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547\n      0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0\n      0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547\n      0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547\n      0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z"\n      />',{viewBox:{x:24,y:28}}),Or=new ur('<path fill="ACTIVE_COLOR" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119\n    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5\n    84.5t84.5 203.5z"\n  />',{viewBox:{x:1792,y:1792}}),Pr=new ur('<path fill="ACTIVE_COLOR" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />\n    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="ACTIVE_COLOR" />',{viewBox:{x:18,y:18}}),_r=new ur('<path fill="ACTIVE_COLOR" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n      312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n      0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n      0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n      32s176 78.7 176 176-78.7 176-176 176z"\n    />\n    <path fill="ACTIVE_COLOR" transform="scale(0.22,0.22) translate(1400,0)" d="M1216\n      320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19\n      19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26\n      0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z"\n    />',{viewBox:{x:640,y:512}}),Dr={x:127,y:60},Lr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ACTIVE_COLOR";return'<rect fill="'.concat(e,'" x="80.19" y="25.03" width="47.14" height="15.85"/>')},Ar=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ACTIVE_COLOR";return'<rect fill="'.concat(e,'" x="80.19" y="25.03" width="47.14" height="15.85"/>\n      <rect fill="').concat(e,'" x="95.84" y="9.38" width="15.85" height="47.14"/>')},Rr='<path fill="ACTIVE_COLOR" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>',Ur='<path fill="ACTIVE_COLOR" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>',Br='<path fill="ACTIVE_COLOR" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>',Hr=new ur("".concat(Rr," ").concat(Lr()),{viewBox:Dr}),Nr=new ur("".concat(Rr," ").concat(Ar()),{viewBox:Dr}),Fr=new ur("".concat(Rr," ").concat(Lr()),{viewBox:Dr}),Vr=new ur("".concat(Rr," ").concat(Ar()),{viewBox:Dr}),jr=new ur("".concat(Ur," ").concat(Lr()),{viewBox:Dr}),qr=new ur("".concat(Ur," ").concat(Ar()),{viewBox:Dr}),zr=new ur("".concat(Ur," ").concat(Lr()),{viewBox:Dr}),Gr=new ur("".concat(Ur," ").concat(Ar()),{viewBox:Dr}),Wr=new ur("".concat(Br," ").concat(Lr()),{viewBox:Dr}),Jr=new ur("".concat(Br," ").concat(Ar()),{viewBox:Dr}),Yr=new ur("".concat(Br," ").concat(Lr()),{viewBox:Dr}),Kr=new ur("".concat(Br," ").concat(Ar()),{viewBox:Dr});function Xr(e){var t=y.cornerstone.metaData.get("imagePlaneModule",e.imageId);return t?{rowPixelSpacing:t.rowPixelSpacing||t.rowImagePixelSpacing,colPixelSpacing:t.columnPixelSpacing||t.colImagePixelSpacing}:{rowPixelSpacing:e.rowPixelSpacing,colPixelSpacing:e.columnPixelSpacing}}var Zr=function(e){var t=T()(e);return null!==e&&("object"===t||"function"===t)};var Qr=function(e,t,n){var a,r,o,i,s,l,c=0,u=!1,d=!1,h=!0,f=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;if("function"!=typeof e)throw new TypeError("Expected a function");function v(t){var n=a,o=r;return a=r=void 0,c=t,i=e.apply(o,n)}function g(e,t){return f?window.requestAnimationFrame(e):setTimeout(e,t)}function p(e){return c=e,s=g(y,t),u?v(e):i}function m(e){var n=e-l;return void 0===l||n>=t||n<0||d&&e-c>=o}function y(){var e=Date.now();if(m(e))return x(e);s=g(y,function(e){var n=e-c,a=t-(e-l);return d?Math.min(a,o-n):a}(e))}function x(e){return s=void 0,h&&a?v(e):(a=r=void 0,i)}function T(){for(var e=Date.now(),n=m(e),o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];if(a=c,r=this,l=e,n){if(void 0===s)return p(l);if(d)return s=g(y,t),v(l)}return void 0===s&&(s=g(y,t)),i}return t=Number(t)||0,Zr(n)&&(u=Boolean(n.leading),o=(d="maxWait"in n)?Math.max(Number(n.maxWait)||0,t):o,h="trailing"in n?Boolean(n.trailing):h),T.cancel=function(){void 0!==s&&function(e){if(f)return window.cancelAnimationFrame(e);clearTimeout(e)}(s),c=0,a=l=r=s=void 0},T.flush=function(){return void 0===s?i:x(Date.now())},T.pending=function(){return void 0!==s},T};var $r=function(e,t,n){var a=!0,r=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return Zr(n)&&(a="leading"in n?Boolean(n.leading):a,r="trailing"in n?Boolean(n.trailing):r),Qr(e,t,{leading:a,trailing:r,maxWait:t})},eo=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"Angle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:dr,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(e=u()(this,h()(t).call(this,n,a))).preventNewMeasurement=!1,e.throttledUpdateCachedStats=$r(e.updateCachedStats,110),e}return v()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return!1!==t.visible&&(sr(e,t.handles.start,t.handles.middle,n)<25||sr(e,t.handles.middle,t.handles.end,n)<25)}},{key:"updateCachedStats",value:function(e,t,n){var a=no(e,n.handles.middle,n.handles.start),r=no(e,n.handles.end,n.handles.middle),o=no(e,n.handles.end,n.handles.start),i=to(a),s=to(r),l=to(o),c=Math.acos((Math.pow(i,2)+Math.pow(s,2)-Math.pow(l,2))/(2*i*s));c*=180/Math.PI,n.rAngle=lr(c,2),n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=n.enabledElement,r=this.configuration,o=r.handleRadius,i=r.drawHandlesOnHover,s=r.hideHandlesIfMoving,l=r.renderDashed,c=D(e.currentTarget,this.name),u=Tt("globalConfiguration").configuration.lineDash;if(c)for(var d=Cn(n.canvasContext.canvas),h=n.image,f=n.element,v=Xr(h),g=v.rowPixelSpacing,p=v.colPixelSpacing,m=Yt.getToolWidth(),x=function(e){var r=c.data[e];if(!1===r.visible)return"continue";Gt(d,(function(e){Mn(e,t.configuration);var c=un.getColorIfActive(r),d=y.cornerstone.pixelToCanvas(n.element,r.handles.start),v=y.cornerstone.pixelToCanvas(n.element,r.handles.middle),x={color:c};l&&(x.lineDash=u),Zt(e,n.element,r.handles.start,[r.handles.middle,r.handles.end],x);var T={color:c,handleRadius:o,drawHandlesIfActive:i,hideHandlesIfMoving:s};if(t.configuration.drawHandles&&dn(e,n,r.handles,T),!0===r.invalidated&&(r.rAngle?t.throttledUpdateCachedStats(h,f,r):t.updateCachedStats(h,f,r)),r.rAngle){var I,w=function(e,t,n){var a=t&&n?"":" (isotropic)";return e.rAngle.toString()+String.fromCharCode(parseInt("00B0",16))+a}(r,g,p);if(!r.handles.textBox.hasMoved){I={x:v.x,y:v.y};var C=Tn(e,w,5);v.x<d.x?I.x-=15+C+10:I.x+=15;var E=y.cornerstone.internal.getTransform(a);E.invert();var M=E.transformPoint(I.x,I.y);r.handles.textBox.x=M.x,r.handles.textBox.y=M.y}In(e,n.element,r.handles.textBox,w,r.handles,b,c,m,0,!0)}}))},T=0;T<c.data.length;T++)x(T);function b(e){return[e.start,e.middle,e.end]}}},{key:"addNewMeasurement",value:function(e,t){var n=this;if(!this.preventNewMeasurement){this.preventNewMeasurement=!0,e.preventDefault(),e.stopPropagation();var a=e.detail,r=this.createNewMeasurement(a),o=e.detail.element;_(o,this.name,r),y.cornerstone.updateImage(o),Xa(a,this.name,r,r.handles.middle,this.options,t,(function(e){if(r.active=!1,!e)return L(o,n.name,r),void(n.preventNewMeasurement=!1);r.handles.end.active=!0,y.cornerstone.updateImage(o),Xa(a,n.name,r,r.handles.end,n.options,t,(function(e){e?(r.active=!1,y.cornerstone.updateImage(o)):L(o,n.name,r),n.preventNewMeasurement=!1,y.cornerstone.updateImage(o);var t={toolName:n.name,toolType:n.name,element:o,measurementData:r};I(o,b.MEASUREMENT_COMPLETED,t)}))}))}}}]),t}(ir);function to(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function no(e,t,n){var a=Xr(e),r=a.rowPixelSpacing,o=a.colPixelSpacing;return{x:(t.x-n.x)*(o||1),y:(t.y-n.y)*(r||1)}}var ao=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"ArrowAnnotate",supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:ro,changeTextCallback:oo,drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,arrowFirst:!0,renderDashed:!1,allowEmptyLabel:!1},svgCursor:hr};return(e=u()(this,h()(t).call(this,n,a))).preventNewMeasurement=!1,e}return v()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return!1!==t.visible&&sr(e,t.handles.start,t.handles.end,n)<25}},{key:"updateCachedStats",value:function(){}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=n.element,r=n.enabledElement,o=this.configuration,i=o.handleRadius,s=o.drawHandlesOnHover,l=o.hideHandlesIfMoving,c=o.renderDashed,u=D(a,this.name);if(u){var d,h=e.detail.canvasContext.canvas,f=Cn(h),v=Yt.getToolWidth();c&&(d=Tt("globalConfiguration").configuration.lineDash);for(var g=function(n){var o=u.data[n];if(!1===o.visible)return"continue";Gt(f,(function(n){Mn(n,t.configuration);var c=un.getColorIfActive(o),u=y.cornerstone.pixelToCanvas(a,o.handles.start),h=y.cornerstone.pixelToCanvas(a,o.handles.end);t.configuration.arrowFirst?Qt(n,h,u,c,v,d):Qt(n,u,h,c,v,d);var f={color:c,handleRadius:i,drawHandlesIfActive:s,hideHandlesIfMoving:l};t.configuration.drawHandles&&dn(n,e.detail,o.handles,f);var g=function(e){return e.text}(o);if(g&&""!==g){var p=Tn(n,g,5),x=mn.getFontSize()+10,T=Math.max(p,x)/2+5;if(h.x<u.x&&(T=-T),!o.handles.textBox.hasMoved){var b;b=t.configuration.arrowFirst?{x:h.x-p/2+T,y:h.y-x/2}:{x:u.x-p/2-T,y:u.y-x/2};var I=y.cornerstone.internal.getTransform(r);I.invert();var w=I.transformPoint(b.x,b.y);o.handles.textBox.x=w.x,o.handles.textBox.y=w.y}In(n,a,o.handles.textBox,g,o.handles,m,c,v,0,!1)}}))},p=0;p<u.data.length;p++)g(p)}function m(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}}},{key:"addNewMeasurement",value:function(e,t){var n=this,a=e.detail.element,r=this.createNewMeasurement(e),o=this.configuration.allowEmptyLabel;_(a,this.name,r),y.cornerstone.updateImage(a),Xa(e.detail,this.name,r,r.handles.end,this.options,t,(function(t){t?void 0===r.text&&n.configuration.getTextCallback((function(e){if(e||o){r.text=e,r.active=!1;var t={toolName:n.name,toolType:n.name,element:a,measurementData:r};y.cornerstone.updateImage(a),I(a,b.MEASUREMENT_COMPLETED,t)}else L(a,n.name,r)}),e.detail):L(a,n.name,r),y.cornerstone.updateImage(a)}))}},{key:"doubleClickCallback",value:function(e){return this._updateTextForNearbyAnnotation(e)}},{key:"touchPressCallback",value:function(e){return this._updateTextForNearbyAnnotation(e)}},{key:"_updateTextForNearbyAnnotation",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.canvas,a=D(t,this.name);if(!a)return!1;for(var r=0;r<a.data.length;r++){var o=a.data[r];if(this.pointNearTool(t,o,n)||ua(o.handles.textBox,n))return o.active=!0,y.cornerstone.updateImage(t),this.configuration.changeTextCallback(o,e.detail,this._doneChangingTextCallback.bind(this,t,o)),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),!0}}},{key:"_doneChangingTextCallback",value:function(e,t,n,a){!0===a?L(e,this.name,t):t.text=n,t.active=!1,y.cornerstone.updateImage(e),I(e,b.MEASUREMENT_MODIFIED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})}}]),t}(ir);function ro(e){e(prompt("Enter your annotation:"))}function oo(e,t,n){n(prompt("Change your annotation:"))}var io=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object.assign({x:e,y:t,index:n,drawnIndependently:!1,allowedOutsideImage:!1,highlight:!0,active:!1},a)},so=function(e){var t=e.currentPoints.image,n=t.x,a=t.y;return{toolName:this.name,toolType:this.name,isCreating:!0,visible:!0,active:!0,invalidated:!0,handles:{start:io(n,a,0),end:io(n,a,1,{active:!0}),perpendicularStart:io(n,a,2,{locked:!0}),perpendicularEnd:io(n,a,3),textBox:io(n-50,a-70,null,{highlight:!1,hasMoved:!0,active:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0})},longestDiameter:0,shortestDiameter:0}},lo=function(e,t,n,a){var r=y.cornerstone,o=y.cornerstoneMath,i={start:r.pixelToCanvas(e,t.perpendicularStart),end:r.pixelToCanvas(e,t.perpendicularEnd)};return o.lineSegment.distanceToPoint(i,n)<a},co=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",r=y.cornerstone,o=y.cornerstoneMath,i=t.handles,s={start:r.pixelToCanvas(e,i.start),end:r.pixelToCanvas(e,i.end)},l=o.lineSegment.distanceToPoint(s,n);if(ua(i.textBox,n))return!0;var c="mouse"===a?mt.clickProximity:mt.touchProximity;return!!lo(e,i,n,c)||l<c};function uo(e,t,n,a){var r=(n.x-a.x)*e,o=(n.y-a.y)*t,i=Math.sqrt(r*r+o*o);return{x:r/i,y:o/i,length:i}}function ho(e,t){if(!t.handles.perpendicularStart.locked)return!1;var n,a,r,o,i=t.handles,s=i.start,l=i.end,c=e.image,u=c.columnPixelSpacing,d=void 0===u?1:u,h=c.rowPixelSpacing,f=void 0===h?1:h;if(s.x===l.x&&s.y===l.y)n=s.x,a=s.y,r=l.x,o=l.y;else{var v={x:(s.x+l.x)/2,y:(s.y+l.y)/2},g=uo(d,f,s,l),p=g.length/2,m=p/(2*f),y=p/(2*d);n=v.x+y*g.y,a=v.y-m*g.x,r=v.x-y*g.y,o=v.y+m*g.x}return t.handles.perpendicularStart.x=n,t.handles.perpendicularStart.y=a,t.handles.perpendicularEnd.x=r,t.handles.perpendicularEnd.y=o,!0}var fo,vo=function(e){var t=this,n=e.detail,a=n.element,r=n.canvasContext,o=n.image,i=this.configuration,s=i.handleRadius,l=i.drawHandlesOnHover,c=i.hideHandlesIfMoving,u=i.renderDashed,d=Tt("globalConfiguration").configuration.lineDash,h=D(a,this.name);if(h){var f=Xr(o),v=f.rowPixelSpacing,g=f.colPixelSpacing;if(v&&g)for(var p,m=Cn(r.canvas),y=un.getActiveColor(),x=Yt.getToolWidth(),T=function(e){var r=h.data[e];if(!1===r.visible)return"continue";p=r.active?y:un.getToolColor(),!0===r.invalidated&&(r.longestDiameter&&r.shortestDiameter?t.throttledUpdateCachedStats(o,a,r):t.updateCachedStats(o,a,r)),Gt(m,(function(e){Mn(e,t.configuration);var o=r.handles,i=o.start,h=o.end,f=o.perpendicularStart,m=o.perpendicularEnd,y=o.textBox,T={color:p},b={color:p,strokeWidth:I};u&&(T.lineDash=d,b.lineDash=d),Xt(e,a,i,h,T);var I=x;ho(n,r),Xt(e,a,f,m,b);var w={color:p,handleRadius:s,drawHandlesIfActive:l,hideHandlesIfMoving:c};t.configuration.drawHandles&&dn(e,n,r.handles,w);var C=go(r,v,g);In(e,a,y,C,r.handles,(function(e){return[e.start,e.end,e.perpendicularStart,e.perpendicularEnd]}),p,x,10,!0)}))},b=0;b<h.data.length;b++)T(b)}},go=function(e,t,n){var a=" mm";t&&n||(a=" pixels");var r=" L ".concat(e.longestDiameter).concat(a),o=" W ".concat(e.shortestDiameter).concat(a),i=e.labels;return i&&Array.isArray(i)?[].concat($()(i),[r,o]):[r,o]},po=function(e,t){var n=this,a=e.detail,r=a.element,o=a.image,i=a.buttons,s=this.configuration;if(!mo(o)){var l=this.createNewMeasurement(a),c=function(){l.active=!1,y.cornerstone.updateImage(r)};_(r,this.name,l),y.cornerstone.updateImage(r);var u=(new Date).getTime(),d=l.handles,h=d.end,f=d.perpendicularStart;Xa(a,this.name,l,h,{},t,(function(e){if(e){var d=l.handles,h=l.longestDiameter,v=l.shortestDiameter,g=va(a,d),p=parseFloat(h)||0,m=parseFloat(v)||0,x=p<1||m<1,T=(new Date).getTime()-u<150;g||x||T?(l.cancelled=!0,L(r,n.name,l)):s.getMeasurementLocationCallback(l,a,c),ho(a,l),f.locked=!1,l.invalidated=!0,y.cornerstone.updateImage(r);var w=Ea(r,i,t);w instanceof zo&&w.updateCachedStats(o,r,l);var C={toolName:n.name,toolType:n.name,element:r,measurementData:l};I(r,b.MEASUREMENT_MODIFIED,C),I(r,b.MEASUREMENT_COMPLETED,C)}else L(r,n.name,l)}))}},mo=function(e){var t=y.cornerstone.metaData.get("imagePlaneModule",e.imageId),n=e.rowPixelSpacing,a=e.columnPixelSpacing;return t&&(n=t.rowPixelSpacing||t.rowImagePixelSpacing,a=t.columnPixelSpacing||t.colImagePixelSpacing),!n||!a};var yo={setCoords:function(e){fo=e.currentPoints.canvas},getCoords:function(){return fo}},xo=function(e){var t=this,n=e.detail,a=n.element;yo.setCoords(n);var r=D(a,this.name);if(r){for(var o=!1,i=function(e){var i=n.currentPoints.canvas,s=r.data[e],l=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6,r=ha(e,t,n,a),o=!1;return Object.keys(t).forEach((function(e){if("textBox"!==e){var n=t[e],a=n===r;n.active!==a&&(o=!0),n.active=a}})),o}(a,s.handles,i);Object.keys(s.handles).forEach((function(e){if("textBox"!==e){var t=s.handles[e];t.hover=t.active}})),l&&(o=!0);var c=t.pointNearTool(a,s,i,"mouse"),u=c&&!s.active,d=!c&&s.active;(u||d)&&(s.active=!s.active,o=!0)},s=0;s<r.data.length;s++)i(s);!0===o&&y.cornerstone.updateImage(a)}},To=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";"touch"===a?this.handleSelectedTouchCallback(e):this.handleSelectedMouseCallback(e)};function bo(e,t,n,a){var r=(n.x-a.x)/t,o=(n.y-a.y)/e;return Math.sqrt(r*r+o*o)}function Io(e,t){return{start:e,end:t}}function wo(e,t,n){var a=y.cornerstoneMath.lineSegment,r=e.handles,o=r.start,i=r.end,s=r.perpendicularStart,l=r.perpendicularEnd,c=t.image,u=c.columnPixelSpacing,d=void 0===u?1:u,h=c.rowPixelSpacing,f=void 0===h?1:h,v=Io(o,i),g=Io(s,l),p=a.intersectLine(v,g);return{columnPixelSpacing:d,rowPixelSpacing:f,start:o,end:i,perpendicularStart:s,perpendicularEnd:l,longLine:v,intersection:p,distanceToFixed:bo(d,f,n,p),fixedPoint:n}}function Co(e,t,n,a){var r=wo(t,n,a),o=r.columnPixelSpacing,i=r.rowPixelSpacing,s=r.distanceToFixed,l=bo(o,i,a,e);if(l<=s)return!1;var c=s/l,u=function(e,t){var n=e.columnPixelSpacing,a=e.rowPixelSpacing,r=e.start,o=e.perpendicularStart,i=e.perpendicularEnd,s=e.intersection,l=e.fixedPoint,c=bo(n,a,o,s),u=bo(n,a,i,s),d=uo(n,a,l,t),h=l===r?1:-1,f=h*a,v=h*n;return{start:{x:t.x+d.y*c*f,y:t.y+d.x*c*v*-1},end:{x:t.x+d.y*u*f*-1,y:t.y+d.x*u*v}}}(r,{x:a.x+(e.x-a.x)*c,y:a.y+(e.y-a.y)*c});return t.handles.perpendicularStart.x=u.start.x,t.handles.perpendicularStart.y=u.start.y,t.handles.perpendicularEnd.x=u.end.x,t.handles.perpendicularEnd.y=u.end.y,!0}function Eo(e,t){return e===t}function Mo(e,t){return Eo(e,t)?-1:1}var ko=n(32),So=n.n(ko);function Oo(e,t,n,a){var r,o=e.columnPixelSpacing,i=e.rowPixelSpacing,s=e.fixedPoint,l=e.perpendicularStart,c=e.perpendicularEnd,u=e.distanceToFixed,d=Mo(s,c)*u,h=function(e,t,n){return Eo(e,n)?t:n}(s,l,c)===l,f=h?"start":"end",v=h?"end":"start";return r={},So()(r,f,{x:n.start.x,y:n.start.y}),So()(r,v,{x:t.x+a.y*i*d,y:t.y+a.x*o*d*-1}),r}function Po(e,t,n,a){var r=y.cornerstoneMath.lineSegment,o=wo(t,n,a),i=o.columnPixelSpacing,s=o.rowPixelSpacing,l=o.start,c=o.longLine,u=o.intersection;if(!function(e,t,n){return 0!==bo(e,t,n.start,n.end)}(i,s,c))return!1;var d=uo(i,s,l,u),h=function(e,t,n){var a=e.columnPixelSpacing,r=e.rowPixelSpacing,o=e.perpendicularEnd,i=e.fixedPoint,s=Number.MAX_SAFE_INTEGER,l=Mo(i,o)*s;return{start:t,end:{x:t.x+n.y*r*l,y:t.y+n.x*a*l*-1}}}(o,e,d),f=r.intersectLine(c,h);if(!f)return!1;var v=Oo(o,f,h,d);return t.handles.perpendicularStart.x=v.start.x,t.handles.perpendicularStart.y=v.start.y,t.handles.perpendicularEnd.x=v.end.x,t.handles.perpendicularEnd.y=v.end.y,!0}var _o=function(e,t,n,a){var r,o,i,s,l={},c={},u={x:t.currentPoints.image.x+a.x,y:t.currentPoints.image.y+a.y};0===e.index?Co(u,n,t,n.handles.end)?(e.x=u.x,e.y=u.y):(t.currentPoints.image.x=e.x,t.currentPoints.image.y=e.y):1===e.index?Co(u,n,t,n.handles.start)?(e.x=u.x,e.y=u.y):(t.currentPoints.image.x=e.x,t.currentPoints.image.y=e.y):2===e.index?(r=!1,l.start={x:n.handles.start.x,y:n.handles.start.y},l.end={x:n.handles.end.x,y:n.handles.end.y},c.start={x:n.handles.perpendicularEnd.x,y:n.handles.perpendicularEnd.y},c.end={x:u.x,y:u.y},(o=y.cornerstoneMath.lineSegment.intersectLine(l,c))||(c.end={x:n.handles.perpendicularStart.x,y:n.handles.perpendicularStart.y},o=y.cornerstoneMath.lineSegment.intersectLine(l,c),i=y.cornerstoneMath.point.distance(o,n.handles.start),s=y.cornerstoneMath.point.distance(o,n.handles.end),(!o||i<3||s<3)&&(r=!0)),!1,r||Po(u,n,t,n.handles.perpendicularEnd)||(t.currentPoints.image.x=n.handles.perpendicularStart.x,t.currentPoints.image.y=n.handles.perpendicularStart.y)):3===e.index&&(r=!1,l.start={x:n.handles.start.x,y:n.handles.start.y},l.end={x:n.handles.end.x,y:n.handles.end.y},c.start={x:n.handles.perpendicularStart.x,y:n.handles.perpendicularStart.y},c.end={x:u.x,y:u.y},(o=y.cornerstoneMath.lineSegment.intersectLine(l,c))||(c.end={x:n.handles.perpendicularEnd.x,y:n.handles.perpendicularEnd.y},o=y.cornerstoneMath.lineSegment.intersectLine(l,c),i=y.cornerstoneMath.point.distance(o,n.handles.start),s=y.cornerstoneMath.point.distance(o,n.handles.end),(!o||i<3||s<3)&&(r=!0)),!1,r||Po(u,n,t,n.handles.perpendicularStart)||(t.currentPoints.image.x=n.handles.perpendicularEnd.x,t.currentPoints.image.y=n.handles.perpendicularEnd.y))},Do=function(e,t,n){var a=e[n],r=t[n];e[n]=r,t[n]=a},Lo=function(e,t){Do(e,t,"x"),Do(e,t,"y"),Do(e,t,"moving"),Do(e,t,"hover"),Do(e,t,"active"),Do(e,t,"selected")};var Ao=function(e){var t,n=this,a=e.detail,r=a.element,o=mt.clickProximity,i=function(e){t.invalidated=!0,va(a,t.handles)&&L(r,n.name,t),e&&(e.moving=!1,e.selected=!0),Ct(n.element,n.svgCursor),y.cornerstone.updateImage(r),r.addEventListener(b.MOUSE_MOVE,n._moveCallback),r.addEventListener(b.TOUCH_START,n._moveCallback)},s=a.startPoints.canvas,l=D(e.currentTarget,this.name);if(l){for(var c=function(c){t=l.data[c];var u=[r,t.handles,s,o],d=ha.apply(void 0,u);if(d)return r.removeEventListener(b.MOUSE_MOVE,n._moveCallback),r.removeEventListener(b.TOUCH_START,n._moveCallback),t.active=!0,Ro(t.handles),d.moving=!0,(d=function(e,t,n){var a=e.image,r=a.rowPixelSpacing,o=a.columnPixelSpacing,i=t.handles,s=i.start,l=i.end,c=i.perpendicularStart,u=i.perpendicularEnd,d=(s.x-l.x)*(o||1),h=(s.y-l.y)*(r||1),f=Math.sqrt(d*d+h*h),v=(c.x-u.x)*(o||1),g=(c.y-u.y)*(r||1);return(Math.sqrt(v*v+g*g)||0)>f?(Lo(s,l),Lo(s,c),Lo(l,u),Object.values(i).find((function(e){return!0===e.moving}))):n}(a,t,d)).hasBoundingBox||Et(n.element),function(e,t,n,a,r,o){var i=e.element,s=e.image,l=e.buttons,c={x:a.x-e.currentPoints.image.x,y:a.y-e.currentPoints.image.y},u=function(e){var r=e.detail;a.hasMoved=!0,void 0===a.index||null===a.index?(a.x=r.currentPoints.image.x+c.x,a.y=r.currentPoints.image.y+c.y):_o(a,r,n,c),o&&(a.x=Math.max(a.x,0),a.x=Math.min(a.x,r.image.width),a.y=Math.max(a.y,0),a.y=Math.min(a.y,r.image.height)),n.invalidated=!0,y.cornerstone.updateImage(i);var u=Ea(i,l,"mouse");u instanceof ir&&u.updateCachedStats(s,i,n);var d={toolName:t,toolType:t,element:i,measurementData:n};y.cornerstone.triggerEvent(i,b.MEASUREMENT_MODIFIED,d)};a.active=!0,a.moving=!0,mt.isToolLocked=!0,i.addEventListener(b.MOUSE_DRAG,u),i.addEventListener(b.TOUCH_DRAG,u);var d=y.cornerstone.getImage(i),h=function(){y.cornerstone.getImage(i).imageId!==d.imageId&&f()};i.addEventListener(y.cornerstone.EVENTS.IMAGE_RENDERED,h);var f=function e(){a.active=!1,mt.isToolLocked=!1,i.removeEventListener(y.cornerstone.EVENTS.IMAGE_RENDERED,h),i.removeEventListener(b.MOUSE_DRAG,u),i.removeEventListener(b.MOUSE_UP,e),i.removeEventListener(b.MOUSE_CLICK,e),i.removeEventListener(b.TOUCH_DRAG,u),i.removeEventListener(b.TOUCH_DRAG_END,e),i.removeEventListener(b.TAP,e),y.cornerstone.updateImage(i),"function"==typeof r&&r()};i.addEventListener(b.MOUSE_UP,f),i.addEventListener(b.MOUSE_CLICK,f),i.addEventListener(b.TOUCH_DRAG_END,f),i.addEventListener(b.TAP,f)}(a,n.name,t,d,(function(){return i(d)})),Bo(e),{v:!0}},u=0;u<l.data.length;u++){var d=c(u);if("object"===T()(d))return d.v}var h=function(e){return function(){Uo(e,!1),i()}};for(u=0;u<l.data.length;u++)if(t=l.data[u],this.pointNearTool(r,t,s,"mouse")){r.removeEventListener(b.MOUSE_MOVE,this._moveCallback),r.removeEventListener(b.TOUCH_START,this._moveCallback),t.active=!0,Ro(t.handles),Uo(t.handles,!0);var f=h(t.handles);return Pa(a,this.name,t,null,{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1},"mouse",f),Bo(e),!0}}},Ro=function(e){var t=!1;return Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].selected=!1,t=e[n].active||t,e[n].active=!1)})),t},Uo=function(e,t){Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].moving=t)}))},Bo=function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},Ho=[b.TOUCH_END,b.TOUCH_DRAG_END,b.TOUCH_PINCH,b.TOUCH_PRESS,b.TAP],No=function(e){var t,n=this,a=e.detail,r=a.element,o=mt.touchProximity,i=function(e){t.invalidated=!0,va(a,t.handles)&&L(r,n.name,t),e&&(e.moving=!1,e.selected=!0),y.cornerstone.updateImage(r),r.addEventListener(b.TOUCH_DRAG,n._moveCallback)},s=a.startPoints.canvas,l=D(e.currentTarget,this.name);if(l){for(var c=function(c){t=l.data[c];var u=[r,t.handles,s,o],d=ha.apply(void 0,u);if(d)return r.removeEventListener(b.TOUCH_DRAG,n._moveCallback),t.active=!0,Fo(t.handles),d.moving=!0,function(e,t,n,a,r,o){var i=e.element,s=e.image,l=e.buttons,c={x:a.x-e.currentPoints.image.x,y:a.y-e.currentPoints.image.y},u=function(e){var r=e.detail;a.hasMoved=!0,void 0===a.index||null===a.index?(a.x=r.currentPoints.image.x+c.x,a.y=r.currentPoints.image.y+c.y):_o(a,r,n,c),o&&(a.x=Math.max(a.x,0),a.x=Math.min(a.x,r.image.width),a.y=Math.max(a.y,0),a.y=Math.min(a.y,r.image.height)),n.invalidated=!0,y.cornerstone.updateImage(i);var u=Ea(i,l,"touch");u instanceof ir&&u.updateCachedStats(s,i,n);var d={toolName:t,toolType:t,element:i,measurementData:n};y.cornerstone.triggerEvent(i,b.MEASUREMENT_MODIFIED,d)};a.active=!0,mt.isToolLocked=!0,i.addEventListener(b.TOUCH_DRAG,u);var d=function e(){a.active=!1,mt.isToolLocked=!1,i.removeEventListener(b.TOUCH_DRAG,u),Ho.forEach((function(t){i.removeEventListener(t,e)})),y.cornerstone.updateImage(i),"function"==typeof r&&r()};Ho.forEach((function(e){i.addEventListener(e,d)}))}(a,n.name,t,d,(function(){return i(d)})),jo(e),{v:!0}},u=0;u<l.data.length;u++){var d=c(u);if("object"===T()(d))return d.v}var h=function(e){return function(){Vo(e,!1),i()}};for(u=0;u<l.data.length;u++)if(t=l.data[u],this.pointNearTool(r,t,s,"touch")){r.removeEventListener(b.TOUCH_DRAG,this._moveCallback),t.active=!0,Fo(t.handles),Vo(t.handles,!0);var f=h(t.handles);return Pa(a,this.name,t,null,{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1},"touch",f),jo(e),!0}}},Fo=function(e){var t=!1;return Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].selected=!1,t=e[n].active||t,e[n].active=!1)})),t},Vo=function(e,t){Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].moving=t)}))},jo=function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()};var qo=function(e,t,n){return n()},zo=function(e){function t(e){var n;i()(this,t);var a={name:"Bidirectional",supportedInteractionTypes:["Mouse","Touch"],configuration:{changeMeasurementLocationCallback:qo,getMeasurementLocationCallback:qo,textBox:"",shadow:"",drawHandles:!0,drawHandlesOnHover:!0,hideHandlesIfMoving:!1,renderDashed:!1,additionalData:[]},svgCursor:fr};return(n=u()(this,h()(t).call(this,e,a))).throttledUpdateCachedStats=$r(n.updateCachedStats,110),n.createNewMeasurement=so.bind(Ta()(n)),n.pointNearTool=co.bind(Ta()(n)),n.renderToolData=vo.bind(Ta()(n)),n.addNewMeasurement=po.bind(Ta()(n)),n._moveCallback=xo.bind(Ta()(n)),n.handleSelectedCallback=To.bind(Ta()(n)),n.handleSelectedMouseCallback=Ao.bind(Ta()(n)),n.handleSelectedTouchCallback=No.bind(Ta()(n)),n}return v()(t,e),l()(t,[{key:"updateCachedStats",value:function(e,t,n){if(n.toolName===this.name){var a=function(e,t){var n=t.rowPixelSpacing,a=t.colPixelSpacing,r=e.handles,o=r.start,i=r.end,s=r.perpendicularStart,l=r.perpendicularEnd,c=(o.x-i.x)*(a||1),u=(o.y-i.y)*(n||1),d=Math.sqrt(c*c+u*u),h=(s.x-l.x)*(a||1),f=(s.y-l.y)*(n||1),v=Math.sqrt(h*h+f*f);if(v||(v=0),v>d){var g=d;d=v,v=g}return{longestDiameter:d.toFixed(1),shortestDiameter:v.toFixed(1)}}(n,Xr(e)),r=a.longestDiameter,o=a.shortestDiameter;n.longestDiameter=r,n.shortestDiameter=o,n.invalidated=!1}}}]),t}(ir),Go=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=y.cornerstone,r=a.metaData.get("patientStudyModule",e.imageId),o=a.metaData.get("generalSeriesModule",e.imageId);if(r&&o){var i=o.modality;if("PT"===i){var s=n?t:t*e.slope+e.intercept,l=r.patientWeight;if(l){var c=a.metaData.get("petIsotopeModule",e.imageId);if(c){var u=c.radiopharmaceuticalInfo,d=u.radiopharmaceuticalStartTime,h=u.radionuclideTotalDose,f=u.radionuclideHalfLife,v=o.seriesTime;if(d&&h&&f&&v){var g=Wo(v.fractionalSeconds||0)+v.seconds+60*v.minutes+60*v.hours*60,p=Wo(d.fractionalSeconds||0)+d.seconds+60*d.minutes+60*d.hours*60,m=g-p,x=h*Math.exp(-m*Math.log(2)/f),T=s*l/x*1e3;return T}}}}}};function Wo(e){return parseFloat(".".concat(e))}var Jo=function(e,t){var n=e.width/2,a=e.height/2;if(n<=0||a<=0)return!1;var r=e.left+n,o=e.top+a,i=t.x-r,s=t.y-o;return i*i/(n*n)+s*s/(a*a)<=1},Yo=function(e,t){for(var n=0,a=0,r=0,o=0,i=null,s=null,l=t.top;l<t.top+t.height;l++)for(var c=t.left;c<t.left+t.width;c++){Jo(t,{x:c,y:l})&&(null===i&&(i=e[o],s=e[o]),n+=e[o],a+=e[o]*e[o],i=Math.min(i,e[o]),s=Math.max(s,e[o]),r++),o++}if(0===r)return{count:r,mean:0,variance:0,stdDev:0,min:0,max:0};var u=n/r,d=a/r-u*u;return{count:r,mean:u,variance:d,stdDev:Math.sqrt(d),min:i,max:s}},Ko={calculateEllipseStatistics:Yo,pointInEllipse:Jo};function Xo(e,t){var n=function(e){var t=[e.start,e.end].sort((function(e,t){return e.x<t.x?-1:1})),n=[e.start,e.end].sort((function(e,t){return e.y<t.y?-1:1})),a=t[0],r=t[t.length-1],o=n[0],i=n[n.length-1];return{top:o,left:a,bottom:i,right:r}}(t),a=(n.left.x+n.right.x)/2,r=(n.top.y+n.bottom.y)/2,o={};return e.rotation>=0&&e.rotation<90&&(o.x=e.hflip?n.left.x:n.right.x,o.y=r),e.rotation>=90&&e.rotation<180&&(o.x=a,o.y=e.vflip?n.bottom.y:n.top.y),e.rotation>=180&&e.rotation<270&&(o.x=e.hflip?n.right.x:n.left.x,o.y=r),e.rotation>=270&&e.rotation<360&&(o.x=a,o.y=e.vflip?n.top.y:n.bottom.y),o}var Zo=function(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")},Qo=H("tools:annotation:CircleRoiTool"),$o=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"CircleRoi",supportedInteractionTypes:["Mouse","Touch"],svgCursor:gr,configuration:{renderDashed:!1,hideHandlesIfMoving:!1}};return(e=u()(this,h()(t).call(this,n,a))).throttledUpdateCachedStats=$r(e.updateCachedStats,110),e}return v()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};Qo.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n,a){var r=t&&t.handles&&t.handles.start&&t.handles.end,o=y.cornerstoneMath.point.distance;if(r||Qo.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!r||!1===t.visible)return!1;var i="mouse"===a?15:25,s=y.cornerstone.pixelToCanvas(e,t.handles.start),l=y.cornerstone.pixelToCanvas(e,t.handles.end),c=o(s,n),u=o(s,l);return c>u-i/2&&c<u+i/2}},{key:"updateCachedStats",value:function(e,t,n){var a=(y.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,r=Xr(e),o=function(e,t,n,a,r){var o,i=ye(n.start,n.end),s=y.cornerstone.getPixels(t,i.left,i.top,i.width,i.height),l=Yo(s,i);"PT"===a&&(o={mean:Go(e,l.mean,!0)||0,stdDev:Go(e,l.stdDev,!0)||0});return{area:Math.PI*(i.width*(r.colPixelSpacing||1)/2)*(i.height*(r.rowPixelSpacing||1)/2)||0,count:l.count||0,mean:l.mean||0,variance:l.variance||0,stdDev:l.stdDev||0,min:l.min||0,max:l.max||0,meanStdDevSUV:o}}(e,t,n.handles,a,r);n.cachedStats=o,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=D(e.currentTarget,this.name);if(n){var a=y.cornerstoneMath.point.distance,r=e.detail,o=r.image,i=r.element,s=r.canvasContext,l=Yt.getToolWidth(),c=this.configuration,u=c.handleRadius,d=c.drawHandlesOnHover,h=c.hideHandlesIfMoving,f=c.renderDashed,v=Cn(s.canvas),g=Xr(o),p=g.rowPixelSpacing,m=g.colPixelSpacing,x=Tt("globalConfiguration").configuration.lineDash,T=(y.cornerstone.metaData.get("generalSeriesModule",o.imageId)||{}).modality,b=p&&m;Gt(v,(function(e){for(var s=0;s<n.data.length;s++){var c=n.data[s];if(!1!==c.visible){var v=un.getColorIfActive(c),g={color:v,handleRadius:u,drawHandlesIfActive:d,hideHandlesIfMoving:h};Mn(e,t.configuration);var p=y.cornerstone.pixelToCanvas(i,c.handles.start),m=y.cornerstone.pixelToCanvas(i,c.handles.end),I=a(p,m),w={color:v};if(f&&(w.lineDash=x),$t(e,i,c.handles.start,I,w,"pixel"),dn(e,r,c.handles,g),!0===c.invalidated&&(c.cachedStats?t.throttledUpdateCachedStats(o,i,c):t.updateCachedStats(o,i,c)),!c.handles.textBox.hasMoved){var C=Xo(r.viewport,c.handles);Object.assign(c.handles.textBox,C)}var E=ti(e,o.color,c.cachedStats,T,b,t.configuration);c.unit=ei(T,t.configuration.showHounsfieldUnits),In(e,i,c.handles.textBox,E,c.handles,(function(e){return t=e.start,n=e.end,a=ye(t,n),r=a.left,o=a.top,i=a.width,s=a.height,[{x:r+i/2,y:o},{x:r,y:o+s/2},{x:r+i/2,y:o+s},{x:r+i,y:o+s/2}];var t,n,a,r,o,i,s}),v,l,10,!0)}}}))}}}]),t}(ir);function ei(e,t){return"CT"===e&&!1!==t?"HU":""}function ti(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.area,r=n.mean,o=n.stdDev,i=n.min,s=n.max,l=n.meanStdDevSUV,c=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},h=d.showMinMax||!1,f=[],v=[];if(!t){var g=l&&0!==l.mean,p=ei(c,d.showHounsfieldUnits),m="Mean: ".concat(Zo(r.toFixed(2))," ").concat(p),y="Std Dev: ".concat(Zo(o.toFixed(2))," ").concat(p);if(g){for(var x=" SUV: ",T="".concat(x).concat(Zo(l.mean.toFixed(2))),b="".concat(x).concat(Zo(l.stdDev.toFixed(2))),I=Math.floor(e.measureText("".concat(y,"     ")).width);e.measureText(m).width<I;)m+=" ";v.push("".concat(m).concat(T)),v.push("".concat(y,"     ").concat(b))}else v.push("".concat(m,"     ").concat(y));if(h){for(var w="Min: ".concat(i," ").concat(p),C="Max: ".concat(s," ").concat(p),E=g?Math.floor(e.measureText("".concat(y,"     ")).width):Math.floor(e.measureText("".concat(m,"     ")).width);e.measureText(w).width<E;)w+=" ";v.push("".concat(w).concat(C))}}return f.push(ni(a,u)),v.forEach((function(e){return f.push(e)})),f}function ni(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(Zo(e.toFixed(2))).concat(n)}var ai=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"CobbAngle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:vr,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(e=u()(this,h()(t).call(this,n,a))).hasIncomplete=!1,e.throttledUpdateCachedStats=$r(e.updateCachedStats,110),e}return v()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){return this.hasIncomplete=!0,{visible:!0,active:!0,color:void 0,invalidated:!0,complete:!1,value:"",handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},start2:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},end2:{x:e.currentPoints.image.x+1,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return!1!==t.visible&&(!this.hasIncomplete&&(sr(e,t.handles.start,t.handles.end,n)<25||sr(e,t.handles.start2,t.handles.end2,n)<25))}},{key:"updateCachedStats",value:function(e,t,n){var a=Xr(e),r=a.rowPixelSpacing,o=a.colPixelSpacing,i=(Math.ceil(n.handles.start.x)-Math.ceil(n.handles.end.x))*(o||1),s=(Math.ceil(n.handles.start.y)-Math.ceil(n.handles.end.y))*(r||1),l=(Math.ceil(n.handles.start2.x)-Math.ceil(n.handles.end2.x))*(o||1),c=(Math.ceil(n.handles.start2.y)-Math.ceil(n.handles.end2.y))*(r||1),u=Math.acos(Math.abs((i*l+s*c)/(Math.sqrt(i*i+s*s)*Math.sqrt(l*l+c*c))));u*=180/Math.PI,n.rAngle=lr(u,2),n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=this.configuration,r=a.handleRadius,o=a.drawHandlesOnHover,i=a.hideHandlesIfMoving,s=a.renderDashed,l=D(e.currentTarget,this.name);if(l)for(var c=Cn(n.canvasContext.canvas),u=Yt.getToolWidth(),d=Tt("globalConfiguration").configuration.lineDash,h=mn.getFont(),f=function(e){var a=l.data[e];if(!1===a.visible)return"continue";Gt(c,(function(e){Mn(e,t.configuration);var l=un.getColorIfActive(a),c={color:l};s&&(c.lineDash=d),Xt(e,n.element,a.handles.start,a.handles.end,c),a.complete&&Xt(e,n.element,a.handles.start2,a.handles.end2,c);var f={color:l,handleRadius:r,drawHandlesIfActive:o,hideHandlesIfMoving:i};t.configuration.drawHandles&&dn(e,n,a.handles,f),e.fillStyle=l;var v=a.value;if(!a.handles.textBox.hasMoved){var p={x:(a.handles.start.x+a.handles.end.x)/2,y:(a.handles.start.y+a.handles.end.y)/2-10};e.font=h,a.handles.textBox.x=p.x,a.handles.textBox.y=p.y}In(e,n.element,a.handles.textBox,v,a.handles,g,l,u,0,!0)}))},v=0;v<l.data.length;v++)f(v);function g(e){return[e.start,e.start2,e.end,e.end2]}}},{key:"getIncomplete",value:function(e){var t=D(e,this.name);if(t&&Array.isArray(t.data))return t.data.find((function(e){return!1===e.complete}))}},{key:"addNewMeasurement",value:function(e,t){var n=this;e.preventDefault(),e.stopPropagation();var a,r,o=e.detail,i=function(e){e||L(s,n.name,a)},s=e.detail.element,l=this.getIncomplete(s);l?((a=l).complete=!0,a.handles.start2={x:o.currentPoints.image.x,y:o.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!1},a.handles.end2={x:o.currentPoints.image.x,y:o.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!0},r=a.handles.end2,this.hasIncomplete=!1,i=function(e){if(e){var t=b.MEASUREMENT_COMPLETED,r={toolName:n.name,toolType:n.name,element:s,measurementData:a};I(s,t,r)}else L(s,n.name,a)}):(a=this.createNewMeasurement(o),_(s,this.name,a),r=a.handles.end),y.cornerstone.updateImage(s),Xa(o,this.name,a,r,this.options,t,i)}},{key:"onMeasureModified",value:function(e){var t=e.detail.element,n=y.cornerstone.getEnabledElement(t).image,a=Xr(n),r=a.rowPixelSpacing,o=a.colPixelSpacing;if(e.detail.toolName===this.name){var i=e.detail.measurementData;!0===i.invalidated&&(i.rAngle?this.throttledUpdateCachedStats(n,t,i):this.updateCachedStats(n,t,i));var s=i.rAngle;i.value="",Number.isNaN(s)||(i.value=function(e,t,n){var a=t&&n?"":" (isotropic)";return e.toString()+String.fromCharCode(parseInt("00B0",16))+a}(s,r,o))}}},{key:"activeCallback",value:function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(b.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"passiveCallback",value:function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(b.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"enabledCallback",value:function(e){e.removeEventListener(b.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"disabledCallback",value:function(e){e.removeEventListener(b.MEASUREMENT_MODIFIED,this.onMeasureModified)}}]),t}(ir),ri=H("tools:annotation:EllipticalRoiTool"),oi=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"EllipticalRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:pr};return(e=u()(this,h()(t).call(this,n,a))).throttledUpdateCachedStats=$r(e.updateCachedStats,110),e}return v()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};ri.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n,a){var r=t&&t.handles&&t.handles.start&&t.handles.end;if(r||ri.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!r||!1===t.visible)return!1;if(ha(e,t.handles,n,6))return!0;var o="mouse"===a?15:25,i=y.cornerstone.pixelToCanvas(e,t.handles.start),s=y.cornerstone.pixelToCanvas(e,t.handles.end),l={left:Math.min(i.x,s.x)+o/2,top:Math.min(i.y,s.y)+o/2,width:Math.abs(i.x-s.x)-o,height:Math.abs(i.y-s.y)-o},c={left:Math.min(i.x,s.x)-o/2,top:Math.min(i.y,s.y)-o/2,width:Math.abs(i.x-s.x)+o,height:Math.abs(i.y-s.y)+o},u=Jo(l,n);return!(!Jo(c,n)||u)}},{key:"updateCachedStats",value:function(e,t,n){var a=(y.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,r=Xr(e),o=function(e,t,n,a,r){var o,i=ci(n.start,n.end),s=y.cornerstone.getPixels(t,i.left,i.top,i.width,i.height),l=Yo(s,i);"PT"===a&&(o={mean:Go(e,l.mean,!0)||0,stdDev:Go(e,l.stdDev,!0)||0});return{area:Math.PI*(i.width*(r.colPixelSpacing||1)/2)*(i.height*(r.rowPixelSpacing||1)/2)||0,count:l.count||0,mean:l.mean||0,variance:l.variance||0,stdDev:l.stdDev||0,min:l.min||0,max:l.max||0,meanStdDevSUV:o}}(e,t,n.handles,a,r);n.cachedStats=o,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=D(e.currentTarget,this.name);if(n){var a=e.detail,r=a.image,o=a.element,i=Yt.getToolWidth(),s=Tt("globalConfiguration").configuration.lineDash,l=this.configuration,c=l.handleRadius,u=l.drawHandlesOnHover,d=l.hideHandlesIfMoving,h=l.renderDashed,f=Cn(a.canvasContext.canvas),v=Xr(r),g=v.rowPixelSpacing,p=v.colPixelSpacing,m=(y.cornerstone.metaData.get("generalSeriesModule",r.imageId)||{}).modality,x=g&&p;Gt(f,(function(e){for(var l=0;l<n.data.length;l++){var f=n.data[l];if(!1!==f.visible){var v=un.getColorIfActive(f),g={color:v,handleRadius:c,drawHandlesIfActive:u,hideHandlesIfMoving:d};Mn(e,t.configuration);var p={color:v};if(h&&(p.lineDash=s),on(e,o,f.handles.start,f.handles.end,p,"pixel",f.handles.initialRotation),dn(e,a,f.handles,g),!0===f.invalidated&&(f.cachedStats?t.throttledUpdateCachedStats(r,o,f):t.updateCachedStats(r,o,f)),!f.handles.textBox.hasMoved){var y=Xo(a.viewport,f.handles);Object.assign(f.handles.textBox,y)}var T=si(e,r.color,f.cachedStats,m,x,t.configuration);f.unit=ii(m,t.configuration.showHounsfieldUnits),In(e,o,f.handles.textBox,T,f.handles,(function(e){return t=e.start,n=e.end,a=ci(t,n),r=a.left,o=a.top,i=a.width,s=a.height,[{x:r+i/2,y:o},{x:r,y:o+s/2},{x:r+i/2,y:o+s},{x:r+i,y:o+s/2}];var t,n,a,r,o,i,s}),v,i,10,!0)}}}))}}}]),t}(ir);function ii(e,t){return"CT"===e&&!1!==t?"HU":""}function si(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.area,r=n.mean,o=n.stdDev,i=n.min,s=n.max,l=n.meanStdDevSUV,c=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},h=d.showMinMax||!1,f=[],v=[];if(!t){var g=l&&0!==l.mean,p=ii(c,d.showHounsfieldUnits),m="Mean: ".concat(Zo(r.toFixed(2))," ").concat(p),y="Std Dev: ".concat(Zo(o.toFixed(2))," ").concat(p);if(g){for(var x=" SUV: ",T="".concat(x).concat(Zo(l.mean.toFixed(2))),b="".concat(x).concat(Zo(l.stdDev.toFixed(2))),I=Math.floor(e.measureText("".concat(y,"     ")).width);e.measureText(m).width<I;)m+=" ";v.push("".concat(m).concat(T)),v.push("".concat(y,"     ").concat(b))}else v.push("".concat(m)),v.push("".concat(y));if(h){for(var w="Min: ".concat(i," ").concat(p),C="Max: ".concat(s," ").concat(p),E=g?Math.floor(e.measureText("".concat(y,"     ")).width):Math.floor(e.measureText("".concat(m,"     ")).width);e.measureText(w).width<E;)w+=" ";v.push("".concat(w).concat(C))}}return f.push(li(a,u)),v.forEach((function(e){return f.push(e)})),f}function li(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(Zo(e.toFixed(2))).concat(n)}function ci(e,t){return{left:Math.round(Math.min(e.x,t.x)),top:Math.round(Math.min(e.y,t.y)),width:Math.round(Math.abs(e.x-t.x)),height:Math.round(Math.abs(e.y-t.y))}}var ui=function(e,t){for(var n=!1,a=e.length-1,r=0;r<e.length;r++)di(t,e[r],e[a])&&(n=!n),a=r;return n};function di(e,t,n){return a=e.y,r=t.y,o=n.y,!(!(r<a&&a<o||o<a&&a<r)||!function(e,t,n){if(t.x>e.x&&n.x>e.x)return!0;if(t.x===n.x)return e.x<t.x;if(t.x>n.x){var a=t;t=n,n=a}var r=function(e,t,n){var a=(n.y-t.y)/(n.x-t.x);return{value:t.y+a*(e.x-t.x),gradient:a}}(e,t,n);return Math.sign(r.gradient)*e.y>Math.sign(r.gradient)*r.value}(e,t,n));var a,r,o}function hi(e,t,n,a){ui(e,t)&&(n.value+=a,n.squared+=a*a,n.count++)}var fi=function e(t,n){i()(this,e),this.toolIndex=t,this.handleIndexArray=n},vi=function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];i()(this,e),this.x=t.x,this.y=t.y,this.highlight=n,this.active=a,this.lines=[]};function gi(e,t,n,a){for(var r=e.length-1,o=0;o<e.length;o++)if(-1===a.indexOf(o)&&-1===a.indexOf(r)){if(pi(t,n,mi(e[r]),mi(e[o])))return!0;r=o}else r=o;return!1}function pi(e,t,n,a){var r=!1,o=[yi(e,t,n),yi(e,t,a),yi(n,a,e),yi(n,a,t)];return o[0]!==o[1]&&o[2]!==o[3]||((0===o[0]&&xi(e,n,t)||0===o[1]&&xi(e,a,t)||0===o[2]&&xi(n,e,a)||0===o[3]&&xi(n,t,a))&&(r=!0),r)}function mi(e){return{x:e.x,y:e.y}}function yi(e,t,n){var a=(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y);return 0===a?0:a>0?1:2}function xi(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}var Ti={newHandle:function(e,t){var n=t.length-1;return gi(t,mi(t[n]),mi(e),[n])},end:function(e){var t=e.length-1;return gi(e,mi(e[t]),mi(e[0]),[t,0])},modify:function(e,t){var n=mi(e[t]),a=t-1;0===t&&(a=e.length-1);var r=mi(e[a]);return!!gi(e,n,r,[t,a])||gi(e,n,r=mi(e[a=t===e.length-1?0:t+1]),[t,a])}},bi=function(){function e(t,n){i()(this,e),this._eventData=t,this._toolName=n}return l()(e,[{key:"findLine",value:function(){var e=this.findTool();if(null===e)return null;var t=this._getCloseLinesInTool(e);return t?this._findCorrectLine(e,t):null}},{key:"findTool",value:function(){return this._toolData=D(this._eventData.element,this._toolName),this._mousePoint=this._eventData.currentPoints.canvas,this._toolData?this._nearestHandleToPointAllTools().toolIndex:null}},{key:"_nearestHandleToPointAllTools",value:function(){for(var e=this._toolData,t={toolIndex:null,handleIndex:null,distance:1/0},n=0;n<e.data.length;n++){var a=this._nearestHandleToPoint(n);null!==a&&(a.distance<t.distance&&(t=a))}return t}},{key:"_nearestHandleToPoint",value:function(e){var t=this._eventData,n=this._toolData.data[e],a=n.handles.points;if(void 0===a)return null;if(!1===n.visible)return null;for(var r={toolIndex:e,handleIndex:null,distance:1/0},o=0;o<a.length;o++){var i=y.cornerstone.pixelToCanvas(t.element,a[o]),s=y.cornerstoneMath.point.distance(i,this._mousePoint);s<r.distance&&(r.handleIndex=o,r.distance=s)}return r}},{key:"_getCloseLinesInTool",value:function(t){for(var n=this._toolData.data[t].handles.points,a=[],r=0;r<n.length;r++){var o=e.getNextHandleIndex(r,n.length);this._distanceOfPointfromLine(n[r],n[o])<10&&a.push([r,o])}return a}},{key:"_findCorrectLine",value:function(e,t){for(var n=0;n<t.length;n++)if(this._pointProjectsToLineSegment(e,t[n]))return new fi(e,t[n]);return null}},{key:"_pointProjectsToLineSegment",value:function(t,n){var a=this._eventData,r=this._toolData.data[t],o=r.handles.points;if(void 0!==r.handles.points){if(!1===r.visible)return!1;var i=o[n[0]],s=o[n[1]],l=e.getCanvasPointsFromHandles(i,s,a.element),c=e.getLineAsVector(l),u=this._getLineOriginToMouseAsVector(l),d=(u[0]*c[0]+u[1]*c[1])/c.magnitude;return d>0&&d<c.magnitude}}},{key:"_getLineOriginToMouseAsVector",value:function(e){return[this._mousePoint.x-e[0].x,this._mousePoint.y-e[0].y]}},{key:"_distanceOfPointfromLine",value:function(e,t){var n=this._eventData,a=y.cornerstone.pixelToCanvas(n.element,e),r=y.cornerstone.pixelToCanvas(n.element,t),o=this._mousePoint;return Math.abs((r.y-a.y)*o.x-(r.x-a.x)*o.y+r.x*a.y-r.y*a.x)/y.cornerstoneMath.point.distance(a,r)}}],[{key:"getCanvasPointsFromHandles",value:function(e,t,n){var a=[];return e.x<t.x?(a.push(y.cornerstone.pixelToCanvas(n,e)),a.push(y.cornerstone.pixelToCanvas(n,t))):(a.push(y.cornerstone.pixelToCanvas(n,t)),a.push(y.cornerstone.pixelToCanvas(n,e))),a}},{key:"getLineAsVector",value:function(e){var t=[e[1].x-e[0].x,e[1].y-e[0].y];return t.magnitude=y.cornerstoneMath.point.distance(e[0],e[1]),t}},{key:"getNextHandleIndex",value:function(e,t){return e<t-1?e+1:0}}]),e}(),Ii=function(e,t){t===e.length-1?e[t].lines.push(e[0]):e[t].lines.push(e[t+1])};function wi(e,t){var n=D(e.element,this.name);if(void 0!==n){var a=t.handleIndex,r=t.toolIndex,o=n.data[r],i=o.handles.points;i.length<=3||(a===i.length-1?(i[a-1].lines.pop(),i[a-1].lines.push(i[0])):0===a?(i[i.length-1].lines.pop(),i[i.length-1].lines.push(i[a+1])):(i[a-1].lines.pop(),i[a-1].lines.push(i[a+1])),i.splice(a,1),o.invalidated=!0,o.active=!0,o.highlight=!0,y.cornerstone.updateImage(e.element))}}function Ci(e,t){var n=D(e.element,this.name);if(void 0!==n){var a=n.data[t.toolIndex],r=function(e){for(var t=e.handleIndexArray,n=1/0,a=t.includes(0),r=0;r<t.length;r++){var o=t[r];0!==o&&o<n&&(n=o)}a&&1===n&&(n=0);return++n}(t);if(r!==1/0){var o=new vi(e.currentPoints.image),i=a.handles.points;i.splice(r,0,o),i[r-1].lines.pop(),i[r-1].lines.push(e.currentPoints.image),Ii(i,r),a.active=!0,a.highlight=!0,a.invalidated=!0,y.cornerstone.updateImage(e.element)}}}var Ei={calculateFreehandStatistics:function(e,t,n){var a={count:0,mean:0,variance:0,stdDev:0},r=function(e,t,n){for(var a={value:0,squared:0,count:0},r=0,o=t.top;o<t.top+t.height;o++)for(var i=t.left;i<t.left+t.width;i++){hi(n,{x:i,y:o},a,e[r]),r++}return a}(e,t,n);return 0===r.count||(a.count=r.count,a.mean=r.value/r.count,a.variance=r.squared/r.count-a.mean*a.mean,a.stdDev=Math.sqrt(a.variance)),a},ClickedLineData:fi,freehandArea:function(e,t){var n=0,a=e.length-1;t=t||1;for(var r=0;r<e.length;r++)n+=(e[a].x+e[r].x)*(e[a].y-e[r].y),a=r;return Math.abs(n*t/2)},FreehandHandleData:vi,freehandIntersect:Ti,FreehandLineFinder:bi,insertOrDelete:function(e,t){var n=e.detail;if(t&&null!==t.handleNearby){var a={toolIndex:t.toolIndex,handleIndex:t.handleNearby};wi.call(this,n,a)}else{var r=new bi(n,this.name).findLine();r&&Ci.call(this,n,r)}},pointInFreehand:ui,addLine:Ii},Mi=H("tools:annotation:FreehandRoiTool"),ki=Ei.insertOrDelete,Si=Ei.freehandArea,Oi=Ei.calculateFreehandStatistics,Pi=Ei.freehandIntersect,_i=Ei.FreehandHandleData,Di=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"FreehandRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{mouseLocation:{handles:{start:{highlight:!0,active:!0}}},spacing:1,activeHandleRadius:3,completeHandleRadius:6,completeHandleRadiusTouch:28,alwaysShowHandles:!1,invalidColor:"crimson",currentHandle:0,currentTool:-1,drawHandles:!0,renderDashed:!1},svgCursor:mr};return(e=u()(this,h()(t).call(this,n,a))).isMultiPartTool=!0,e._drawing=!1,e._dragging=!1,e._modifying=!1,e._drawingMouseDownCallback=e._drawingMouseDownCallback.bind(Ta()(e)),e._drawingMouseMoveCallback=e._drawingMouseMoveCallback.bind(Ta()(e)),e._drawingMouseDragCallback=e._drawingMouseDragCallback.bind(Ta()(e)),e._drawingMouseUpCallback=e._drawingMouseUpCallback.bind(Ta()(e)),e._drawingMouseDoubleClickCallback=e._drawingMouseDoubleClickCallback.bind(Ta()(e)),e._editMouseUpCallback=e._editMouseUpCallback.bind(Ta()(e)),e._editMouseDragCallback=e._editMouseDragCallback.bind(Ta()(e)),e._drawingTouchStartCallback=e._drawingTouchStartCallback.bind(Ta()(e)),e._drawingTouchDragCallback=e._drawingTouchDragCallback.bind(Ta()(e)),e._drawingDoubleTapClickCallback=e._drawingDoubleTapClickCallback.bind(Ta()(e)),e._editTouchDragCallback=e._editTouchDragCallback.bind(Ta()(e)),e.throttledUpdateCachedStats=$r(e.updateCachedStats,110),e}return v()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image){var t={visible:!0,active:!0,invalidated:!0,color:void 0,handles:{points:[]}};return t.handles.textBox={active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0},t}Mi.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){var a=t&&t.handles&&t.handles.points;if(!a)throw new Error("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool"));return!(!a||!1===t.visible)&&void 0!==this._pointNearHandle(e,t,n)}},{key:"distanceFromPoint",value:function(e,t,n){for(var a=1/0,r=0;r<t.handles.points.length;r++){var o=y.cornerstoneMath.point.distance(t.handles.points[r],n);a=Math.min(a,o)}return a===1/0?-1:a}},{key:"distanceFromPointCanvas",value:function(e,t,n){var a=1/0;if(!t)return-1;for(var r=y.cornerstone.pixelToCanvas(e,n),o=t.handles.points,i=0;i<o.length;i++){var s=y.cornerstone.pixelToCanvas(e,o[i]),l=y.cornerstoneMath.point.distance(s,r);a=Math.min(a,l)}return a===1/0?-1:a}},{key:"updateCachedStats",value:function(e,t,n){for(var a,r,o=y.cornerstone.metaData.get("generalSeriesModule",e.imageId),i=o?o.modality:null,s=n.handles.points,l={left:s[0].x,right:s[0].x,bottom:s[0].y,top:s[0].x},c=0;c<s.length;c++)l.left=Math.min(l.left,s[c].x),l.right=Math.max(l.right,s[c].x),l.bottom=Math.min(l.bottom,s[c].y),l.top=Math.max(l.top,s[c].y);var u={left:l.left,top:l.bottom,width:Math.abs(l.right-l.left),height:Math.abs(l.top-l.bottom)};if(n.polyBoundingBox=u,!e.color){var d=y.cornerstone.getPixels(t,u.left,u.top,u.width,u.height);a=Oi.call(this,d,u,n.handles.points),"PT"===i&&(r={mean:Go(e,(a.mean-e.intercept)/e.slope),stdDev:Go(e,(a.stdDev-e.intercept)/e.slope)}),a&&!isNaN(a.mean)&&(n.meanStdDev=a,n.meanStdDevSUV=r)}var h=(e.columnPixelSpacing||1)*(e.rowPixelSpacing||1),f=Si(n.handles.points,h);isNaN(f)||(n.area=f),n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=D(e.currentTarget,this.name);if(a)for(var r=n.image,o=n.element,i=this.configuration,s=y.cornerstone.metaData.get("generalSeriesModule",r.imageId),l=s?s.modality:null,c=Cn(n.canvasContext.canvas),u=Yt.getToolWidth(),d=i.renderDashed,h=Tt("globalConfiguration").configuration.lineDash,f=function(e){var s=a.data[e];if(!1===s.visible)return"continue";Gt(c,(function(e){var a,l=un.getColorIfActive(s);s.active?s.handles.invalidHandlePlacement?(l=i.invalidColor,a=i.invalidColor):(l=un.getColorIfActive(s),a=un.getFillColor()):a=un.getToolColor();var c={color:l};if(d&&(c.lineDash=h),s.handles.points.length){var f=s.handles.points;Zt(e,o,f[0],f,c),s.polyBoundingBox?Zt(e,o,f[f.length-1],[f[0]],c):Zt(e,o,f[f.length-1],[i.mouseLocation.handles.start],c)}if(c={color:l,fill:a},(i.alwaysShowHandles||s.active&&s.polyBoundingBox)&&(c.handleRadius=i.activeHandleRadius,t.configuration.drawHandles&&dn(e,n,s.handles.points,c)),s.canComplete){c.handleRadius=i.completeHandleRadius;var v=s.handles.points[0];t.configuration.drawHandles&&dn(e,n,[v],c)}if(s.active&&!s.polyBoundingBox){c.handleRadius=i.activeHandleRadius,t.configuration.drawHandles&&dn(e,n,i.mouseLocation.handles,c);var m=s.handles.points[0];t.configuration.drawHandles&&dn(e,n,[m],c)}if(!0!==s.invalidated||s.active||(s.meanStdDev&&s.meanStdDevSUV&&s.area?t.throttledUpdateCachedStats(r,o,s):t.updateCachedStats(r,o,s)),s.polyBoundingBox&&!s.handles.textBox.freehand){s.handles.textBox.hasMoved||(s.handles.textBox.x=s.polyBoundingBox.left+s.polyBoundingBox.width,s.handles.textBox.y=s.polyBoundingBox.top+s.polyBoundingBox.height/2);var y=g.call(t,s);In(e,o,s.handles.textBox,y,s.handles.points,p,l,u,0,!0)}}))},v=0;v<a.data.length;v++)f(v);function g(e){var t=e.meanStdDev,n=e.meanStdDevSUV,a=e.area,o=[];if(t&&void 0!==t.mean){var i="";"CT"===l&&(i="HU"),e.unit=i;var s="Mean: ".concat(Zo(t.mean.toFixed(2))," ").concat(i),c="StdDev: ".concat(Zo(t.stdDev.toFixed(2))," ").concat(i);if(n&&void 0!==n.mean){s+=" SUV: "+Zo(n.mean.toFixed(2)),c+=" SUV: "+Zo(n.stdDev.toFixed(2))}o.push(s),o.push(c)}if(a){var u=" mm".concat(String.fromCharCode(178));r.rowPixelSpacing&&r.columnPixelSpacing||(u=" pixels".concat(String.fromCharCode(178)));var d="Area: ".concat(Zo(a.toFixed(2))).concat(u);o.push(d)}return o}function p(e){return e}}},{key:"addNewMeasurement",value:function(e){var t=e.detail;this._startDrawing(e),this._addPoint(t),Li(e)}},{key:"preMouseDownCallback",value:function(e){var t=e.detail,n=this._pointNearHandleAllTools(t);return!!t.event.ctrlKey&&(void 0!==n&&n.handleNearby.hasBoundingBox||ki.call(this,e,n),Li(e),!0)}},{key:"handleSelectedCallback",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",r=e.detail.element,o=D(r,this.name);if(n.hasBoundingBox)nr(e,this,t,n,a);else{var i=this.configuration;i.dragOrigin={x:n.x,y:n.y};for(var s=0;s<o.data.length;s++)for(var l=o.data[s].handles.points,c=0;c<l.length;c++)l[c]===n&&(i.currentHandle=c,i.currentTool=s);this._modifying=!0,this._activateModify(r),Li(e)}}},{key:"_drawingMouseMoveCallback",value:function(e){var t=e.detail,n=t.currentPoints,a=t.element,r=D(a,this.name),o=this.configuration,i=o.currentTool,s=r.data[i],l=n.canvas;this._getMouseLocation(t),this._checkInvalidHandleLocation(s,t);var c=this._pointNearHandle(a,s,l),u=s.handles.points;void 0!==c&&!c.hasBoundingBox&&c<u.length-1&&(o.mouseLocation.handles.start.x=u[c].x,o.mouseLocation.handles.start.y=u[c].y),y.cornerstone.updateImage(a)}},{key:"_drawingMouseDragCallback",value:function(e){this.options.mouseButtonMask.includes(e.detail.buttons)&&this._drawingDrag(e)}},{key:"_drawingTouchDragCallback",value:function(e){this._drawingDrag(e)}},{key:"_drawingDrag",value:function(e){var t=e.detail,n=t.element,a=D(n,this.name),r=this.configuration.currentTool,o=a.data[r];this._getMouseLocation(t),this._checkInvalidHandleLocation(o,t),this._addPointPencilMode(t,o.handles.points),this._dragging=!0,y.cornerstone.updateImage(n)}},{key:"_drawingMouseUpCallback",value:function(e){var t=e.detail.element;if(this._dragging){this._dragging=!1;var n=this.configuration,a=n.currentTool,r=D(t,this.name).data[a];if(!Pi.end(r.handles.points)&&r.canComplete){var o=n.currentHandle;this._endDrawing(t,o)}Li(e)}}},{key:"_drawingMouseDownCallback",value:function(e){var t=e.detail,n=t.buttons,a=t.currentPoints,r=t.element;if(this.options.mouseButtonMask.includes(n)){var o=a.canvas,i=this.configuration,s=i.currentTool,l=D(r,this.name).data[s],c=this._pointNearHandle(r,l,o);if(!Pi.end(l.handles.points)&&l.canComplete){var u=i.currentHandle;this._endDrawing(r,u)}else void 0===c&&this._addPoint(t);Li(e)}}},{key:"_drawingTouchStartCallback",value:function(e){var t=e.detail,n=t.currentPoints,a=t.element,r=n.canvas,o=this.configuration,i=o.currentTool,s=D(a,this.name).data[i],l=this._pointNearHandle(a,s,r);if(!Pi.end(s.handles.points)&&s.canComplete){var c=o.currentHandle;this._endDrawing(a,c)}else void 0===l&&this._addPoint(t);Li(e)}},{key:"completeDrawing",value:function(e){if(this._drawing){var t=D(e,this.name),n=this.configuration,a=t.data[n.currentTool];if(!Pi.end(a.handles.points)&&a.handles.points.length>=2){var r=n.currentHandle;a.polyBoundingBox={},this._endDrawing(e,r)}}}},{key:"_drawingMouseDoubleClickCallback",value:function(e){var t=e.detail.element;this.completeDrawing(t),Li(e)}},{key:"_drawingDoubleTapClickCallback",value:function(e){var t=e.detail.element;this.completeDrawing(t),Li(e)}},{key:"_editMouseDragCallback",value:function(e){var t=e.detail,n=t.element,a=t.buttons;if(this.options.mouseButtonMask.includes(a)){var r,o=D(n,this.name),i=this.configuration,s=o.data[i.currentTool],l=i.currentHandle,c=s.handles.points;if(this._getMouseLocation(t),s.handles.invalidHandlePlacement=Pi.modify(c,l),s.active=!0,s.highlight=!0,c[l].x=i.mouseLocation.handles.start.x,c[l].y=i.mouseLocation.handles.start.y,r=this._getPrevHandleIndex(l,c),l>=0){var u=c[r].lines.length-1,d=c[r].lines[u];d.x=i.mouseLocation.handles.start.x,d.y=i.mouseLocation.handles.start.y}y.cornerstone.updateImage(n)}}},{key:"_editTouchDragCallback",value:function(e){var t,n=e.detail,a=n.element,r=D(a,this.name),o=this.configuration,i=r.data[o.currentTool],s=o.currentHandle,l=i.handles.points;if(this._getMouseLocation(n),i.handles.invalidHandlePlacement=Pi.modify(l,s),i.active=!0,i.highlight=!0,l[s].x=o.mouseLocation.handles.start.x,l[s].y=o.mouseLocation.handles.start.y,t=this._getPrevHandleIndex(s,l),s>=0){var c=l[t].lines.length-1,u=l[t].lines[c];u.x=o.mouseLocation.handles.start.x,u.y=o.mouseLocation.handles.start.y}y.cornerstone.updateImage(a)}},{key:"_getPrevHandleIndex",value:function(e,t){return 0===e?t.length-1:e-1}},{key:"_editMouseUpCallback",value:function(e){var t=e.detail,n=t.element,a=D(n,this.name);this._deactivateModify(n),this._dropHandle(t,a),this._endDrawing(n),y.cornerstone.updateImage(n)}},{key:"_dropHandle",value:function(e,t){var n=this.configuration,a=n.currentTool,r=t.data[a].handles,o=r.points;if(r.invalidHandlePlacement){var i,s=n.currentHandle,l=o[s];if(0===s)i=o[o.length-1];else i=o[s-1];l.x=n.dragOrigin.x,l.y=n.dragOrigin.y,i.lines[0]=l,r.invalidHandlePlacement=!1}}},{key:"_startDrawing",value:function(e){var t,n=e.detail,a=this.createNewMeasurement(n),r=n.element,o=this.configuration;e.type===b.MOUSE_DOWN_ACTIVATE?t="Mouse":e.type===b.TOUCH_START_ACTIVE&&(t="Touch"),this._activateDraw(r,t),this._getMouseLocation(n),_(r,this.name,a);var i=D(r,this.name);o.currentTool=i.data.length-1,this._activeDrawingToolReference=i.data[o.currentTool]}},{key:"_addPoint",value:function(e){var t=e.currentPoints,n=e.element,a=D(n,this.name),r=this.configuration,o=a.data[r.currentTool];if(!o.handles.invalidHandlePlacement){var i=new _i(t.image);o.handles.points.length&&o.handles.points[r.currentHandle-1].lines.push(t.image),o.handles.points.push(i),r.currentHandle+=1,y.cornerstone.updateImage(n),this.fireModifiedEvent(n,o)}}},{key:"_addPointPencilMode",value:function(e,t){var n=this,a=this.configuration,r=e.element,o=a.mouseLocation.handles.start;t.every((function(e){return n._isDistanceLargerThanSpacing(r,e,o)}))&&this._addPoint(e)}},{key:"_endDrawing",value:function(e,t){var n=D(e,this.name),a=this.configuration,r=n.data[a.currentTool];if(r.active=!1,r.highlight=!1,r.handles.invalidHandlePlacement=!1,void 0!==t){var o=r.handles.points;o[a.currentHandle-1].lines.push(o[0])}this._modifying&&(this._modifying=!1,r.invalidated=!0),a.currentHandle=0,a.currentTool=-1,r.canComplete=!1,this._drawing&&this._deactivateDraw(e),y.cornerstone.updateImage(e),this.fireModifiedEvent(e,r),this.fireCompletedEvent(e,r)}},{key:"_pointNearHandle",value:function(e,t,n){if(void 0!==t.handles&&void 0!==t.handles.points&&!1!==t.visible){for(var a=0;a<t.handles.points.length;a++){var r=y.cornerstone.pixelToCanvas(e,t.handles.points[a]);if(y.cornerstoneMath.point.distance(r,n)<6)return a}return t.handles.textBox&&ua(t.handles.textBox,n)?t.handles.textBox:void 0}}},{key:"_pointNearHandleAllTools",value:function(e){var t=e.currentPoints,n=e.element,a=t.canvas,r=D(n,this.name);if(r)for(var o,i=0;i<r.data.length;i++)if(void 0!==(o=this._pointNearHandle(n,r.data[i],a)))return{handleNearby:o,toolIndex:i}}},{key:"_getMouseLocation",value:function(e){var t=e.currentPoints,n=e.image,a=this.configuration;a.mouseLocation.handles.start.x=t.image.x,a.mouseLocation.handles.start.y=t.image.y,pa(a.mouseLocation.handles.start,n)}},{key:"_checkInvalidHandleLocation",value:function(e,t){if(e.handles.points.length<2)return!0;var n;n=this._dragging?this._checkHandlesPencilMode(e,t):this._checkHandlesPolygonMode(e,t),e.handles.invalidHandlePlacement=n}},{key:"_checkHandlesPolygonMode",value:function(e,t){var n=this.configuration,a=t.element,r=n.mouseLocation.handles.start,o=e.handles.points,i=!1;return e.canComplete=!1,this._isDistanceSmallerThanCompleteSpacingCanvas(a,o[0],r)&&!Pi.end(o)&&o.length>2?(e.canComplete=!0,i=!1):i=Pi.newHandle(r,o),i}},{key:"_checkHandlesPencilMode",value:function(e,t){var n=this.configuration.mouseLocation.handles.start,a=e.handles.points,r=Pi.newHandle(n,a);return!1===r&&(r=this._invalidHandlePencilMode(e,t)),r}},{key:"_invalidHandlePencilMode",value:function(e,t){var n=this.configuration,a=t.element,r=n.mouseLocation.handles.start,o=e.handles.points;if(this._isDistanceSmallerThanCompleteSpacingCanvas(a,o[0],r))return e.canComplete=!0,!1;e.canComplete=!1;for(var i=1;i<o.length-1;i++)if(this._isDistanceSmallerThanSpacing(a,o[i],r))return!0;return!1}},{key:"_isDistanceSmallerThanCompleteSpacingCanvas",value:function(e,t,n){var a,r=y.cornerstone.pixelToCanvas(e,t),o=y.cornerstone.pixelToCanvas(e,n);return"Mouse"===this._drawingInteractionType?a=this.configuration.completeHandleRadius:"Touch"===this._drawingInteractionType&&(a=this.configuration.completeHandleRadiusTouch),this._compareDistanceToSpacing(e,r,o,"<",a)}},{key:"_isDistanceSmallerThanSpacing",value:function(e,t,n){return this._compareDistanceToSpacing(e,t,n,"<")}},{key:"_isDistanceLargerThanSpacing",value:function(e,t,n){return this._compareDistanceToSpacing(e,t,n,">")}},{key:"_compareDistanceToSpacing",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:">",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.configuration.spacing;return">"===a?y.cornerstoneMath.point.distance(t,n)>r:y.cornerstoneMath.point.distance(t,n)<r}},{key:"_activateDraw",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Mouse";this._drawing=!0,this._drawingInteractionType=t,mt.isMultiPartToolActive=!0,Et(this.element),e.addEventListener(b.MOUSE_DOWN,this._drawingMouseDownCallback),e.addEventListener(b.MOUSE_MOVE,this._drawingMouseMoveCallback),e.addEventListener(b.MOUSE_DOUBLE_CLICK,this._drawingMouseDoubleClickCallback),e.addEventListener(b.MOUSE_DRAG,this._drawingMouseDragCallback),e.addEventListener(b.MOUSE_UP,this._drawingMouseUpCallback),e.addEventListener(b.TOUCH_START,this._drawingMouseMoveCallback),e.addEventListener(b.TOUCH_START,this._drawingTouchStartCallback),e.addEventListener(b.TOUCH_DRAG,this._drawingTouchDragCallback),e.addEventListener(b.TOUCH_END,this._drawingMouseUpCallback),e.addEventListener(b.DOUBLE_TAP,this._drawingDoubleTapClickCallback),y.cornerstone.updateImage(e)}},{key:"_deactivateDraw",value:function(e){this._drawing=!1,mt.isMultiPartToolActive=!1,this._activeDrawingToolReference=null,this._drawingInteractionType=null,Ct(this.element,this.svgCursor),e.removeEventListener(b.MOUSE_DOWN,this._drawingMouseDownCallback),e.removeEventListener(b.MOUSE_MOVE,this._drawingMouseMoveCallback),e.removeEventListener(b.MOUSE_DOUBLE_CLICK,this._drawingMouseDoubleClickCallback),e.removeEventListener(b.MOUSE_DRAG,this._drawingMouseDragCallback),e.removeEventListener(b.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(b.TOUCH_START,this._drawingTouchStartCallback),e.removeEventListener(b.TOUCH_DRAG,this._drawingTouchDragCallback),e.removeEventListener(b.TOUCH_START,this._drawingMouseMoveCallback),e.removeEventListener(b.TOUCH_END,this._drawingMouseUpCallback),y.cornerstone.updateImage(e)}},{key:"_activateModify",value:function(e){mt.isToolLocked=!0,e.addEventListener(b.MOUSE_UP,this._editMouseUpCallback),e.addEventListener(b.MOUSE_DRAG,this._editMouseDragCallback),e.addEventListener(b.MOUSE_CLICK,this._editMouseUpCallback),e.addEventListener(b.TOUCH_END,this._editMouseUpCallback),e.addEventListener(b.TOUCH_DRAG,this._editTouchDragCallback),y.cornerstone.updateImage(e)}},{key:"_deactivateModify",value:function(e){mt.isToolLocked=!1,e.removeEventListener(b.MOUSE_UP,this._editMouseUpCallback),e.removeEventListener(b.MOUSE_DRAG,this._editMouseDragCallback),e.removeEventListener(b.MOUSE_CLICK,this._editMouseUpCallback),e.removeEventListener(b.TOUCH_END,this._editMouseUpCallback),e.removeEventListener(b.TOUCH_DRAG,this._editTouchDragCallback),y.cornerstone.updateImage(e)}},{key:"passiveCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"enabledCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"disabledCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"_closeToolIfDrawing",value:function(e){if(this._drawing){var t=this.configuration.currentHandle;this._endDrawing(e,t),y.cornerstone.updateImage(e)}}},{key:"fireModifiedEvent",value:function(e,t){I(e,b.MEASUREMENT_MODIFIED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})}},{key:"fireCompletedEvent",value:function(e,t){I(e,b.MEASUREMENT_COMPLETED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})}},{key:"cancelDrawing",value:function(e){if(this._drawing){var t=D(e,this.name),n=this.configuration,a=t.data[n.currentTool];a.active=!1,a.highlight=!1,a.handles.invalidHandlePlacement=!1,n.currentHandle=0,n.currentTool=-1,a.canComplete=!1,L(e,this.name,a),this._deactivateDraw(e),y.cornerstone.updateImage(e)}}},{key:"newImageCallback",value:function(e){var t=this.configuration;if(this._drawing&&this._activeDrawingToolReference){var n=e.detail.element,a=this._activeDrawingToolReference;a.active=!1,a.highlight=!1,a.handles.invalidHandlePlacement=!1;var r=a.handles.points;r[t.currentHandle-1].lines.push(r[0]),t.currentHandle=0,t.currentTool=-1,a.canComplete=!1,this._deactivateDraw(n),y.cornerstone.updateImage(n)}}},{key:"spacing",get:function(){return this.configuration.spacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand spacing to a value other than a number.");this.configuration.spacing=e,y.cornerstone.updateImage(this.element)}},{key:"activeHandleRadius",get:function(){return this.configuration.activeHandleRadius},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand activeHandleRadius to a value other than a number.");this.configuration.activeHandleRadius=e,y.cornerstone.updateImage(this.element)}},{key:"completeHandleRadius",get:function(){return this.configuration.completeHandleRadius},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand completeHandleRadius to a value other than a number.");this.configuration.completeHandleRadius=e,y.cornerstone.updateImage(this.element)}},{key:"alwaysShowHandles",get:function(){return this.configuration.alwaysShowHandles},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehand alwaysShowHandles to a value other than a boolean.");this.configuration.alwaysShowHandles=e,y.cornerstone.updateImage(this.element)}},{key:"invalidColor",get:function(){return this.configuration.invalidColor},set:function(e){this.configuration.invalidColor=e,y.cornerstone.updateImage(this.element)}}]),t}(ir);function Li(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}var Ai=H("tools:annotation:LengthTool"),Ri=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"Length",supportedInteractionTypes:["Mouse","Touch"],svgCursor:xr,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(e=u()(this,h()(t).call(this,n,a))).throttledUpdateCachedStats=$r(e.updateCachedStats,110),e}return v()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image){var t=e.currentPoints.image,n=t.x,a=t.y;return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:n,y:a,highlight:!0,active:!1},end:{x:n,y:a,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}Ai.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){return t&&t.handles&&t.handles.start&&t.handles.end?!1!==t.visible&&sr(e,t.handles.start,t.handles.end,n)<25:(Ai.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!1)}},{key:"updateCachedStats",value:function(e,t,n){var a=Xr(e),r=a.rowPixelSpacing,o=a.colPixelSpacing,i=(n.handles.end.x-n.handles.start.x)*(o||1),s=(n.handles.end.y-n.handles.start.y)*(r||1),l=Math.sqrt(i*i+s*s);n.length=l,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=this.configuration,r=a.handleRadius,o=a.drawHandlesOnHover,i=a.hideHandlesIfMoving,s=a.renderDashed,l=D(e.currentTarget,this.name);if(l)for(var c=Cn(n.canvasContext.canvas),u=n.image,d=n.element,h=Xr(u),f=h.rowPixelSpacing,v=h.colPixelSpacing,g=Yt.getToolWidth(),p=Tt("globalConfiguration").configuration.lineDash,m=function(e){var a=l.data[e];if(!1===a.visible)return"continue";Gt(c,(function(e){Mn(e,t.configuration);var l=un.getColorIfActive(a),c={color:l};s&&(c.lineDash=p),Xt(e,d,a.handles.start,a.handles.end,c);var h={color:l,handleRadius:r,drawHandlesIfActive:o,hideHandlesIfMoving:i};if(t.configuration.drawHandles&&dn(e,n,a.handles,h),!a.handles.textBox.hasMoved){var m={x:Math.max(a.handles.start.x,a.handles.end.x)};m.x===a.handles.start.x?m.y=a.handles.start.y:m.y=a.handles.end.y,a.handles.textBox.x=m.x,a.handles.textBox.y=m.y}!0===a.invalidated&&(a.length?t.throttledUpdateCachedStats(u,d,a):t.updateCachedStats(u,d,a));var y=function(e,t,n){var a=(r=e.length,o=Number(r),isNaN(o)?void 0:o);var r,o;if(!a)return"";var i="mm";t&&n||(i="pixels");return e.unit=i,"".concat(a.toFixed(2)," ").concat(i)}(a,f,v);In(e,d,a.handles.textBox,y,a.handles,x,l,g,10,!0)}))},y=0;y<l.data.length;y++)m(y);function x(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}}}]),t}(ir);var Ui=function(e,t,n,a,r){if(!e)throw new Error("getRGBPixels: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var o,i,s,l=y.cornerstone.getEnabledElement(e),c=[],u=0,d=l.image.getPixelData();if(l.image.color)for(i=0;i<r;i++)for(s=0;s<a;s++){var h=d[o=4*((i+n)*l.image.columns+(s+t))],f=d[o+1],v=d[o+2],g=d[o+3];c[u++]=h,c[u++]=f,c[u++]=v,c[u++]=g}return c},Bi=H("tools:annotation:ProbeTool"),Hi=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"Probe",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Tr,configuration:{drawHandles:!0,renderDashed:!1}};return(e=u()(this,h()(t).call(this,n,a))).throttledUpdateCachedStats=$r(e.updateCachedStats,110),e}return v()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}};Bi.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){var a=t&&t.handles&&t.handles.end;if(a||Bi.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!a||!1===t.visible)return!1;var r=y.cornerstone.pixelToCanvas(e,t.handles.end);return y.cornerstoneMath.point.distance(r,n)<5}},{key:"updateCachedStats",value:function(e,t,n){var a=Math.round(n.handles.end.x),r=Math.round(n.handles.end.y),o={};a>=0&&r>=0&&a<e.columns&&r<e.rows&&(o.x=a,o.y=r,e.color?o.storedPixels=Ui(t,a,r,1,1):(o.storedPixels=y.cornerstone.getStoredPixels(t,a,r,1,1),o.sp=o.storedPixels[0],o.mo=o.sp*e.slope+e.intercept,o.suv=Go(e,o.sp))),n.cachedStats=o,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=this.configuration,r=a.handleRadius,o=a.renderDashed,i=D(e.currentTarget,this.name);if(i)for(var s=Cn(n.canvasContext.canvas),l=n.image,c=n.element,u=mn.getFontSize(),d=Tt("globalConfiguration").configuration.lineDash,h=function(e){var a=i.data[e];if(!1===a.visible)return"continue";Gt(s,(function(e){var i,s,h=un.getColorIfActive(a);if(t.configuration.drawHandles){var f={handleRadius:r,color:h};o&&(f.lineDash=d),dn(e,n,a.handles,f)}!0===a.invalidated&&(a.cachedStats?t.throttledUpdateCachedStats(l,c,a):t.updateCachedStats(l,c,a));var v=a.cachedStats,g=v.x,p=v.y,m=v.storedPixels,x=v.sp,T=v.mo,b=v.suv;if(g>=0&&p>=0&&g<l.columns&&p<l.rows){i="".concat(g,", ").concat(p),l.color?s="R: ".concat(m[0]," G: ").concat(m[1]," B: ").concat(m[2]):(s="SP: ".concat(x," MO: ").concat(parseFloat(T.toFixed(3))),b&&(s+=" SUV: ".concat(parseFloat(b.toFixed(3)))));var I={x:a.handles.end.x+3,y:a.handles.end.y-3},w=y.cornerstone.pixelToCanvas(n.element,I);bn(e,s,w.x,w.y+u+5,h),bn(e,i,w.x,w.y,h)}}))},f=0;f<i.data.length;f++)h(f)}}]),t}(ir),Ni=H("tools:annotation:RectangleRoiTool"),Fi=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"RectangleRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:br};return(e=u()(this,h()(t).call(this,n,a))).throttledUpdateCachedStats=$r(e.updateCachedStats,110),e}return v()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};Ni.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n,a){var r=t&&t.handles&&t.handles.start&&t.handles.end;if(r||Ni.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!r||!1===t.visible)return!1;var o="mouse"===a?15:25,i=y.cornerstone.pixelToCanvas(e,t.handles.start),s=y.cornerstone.pixelToCanvas(e,t.handles.end),l={left:Math.min(i.x,s.x),top:Math.min(i.y,s.y),width:Math.abs(i.x-s.x),height:Math.abs(i.y-s.y)};return y.cornerstoneMath.rect.distanceToPoint(l,n)<o}},{key:"updateCachedStats",value:function(e,t,n){var a=(y.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,r=Xr(e),o=function(e,t,n,a,r){var o,i=Vi(n.start,n.end),s=function(e,t){for(var n=0,a=0,r=0,o=0,i=e?e[0]:null,s=e?e[0]:null,l=t.top;l<t.top+t.height;l++)for(var c=t.left;c<t.left+t.width;c++)n+=e[o],a+=e[o]*e[o],i=Math.min(i,e[o]),s=Math.max(s,e[o]),r++,o++;if(0===r)return{count:r,mean:0,variance:0,stdDev:0,min:0,max:0};var u=n/r,d=a/r-u*u;return{count:r,mean:u,variance:d,stdDev:Math.sqrt(d),min:i,max:s}}(y.cornerstone.getPixels(t,i.left,i.top,i.width,i.height),i);"PT"===a&&(o={mean:Go(e,s.mean,!0)||0,stdDev:Go(e,s.stdDev,!0)||0});return{area:i.width*(r.colPixelSpacing||1)*(i.height*(r.rowPixelSpacing||1))||0,count:s.count||0,mean:s.mean||0,variance:s.variance||0,stdDev:s.stdDev||0,min:s.min||0,max:s.max||0,meanStdDevSUV:o}}(e,t,n.handles,a,r);n.cachedStats=o,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=D(e.currentTarget,this.name);if(n){var a=e.detail,r=a.image,o=a.element,i=Yt.getToolWidth(),s=Tt("globalConfiguration").configuration.lineDash,l=this.configuration,c=l.handleRadius,u=l.drawHandlesOnHover,d=l.hideHandlesIfMoving,h=l.renderDashed,f=Cn(a.canvasContext.canvas),v=Xr(r),g=v.rowPixelSpacing,p=v.colPixelSpacing,m=(y.cornerstone.metaData.get("generalSeriesModule",r.imageId)||{}).modality,x=g&&p;Gt(f,(function(e){for(var l=0;l<n.data.length;l++){var f=n.data[l];if(!1!==f.visible){var v=un.getColorIfActive(f),g={color:v,handleRadius:c,drawHandlesIfActive:u,hideHandlesIfMoving:d};Mn(e,t.configuration);var p={color:v};if(h&&(p.lineDash=s),wn(e,o,f.handles.start,f.handles.end,p,"pixel",f.handles.initialRotation),t.configuration.drawHandles&&dn(e,a,f.handles,g),!0===f.invalidated&&(f.cachedStats?t.throttledUpdateCachedStats(r,o,f):t.updateCachedStats(r,o,f)),!f.handles.textBox.hasMoved){var y=Xo(a.viewport,f.handles);Object.assign(f.handles.textBox,y)}var T=zi(e,r.color,f.cachedStats,m,x,t.configuration);f.unit=qi(m,t.configuration.showHounsfieldUnits),In(e,o,f.handles.textBox,T,f.handles,(function(e){return t=e.start,n=e.end,a=Vi(t,n),r=a.left,o=a.top,i=a.width,s=a.height,[{x:r+i/2,y:o},{x:r,y:o+s/2},{x:r+i/2,y:o+s},{x:r+i,y:o+s/2}];var t,n,a,r,o,i,s}),v,i,10,!0)}}}))}}}]),t}(ir);function Vi(e,t){return{left:Math.min(e.x,t.x),top:Math.min(e.y,t.y),width:Math.abs(e.x-t.x),height:Math.abs(e.y-t.y)}}function ji(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(Zo(e.toFixed(2))).concat(n)}function qi(e,t){return"CT"===e&&!1!==t?"HU":""}function zi(e,t,n,a,r){var o=n.area,i=n.mean,s=n.stdDev,l=n.min,c=n.max,u=n.meanStdDevSUV,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},h=d.showMinMax||!1,f=[],v=[];if(!t){var g=u&&0!==u.mean,p=qi(a,d.showHounsfieldUnits),m="Mean: ".concat(Zo(i.toFixed(2))," ").concat(p),y="Std Dev: ".concat(Zo(s.toFixed(2))," ").concat(p);if(g){for(var x=" SUV: ",T="".concat(x).concat(Zo(u.mean.toFixed(2))),b="".concat(x).concat(Zo(u.stdDev.toFixed(2))),I=Math.floor(e.measureText("".concat(y,"     ")).width);e.measureText(m).width<I;)m+=" ";v.push("".concat(m).concat(T)),v.push("".concat(y,"     ").concat(b))}else v.push("".concat(m)),v.push("".concat(y));if(h){for(var w="Min: ".concat(l," ").concat(p),C="Max: ".concat(c," ").concat(p),E=g?Math.floor(e.measureText("".concat(y,"     ")).width):Math.floor(e.measureText("".concat(m,"     ")).width);e.measureText(w).width<E;)w+=" ";v.push("".concat(w).concat(C))}}return f.push(ji(o,r)),v.forEach((function(e){return f.push(e)})),f}var Gi=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"TextMarker",supportedInteractionTypes:["Mouse","Touch"],configuration:{markers:[],current:"",ascending:!0,loop:!1,changeTextCallback:Wi},svgCursor:Ir};return(e=u()(this,h()(t).call(this,n,a))).touchPressCallback=e._changeText.bind(Ta()(e)),e.doubleClickCallback=e._changeText.bind(Ta()(e)),e}return v()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){var t=this.configuration;if(t.current){var n={visible:!0,active:!0,text:t.current,color:void 0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,hasBoundingBox:!0}}},a={left:0,top:0,width:e.image.width,height:e.image.height};if(y.cornerstoneMath.point.insideRect(n.handles.end,a)){var r=t.markers.indexOf(t.current);return(r+=t.ascending?1:-1)>=t.markers.length?r=t.loop?0:-1:r<0&&(r=t.loop?t.markers.length:-1),t.current=t.markers[r],n}}}},{key:"pointNearTool",value:function(e,t,n){if(!1===t.visible)return!1;if(t.handles.end.boundingBox){var a=y.cornerstoneMath.rect.distanceToPoint(t.handles.end.boundingBox,n),r=ua(t.handles.end,n);return a<10||r}}},{key:"updateCachedStats",value:function(){}},{key:"renderToolData",value:function(e){var t=e.detail,n=this.configuration,a=D(t.element,this.name);if(a)for(var r=Cn(t.canvasContext.canvas),o=function(e){var o=a.data[e];if(!1===o.visible)return"continue";var i=un.getColorIfActive(o);Gt(r,(function(e){Mn(e,n);var a=y.cornerstone.pixelToCanvas(t.element,o.handles.end);o.handles.end.boundingBox=bn(e,o.text,a.x,a.y-10,i,{centering:{x:!0,y:!0}})}))},i=0;i<a.data.length;i++)o(i)}},{key:"_changeText",value:function(e){var t,n=e.detail,a=n.element,r=n.currentPoints;function o(e,t,n){!0===n?L(a,this.name,e):e.text=t,e.active=!1,y.cornerstone.updateImage(a)}var i=this.configuration,s=r.canvas,l=D(a,this.name);if(l)for(var c=0;c<l.data.length;c++)if(t=l.data[c],this.pointNearTool(a,t,s))return t.active=!0,y.cornerstone.updateImage(a),i.changeTextCallback(t,n,o),e.stopImmediatePropagation(),e.preventDefault(),void e.stopPropagation()}}]),t}(ir),Wi=function(e,t,n){n(e,prompt("Change your annotation:"))},Ji=(H("tools:BrushTool"),Tt("segmentation")),Yi=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"Brush",supportedInteractionTypes:["Mouse","Touch"],configuration:{},mixins:["renderBrushMixin"]};return(e=u()(this,h()(t).call(this,n,a))).touchDragCallback=e._paint.bind(Ta()(e)),e}return v()(t,e),l()(t,[{key:"_paint",value:function(e){var t=Ji.configuration,n=e.detail,a=(n.element,n.image),r=a.rows,o=a.columns,i=n.currentPoints.image,s=i.x,l=i.y;if(!(s<0||s>o||l<0||l>r)){var c=be(t.radius,r,o,s,l),u=this.paintEventData,d=u.labelmap2D,h=u.labelmap3D,f=u.shouldErase;te(c,d.pixelData,h.activeSegmentIndex,o,f),y.cornerstone.updateImage(e.detail.element)}}}]),t}(wa),Ki=H("tools:SphericalBrushTool"),Xi=Tt("segmentation"),Zi=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"SphericalBrush",supportedInteractionTypes:["Mouse","Touch"],configuration:{alwaysEraseOnClick:!1},mixins:["renderBrushMixin"]};return(e=u()(this,h()(t).call(this,n,a))).touchDragCallback=e._paint.bind(Ta()(e)),e}return v()(t,e),l()(t,[{key:"_startPainting",value:function(e){var t,n=Xi.configuration,a=Xi.getters,r=e.detail,o=r.element,i=r.image,s=y.cornerstone,l=n.radius,c=i.rows,u=i.columns,d=Math.max(i.rowPixelSpacing,i.columnPixelSpacing),h=D(o,"stack").data[0].imageIds,f=a.labelmap2D(o),v=f.labelmap2D,g=f.labelmap3D,p=f.currentImageIdIndex,m=f.activeLabelmapIndex,x=this._isCtrlDown(r)||this.configuration.alwaysEraseOnClick,T=s.metaData.get("imagePlaneModule",i.imageId);if(T){var b=T.imagePositionPatient;t=this._getImagesInRange(p,b,h,l,d)}else Ki.warn("No imagePlane metadata found for image, defaulting to circle brush application."),t=[{imageIdIndex:p,radiusOnImage:l}];if(this.paintEventData={labelmap2D:v,labelmap3D:g,currentImageIdIndex:p,activeLabelmapIndex:m,shouldErase:x,imagesInRange:t},n.storeHistory){for(var I=[],w=0;w<t.length;w++){var C=t[w].imageIdIndex,E=a.labelmap2DByImageIdIndex(g,C,c,u).pixelData.slice();I.push(E)}this.paintEventData.previousPixeldataForImagesInRange=I}}},{key:"_paint",value:function(e){var t=Xi.getters,n=e.detail,a=(n.element,n.image),r=a.rows,o=a.columns,i=n.currentPoints.image,s=i.x,l=i.y;if(!(s<0||s>o||l<0||l>r)){for(var c=this.paintEventData,u=c.labelmap3D,d=c.imagesInRange,h=c.shouldErase,f=0;f<d.length;f++){var v=d[f],g=v.imageIdIndex;te(be(v.radiusOnImage,r,o,s,l),t.labelmap2DByImageIdIndex(u,g,r,o).pixelData,u.activeSegmentIndex,o,h)}y.cornerstone.updateImage(e.detail.element)}}},{key:"_getImagesInRange",value:function(e,t,n,a,r){for(var o=a*r,i=[{imageIdIndex:e,radiusOnImage:a}],s=e+1;s<n.length;s++){var l=this._getRadiusOnImage(n[s],t,o,r);if(!l)break;i.push({imageIdIndex:s,radiusOnImage:l})}for(var c=e-1;c>=0;c--){var u=this._getRadiusOnImage(n[c],t,o,r);if(!u)break;i.push({imageIdIndex:c,radiusOnImage:u})}return i}},{key:"_getRadiusOnImage",value:function(e,t,n,a){var r=y.cornerstone.metaData.get("imagePlaneModule",e);if(r){var o=r.imagePositionPatient,i=Math.sqrt(Math.pow(o[0]-t[0],2)+Math.pow(o[1]-t[1],2)+Math.pow(o[2]-t[2],2));if(!(i>n))return Math.floor(Math.sqrt(Math.pow(n,2)-Math.pow(i,2))/a)}else Ki.warn("Can't find imagePlane metadata for image, cancelling spherical brushing on: ".concat(e,","))}},{key:"_endPainting",value:function(e){for(var t=this.paintEventData,n=t.labelmap3D,a=t.imagesInRange,r=[],o=Xi.configuration,i=Xi.setters,s=0;s<a.length;s++){for(var l=a[s].imageIdIndex,c=n.labelmaps2D[l],u=new Set(c.pixelData).values(),d=[],h=!1;!h;){var f=u.next();(h=f.done)||d.push(f.value)}if(c.segmentsOnLabelmap=d,o.storeHistory){var v=this.paintEventData.previousPixeldataForImagesInRange[s],g=n.labelmaps2D[l].pixelData;r.push({imageIdIndex:l,diff:Le(v,g)})}}o.storeHistory&&i.pushState(this.element,r),De(this.element)}}]),t}(wa),Qi=H("util:segmentation:operations:correction");function $i(e,t){var n=t.pixelData,a=t.segmentIndex,r=t.segmentationMixinType;if("freehandSegmentationMixin"===r){var o=function(e,t){for(var n=t.pixelData,a=t.points,r=e.detail.image,o=r.width,i=r.height,s=[],l=0;l<a.length;l++){var c=a[l],u=Math.floor(c.x),d=Math.floor(c.y);u=ma(u,0,o-1),d=ma(d,0,i-1);var h=s[s.length-1];h&&u===h.x&&d===h.y||s.push({x:u,y:d,segment:n[d*o+u]})}return s}(e,t),i=function(e,t){for(var n=!0,a=!0,r=0;r<e.length;r++){if(e[r].segment===t?a=!1:n=!1,!n&&!a)break}if(a)return{isScissorOperation:!0,operation:"fillInsideFreehand"};if(n)return{isScissorOperation:!0,operation:"eraseInsideFreehand"};return{isScissorOperation:!1}}(o,a);if(i.isScissorOperation)"fillInsideFreehand"===i.operation?(Qi.warn("The line never intersects a segment."),vs(e,t)):"eraseInsideFreehand"===i.operation&&(Qi.warn("The line is only ever inside the segment."),is(e,t));else{var s=new Uint8Array(n.length);(function(e,t){var n=e[0].segment===t,a=[];a.push({additive:!n,nodes:[]});for(var r=0,o=0;o<e.length;o++){var i=e[o];n?(a[r].nodes.push(i),i.segment!==t&&(r++,n=!n,a.push({additive:!0,nodes:[]}),a[r].nodes.push(e[o-1]),a[r].nodes.push(i))):(a[r].nodes.push(i),i.segment===t&&(r++,n=!n,a.push({additive:!1,nodes:[]}),a[r].nodes.push(e[o-1]),a[r].nodes.push(i)))}return a.pop(),a.shift(),a})(o,a).forEach((function(t){!function(e,t,n,a,r){var o=r.detail.image,i=o.width,s=o.height,l=e.nodes,c=e.additive,u=c?0:1,d=function(e){return e.y*i+e.x},h=function(e){return{x:e%i,y:Math.floor(e/i)}};c?Qi.warn("additive operation..."):Qi.warn("subtractive operation...");for(var f=function(e){for(var t=[],n=0;n<e.length-1;n++)t.push(e[n]),t.push.apply(t,$()(Ce(e[n],e[n+1])));t.push[e[e.length-1]];for(var a=[],r=[],o=0;o<t.length-1;o++){var i=ns(t[o],t[o+1]),s=i.left,l=i.right;a.push(s),r.push(l)}return{pixelPath:t,leftPath:a,rightPath:r}}(l),v=f.pixelPath,g=f.leftPath,p=f.rightPath,m=v[0],y={xMin:m.x,xMax:m.x,yMin:m.y,yMax:m.y},x=0;x<n.length;x++)if(t[x]===a){var T=h(x);es(y,T),n[x]=1}else n[x]=0;for(var b=0;b<v.length;b++){var I=v[b];n[d(I)]=2,es(y,I)}!function(e,t,n){e.xMax=Math.min(e.xMax+2,n),e.xMin=Math.max(e.xMin-2,0),e.yMax=Math.min(e.yMax+2,t),e.yMin=Math.max(e.yMin-2,0)}(y,s,i);var w=y.xMin,C=y.xMax,E=y.yMin,M=y.yMax;function k(e,t){if(!(e>=C||e<w||t>=M||t<E))return n[t*i+e]}for(var S=0,O=0,P=0;P<g.length;P++){var _=g[P];n[d(_)]===u&&We(_,s,i)&&(S+=ts(_,3,n,k,i));var D=p[P];n[d(D)]===u&&We(D,s,i)&&(O+=ts(D,4,n,k,i))}if(0===S||0===O)return;for(var L=c?a:0,A=S<O?3:4,R=0;R<n.length;R++)n[R]===A&&(t[R]=L);if(L===a)for(var U=0;U<v.length;U++)t[d(v[U])]=a;else for(var B=0;B<v.length;B++){var H=d(v[B]);t[H]===a&&(t[H]=0)}}(t,n,s,a,e)}))}}else Qi.error("correction operation requires freehandSegmentationMixin operationData, recieved ".concat(r))}function es(e,t){var n=t.x,a=t.y;n<e.xMin&&(e.xMin=n),n>e.xMax&&(e.xMax=n),a<e.yMin&&(e.yMin=a),a>e.yMax&&(e.yMax=a)}function ts(e,t,n,a,r){for(var o=ve(a,[e.x,e.y]).flooded,i=0;i<o.length;i++){var s=o[i];n[s[1]*r+s[0]]=t}return o.length}function ns(e,t){var n={x:t.x-e.x,y:t.y-e.y};return-1===n.x&&1===n.y?{left:{x:e.x-1,y:e.y-1},right:{x:e.x+1,y:e.y+1}}:0===n.x&&1===n.y?{left:{x:e.x-1,y:e.y},right:{x:e.x+1,y:e.y}}:1===n.x&&1===n.y?{left:{x:e.x-1,y:e.y+1},right:{x:e.x+1,y:e.y-1}}:1===n.x&&0===n.y?{left:{x:e.x,y:e.y+1},right:{x:e.x,y:e.y-1}}:1===n.x&&-1===n.y?{left:{x:e.x+1,y:e.y+1},right:{x:e.x-1,y:e.y-1}}:0===n.x&&-1===n.y?{left:{x:e.x+1,y:e.y},right:{x:e.x-1,y:e.y}}:-1===n.x&&-1===n.y?{left:{x:e.x+1,y:e.y-1},right:{x:e.x-1,y:e.y+1}}:-1===n.x&&0===n.y?{left:{x:e.x,y:e.y-1},right:{x:e.x,y:e.y+1}}:void Qi.error("Unable to find left and right paths for flood fill ",e,t,n)}function as(e,t){for(var n=e[0],a=e[1],r=!1,o=0,i=t.length-1;o<t.length;i=o++){var s=t[o][0],l=t[o][1],c=t[i][0],u=t[i][1];l>a!=u>a&&n<(c-s)*(a-l)/(u-l)+s&&(r=!r)}return r}var rs=H("util:segmentation:operations:eraseInsideFreehand");function os(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=t.points,r=t.segmentationMixinType;if("freehandSegmentationMixin"===r){var o=e.detail.image,i=a.map((function(e){return[e.x,e.y]})),s=Te(i,o),l=re()(s,2),c=l[0],u=l[1];n?se(e,t,(function(e){return as([e.x,e.y],i)}),c,u):le(e,t,(function(e){return as([e.x,e.y],i)}),c,u)}else rs.error("eraseInsideFreehand operation requires freehandSegmentationMixin operationData, recieved ".concat(r))}function is(e,t){os(e,t,!0)}function ss(e,t){os(e,t,!1)}var ls=H("util:segmentation:operations:eraseInsideRectangle");function cs(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=t.points,r=t.segmentationMixinType;if("rectangleSegmentationMixin"===r){var o=e.detail,i=o.image,s=a.map((function(e){return[e.x,e.y]})),l=Te(s,i),c=re()(l,2),u=c[0],d=c[1];n?se(e,t,(function(){return!0}),u,d):ne(e,t,u,d)}else ls.error("eraseInsideRectangle operation requires rectangleSegmentationMixin operationData, recieved ".concat(r))}function us(e,t){cs(e,t,!0)}function ds(e,t){cs(e,t,!1)}var hs=H("util:segmentation:operations:fillInsideFreehand");function fs(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=t.points,r=t.segmentationMixinType;if("freehandSegmentationMixin"===r){var o=e.detail.image,i=a.map((function(e){return[e.x,e.y]})),s=Te(i,o),l=re()(s,2),c=l[0],u=l[1];n?he(e,t,(function(e){return as([e.x,e.y],i)}),c,u):fe(e,t,(function(e){return as([e.x,e.y],i)}),c,u)}else hs.error("eraseInsideFreehand operation requires freehandSegmentationMixin operationData, recieved ".concat(r))}function vs(e,t){fs(e,t,!0)}function gs(e,t){fs(e,t,!1)}var ps=H("util:segmentation:operations:fillInsideRectangle");function ms(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=t.points,r=t.segmentationMixinType;if("rectangleSegmentationMixin"===r){var o=e.detail.image,i=a.map((function(e){return[e.x,e.y]})),s=Te(i,o),l=re()(s,2),c=l[0],u=l[1];n?he(e,t,(function(){return!0}),c,u):ce(e,t,c,u)}else ps.error("eraseInsideRectangle operation requires rectangleSegmentationMixin operationData, recieved ".concat(r))}function ys(e,t){ms(e,t,!0)}function xs(e,t){ms(e,t,!1)}var Ts=H("util:segmentation:operations:fillCircle");function bs(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=t.segmentationMixinType;if("circleSegmentationMixin"===a){var r=e.detail,o=xe(e),i=re()(o,2),s=i[0],l=i[1],c=ye(r.handles.start,r.handles.end);n?he(e,t,(function(e){return Jo(c,e)}),s,l):fe(e,t,(function(e){return Jo(c,e)}),s,l)}else Ts.error("fillInsideCircle operation requires circleSegmentationMixin operationData, recieved ".concat(a))}function Is(e,t){bs(e,t,!0)}function ws(e,t){bs(e,t,!1)}var Cs=H("util:segmentation:operations:eraseInsideCircle");function Es(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=t.segmentationMixinType;if("circleSegmentationMixin"===a){var r=e.detail,o=xe(e),i=re()(o,2),s=i[0],l=i[1],c=ye(r.handles.start,r.handles.end);n?se(e,t,(function(e){return Jo(c,e)}),s,l):le(e,t,(function(e){return Jo(c,e)}),s,l)}else Cs.error("eraseInsideCircle operation requires circleSegmentationMixin operationData, recieved ".concat(a))}function Ms(e,t){Es(e,t,!0)}function ks(e,t){Es(e,t,!1)}var Ss=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"FreehandScissors",strategies:{FILL_INSIDE:vs,FILL_OUTSIDE:gs,ERASE_OUTSIDE:ss,ERASE_INSIDE:is},cursors:{FILL_INSIDE:Nr,FILL_OUTSIDE:Vr,ERASE_OUTSIDE:Fr,ERASE_INSIDE:Hr},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Nr,mixins:["freehandSegmentationMixin"]};return u()(this,h()(t).call(this,e,n))}return v()(t,e),t}(ca),Os=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"RectangleScissors",strategies:{FILL_INSIDE:ys,FILL_OUTSIDE:xs,ERASE_OUTSIDE:ds,ERASE_INSIDE:us},cursors:{FILL_INSIDE:qr,FILL_OUTSIDE:Gr,ERASE_OUTSIDE:zr,ERASE_INSIDE:jr},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],mixins:["rectangleSegmentationMixin"]};return u()(this,h()(t).call(this,e,n))}return v()(t,e),t}(ca),Ps=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"CircleScissors",strategies:{FILL_INSIDE:Is,FILL_OUTSIDE:ws,ERASE_OUTSIDE:ks,ERASE_INSIDE:Ms},cursors:{FILL_INSIDE:Jr,FILL_OUTSIDE:Kr,ERASE_OUTSIDE:Yr,ERASE_INSIDE:Wr},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Jr,mixins:["circleSegmentationMixin"]};return u()(this,h()(t).call(this,e,n))}return v()(t,e),t}(ca),_s=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"CorrectionScissors",strategies:{CORRECTION:$i},cursors:{CORRECTION:Nr},defaultStrategy:"CORRECTION",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Nr,mixins:["polylineSegmentationMixin"]};return u()(this,h()(t).call(this,e,n))}return v()(t,e),t}(ca),Ds=n(28),Ls=n.n(Ds),As=n(46),Rs=n.n(As),Us=n(17),Bs=n.n(Us),Hs=n(20),Ns=n.n(Hs),Fs=n(10),Vs=n.n(Fs),js=n(47),qs=n.n(js),zs=n(48),Gs=n.n(zs),Ws=n(49),Js=n.n(Ws),Ys=n(50),Ks=n.n(Ys),Xs=n(25),Zs=n.n(Xs),Qs=n(51),$s=n.n(Qs),el=n(52),tl=n.n(el),nl=n(28),al="function"==typeof window.SharedArrayBuffer,rl=function(e){if(al){if(e.data.buffer instanceof SharedArrayBuffer)return e;var t=new SharedArrayBuffer(e.data.buffer.byteLength),n=new e.data.constructor(t);return n.set(e.data,0),e.data=n,e}return nl(e)},ol=n(29),il=n.n(ol),sl=n(13),ll=n.n(sl),cl=n(7),ul=n.n(cl),dl=n(23),hl=n.n(dl),fl=n(53),vl=n.n(fl),gl=n(54),pl=n.n(gl),ml=n(55),yl=n.n(ml),xl=n(56),Tl=n.n(xl),bl=n(57),Il=n.n(bl),wl=n(58),Cl=n.n(wl),El=n(30),Ml=n.n(El),kl=n(59),Sl=n.n(kl),Ol=n(21),Pl=n.n(Ol),_l=n(16),Dl=n.n(_l),Ll=n(27),Al=n.n(Ll),Rl=n(22),Ul=n.n(Rl),Bl={itkModulesPath:"itk"},Hl=function(e,t){if(t){var n=new Al.a(t);return Promise.resolve({webworkerPromise:n,worker:t})}var a="".concat(Bl.itkModulesPath,"/WebWorkers/").concat(e,".worker.js");if(a.startsWith("http"))return Ul.a.get(a,{responseType:"blob"}).then((function(e){var t=new window.Worker(URL.createObjectURL(e.data));return{webworkerPromise:new Al.a(t),worker:t}}));var r=new window.Worker(a),o=new Al.a(r);return Promise.resolve({webworkerPromise:o,worker:r})},Nl=function(e,t,n,a){var r=e;return Hl("ImageIO",r).then((function(e){var o=e.webworkerPromise,i=e.worker;return r=i,o.postMessage({operation:"readImage",name:n,type:a,data:t,config:Bl},[t])})).then((function(e){return Promise.resolve({image:e,webWorker:r})}))},Fl=function(e,t,n,a){var r=e;return Hl("MeshIO",r).then((function(e){var o=e.webworkerPromise,i=e.worker;return r=i,o.postMessage({operation:"readMesh",name:n,type:a,data:t,config:Bl},[t]).then((function(e){return Promise.resolve({mesh:e,webWorker:r})}))}))},Vl=function(e,t,n,a){var r=Vs()(n);return!!Bs.a.has(r)||!!Pl.a.has(a)?Fl(e,t,n,a).catch((function(){return e.terminate(),Nl(null,t,n,a)})):Nl(e,t,n,a)},jl=n(11),ql=n.n(jl),zl=function(e,t,n,a){var r=e;return Hl("ImageIO",r).then((function(e){var o=e.webworkerPromise,i=e.worker;return r=i,ql.a.readAsArrayBuffer(t).then((function(e){return o.postMessage({operation:"readImage",name:n,type:a,data:e,config:Bl},[e])})).then((function(e){return Promise.resolve({image:e,webWorker:r})}))}))},Gl=function(e,t,n,a){var r=e;return Hl("MeshIO",r).then((function(e){var o=e.webworkerPromise,i=e.worker;return r=i,ql.a.readAsArrayBuffer(t).then((function(e){return o.postMessage({operation:"readMesh",name:n,type:a,data:e,config:Bl},[e])})).then((function(e){return Promise.resolve({mesh:e,webWorker:r})}))}))},Wl=function(e,t,n,a){var r=Vs()(n);return!!Bs.a.has(r)||!!Pl.a.has(a)?Gl(e,t,n,a).catch((function(){return e.terminate(),zl(null,t,n,a)})):zl(e,t,n,a)},Jl=n(18),Yl=n.n(Jl),Kl=n(15),Xl=n.n(Kl),Zl=function(){var e=Yl()(Xl.a.mark((function e(t,n){var a,r,o,i,s,l;return Xl.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t,e.next=3,Hl("ImageIO",a);case 3:return r=e.sent,o=r.webworkerPromise,i=r.worker,a=i,e.next=9,ql.a.readAsArrayBuffer(n);case 9:return s=e.sent,e.prev=10,e.next=13,o.postMessage({operation:"readImage",name:n.name,type:n.type,data:s,config:Bl},[s]);case 13:return l=e.sent,e.abrupt("return",{image:l,webWorker:a});case 17:throw e.prev=17,e.t0=e.catch(10),Error(e.t0);case 20:case"end":return e.stop()}}),e,null,[[10,17]])})));return function(t,n){return e.apply(this,arguments)}}(),Ql=function(e,t){var n=e;return Hl("MeshIO",n).then((function(e){var a=e.webworkerPromise,r=e.worker;return n=r,ql.a.readAsArrayBuffer(t).then((function(e){return a.postMessage({operation:"readMesh",name:t.name,type:t.type,data:e,config:Bl},[e])})).then((function(e){return Promise.resolve({mesh:e,webWorker:n})}))}))},$l=n(19),ec=n.n($l),tc=n(14),nc=n.n(tc),ac=function(e,t){var n=e;return Hl("Pipeline",n).then((function(e){var a=e.webworkerPromise,r=e.worker;return n=r,ql.a.readAsArrayBuffer(t).then((function(e){var r=t.name,o=t.type,i=Vs()(r),s=null;ec.a.has(o)?s=ec.a.get(o):nc.a.has(i)&&(s=nc.a.get(i)),null===s&&Promise.reject(Error("Could not find IO for: "+r));var l=[t.name,t.name+".output.json"],c=[{path:l[1],type:ul.a.vtkPolyData}],u=[{path:l[0],type:ul.a.Binary,data:new Uint8Array(e)}],d=[];return u.forEach((function(e){e.type===ul.a.Binary&&(e.data.buffer?d.push(e.data.buffer):e.data.byteLength&&d.push(e.data))})),a.postMessage({operation:"runPolyDataIOPipeline",config:Bl,pipelinePath:s,args:l,outputs:c,inputs:u},d).then((function(e){e.stdout,e.stderr;var t=e.outputs;return Promise.resolve({polyData:t[0].data,webWorker:n})}))}))}))},rc=function(e,t){var n=Vs()(t.name),a=Bs.a.has(n),r=nc.a.has(n);return a?Ql(e,t).catch((function(){return e.terminate(),Zl(null,t)})):r?ac(e,t):Zl(e,t)},oc=n(24),ic=n.n(oc),sc=n(60),lc=n.n(sc),cc=n(33),uc=n.n(cc),dc=n(61),hc=n.n(dc),fc=n(62),vc=n.n(fc),gc=function(){function e(t,n){hc()(this,e),this.fcn=n,this.workerQueue=new Array(t),this.workerQueue.fill(null),this.runInfo=[]}return vc()(e,[{key:"runTasks",value:function(e,t){var n=this,a={taskQueue:[],results:[],addingTasks:!1,postponed:!1,runningWorkers:0,progressCallback:t,canceled:!1};return this.runInfo.push(a),a.index=this.runInfo.length-1,{promise:new Promise((function(t,r){a.resolve=t,a.reject=r,a.results=new Array(e.length),a.completedTasks=0,a.addingTasks=!0,e.forEach((function(e,t){n.addTask(a.index,t,e)})),a.addingTasks=!1})),runId:a.index}}},{key:"terminateWorkers",value:function(){for(var e=0;e<this.workerQueue.length;e++){var t=this.workerQueue[e];t&&t.terminate(),this.workerQueue[e]=null}}},{key:"cancel",value:function(e){var t=this.runInfo[e];t&&(t.canceled=!0)}},{key:"addTask",value:function(e,t,n){var a=this,r=this.runInfo[e];if(r&&r.canceled)return this.clearTask(r.index),void r.reject("Remaining tasks canceled");if(this.workerQueue.length>0){var o=this.workerQueue.pop();r.runningWorkers++,this.fcn.apply(this,[o].concat(uc()(n))).then((function(n){var o=n.webWorker,i=lc()(n,["webWorker"]);if(a.workerQueue.push(o),null!==a.runInfo[e])if(r.runningWorkers--,r.results[t]=i,r.completedTasks++,r.progressCallback&&r.progressCallback(r.completedTasks,r.results.length),r.taskQueue.length>0){var s=r.taskQueue.shift();a.addTask.apply(a,[e].concat(uc()(s)))}else if(!r.addingTasks&&!r.runningWorkers){var l=r.results;a.clearTask(r.index),r.resolve(l)}})).catch((function(e){var t=r.reject;a.clearTask(r.index),t(e)}))}else r.runningWorkers||!0===r.postponed?r.taskQueue.push([t,n]):(r.postponed=!0,setTimeout((function(){r.postponed=!1,a.addTask(r.index,t,n)}),50))}},{key:"clearTask",value:function(e){this.runInfo[e].results=null,this.runInfo[e].taskQueue=null,this.runInfo[e].progressCallback=null,this.runInfo[e].canceled=null,this.runInfo[e]=null}}]),e}(),pc=n(25),mc=n(23);var yc=function(e){var t=new pc(e[0].imageType);t.origin=Array.from(e[0].origin),t.spacing=Array.from(e[0].spacing);var n=t.imageType.dimension;t.direction=new mc(n,n),t.direction.data=Array.from(e[0].direction.data);var a=n-1;t.size=Array.from(e[0].size);var r=e.reduce((function(e,t){return e+t.size[a]}),0);t.size[a]=r;var o=t.size.reduce((function(e,t){return e*t}),1)*t.imageType.components;t.data=new e[0].data.constructor(o);for(var i=t.imageType.components,s=0;s<t.size.length-1;s++)i*=t.size[s];for(var l=0,c=0;c<e.length;c++)t.data.set(e[c].data,i*l),l+=e[c].size[a];return t},xc=function(){var e=Yl()(ic.a.mark((function e(t,n){var a,r,o,i,s,l,c,u,d=arguments;return ic.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=d.length>2&&void 0!==d[2]&&d[2],r=t,e.next=4,Hl("ImageIO",r);case 4:return o=e.sent,i=o.webworkerPromise,s=o.worker,r=s,l=n.map((function(e){return e.data})),c={operation:"readDICOMImageSeries",fileDescriptions:n,singleSortedSeries:a,config:Bl},e.next=12,i.postMessage(c,l);case 12:return u=e.sent,e.abrupt("return",{image:u,webWorker:r});case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Tc=new gc(navigator.hardwareConcurrency?navigator.hardwareConcurrency:4,xc),bc=function(){var e=Yl()(ic.a.mark((function e(t){var n,a,r,o,i,s,l,c,u,d,h,f=arguments;return ic.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.length>1&&void 0!==f[1]&&f[1],a=Array.from(t,(function(e){return ql.a.readAsArrayBuffer(e).then((function(t){return{name:e.name,type:e.type,data:t}}))})),e.next=4,Promise.all(a);case 4:if(r=e.sent,!n){e.next=16;break}for(o=[],i=0;i<r.length;i+=8)s=r.slice(i,i+8),o.push([s,n]);return e.next=10,Tc.runTasks(o).promise;case 10:return l=e.sent,c=l.map((function(e){return e.image})),u=yc(c),e.abrupt("return",{image:u,webWorkerPool:Tc});case 16:return d=[[r,n]],e.next=19,Tc.runTasks(d).promise;case 19:return h=e.sent,e.abrupt("return",{image:h[0].image,webWorkerPool:Tc});case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ic=n(31),wc=n.n(Ic);function Cc(){return(Cc=Yl()(Xl.a.mark((function e(t){var n,a,r;return Xl.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ul.a.get(t,{responseType:"json"});case 2:return n=e.sent,a=n.data,e.next=6,Ul.a.get(t+".data",{responseType:"arraybuffer"});case 6:return r=e.sent,a.data=wc()(a.imageType.componentType,r.data),e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ec=function(e){return Cc.apply(this,arguments)},Mc=function(e,t,n,a){var r=e;return Hl("Pipeline",r).then((function(e){var o=e.webworkerPromise,i=e.worker;r=i;var s=Vs()(n),l=null;ec.a.has(a)?l=ec.a.get(a):nc.a.has(s)&&(l=nc.a.get(s)),null===l&&Promise.reject(Error("Could not find IO for: "+n));var c=[n,n+".output.json"],u=[{path:c[1],type:ul.a.vtkPolyData}],d=[{path:c[0],type:ul.a.Binary,data:new Uint8Array(t)}],h=[];return d.forEach((function(e){e.type===ul.a.Binary&&(e.data.buffer?h.push(e.data.buffer):e.data.byteLength&&h.push(e.data))})),o.postMessage({operation:"runPolyDataIOPipeline",config:Bl,pipelinePath:l,args:c,outputs:u,inputs:d},h).then((function(e){e.stdout,e.stderr;var t=e.outputs;return Promise.resolve({polyData:t[0].data,webWorker:r})}))}))},kc=function(e,t,n,a){var r=e;return Hl("Pipeline",r).then((function(e){var o=e.webworkerPromise,i=e.worker;return r=i,ql.a.readAsArrayBuffer(t).then((function(e){var t=Vs()(n),i=null;ec.a.has(a)?i=ec.a.get(a):nc.a.has(t)&&(i=nc.a.get(t)),null===i&&Promise.reject(Error("Could not find IO for: "+n));var s=[n,n+".output.json"],l=[{path:s[1],type:ul.a.vtkPolyData}],c=[{path:s[0],type:ul.a.Binary,data:new Uint8Array(e)}],u=[];return c.forEach((function(e){e.type===ul.a.Binary&&(e.data.buffer?u.push(e.data.buffer):e.data.byteLength&&u.push(e.data))})),o.postMessage({operation:"runPolyDataIOPipeline",config:Bl,pipelinePath:i,args:s,outputs:l,inputs:c},u).then((function(e){e.stdout,e.stderr;var t=e.outputs;return Promise.resolve({polyData:t[0].data,webWorker:r})}))}))}))},Sc=n(63),Oc=n.n(Sc),Pc=n(64),_c=n.n(Pc),Dc="function"==typeof self.SharedArrayBuffer;var Lc=function(e){var t=null;return e.buffer?t=e.buffer:e.byteLength&&(t=e),t&&Dc&&t instanceof SharedArrayBuffer&&(t=null),t},Ac={};function Rc(e,t,n,a){var r=e;"/"===e[0]||e.startsWith("http")||(r="..");var o=r+"/"+t;if("object"===Oc()(window.WebAssembly)&&"function"==typeof window.WebAssembly.Memory){var i=o+"/"+n+"Wasm.js";return a&&(i=n+"Wasm.js"),new Promise((function(e,t){var n=document.createElement("script");n.src=i,n.onload=e,n.onerror=t,document.head.appendChild(n)})).then(Yl()(Xl.a.mark((function e(){var t,r,i,s;return Xl.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.replace(/.*\//,""),r=o+"/"+n+"Wasm.wasm",a&&(r=n+"Wasm.wasm"),e.next=5,Ul.a.get(r,{responseType:"arraybuffer"});case 5:return i=e.sent,s=i.data,e.abrupt("return",Promise.resolve(window[t]({moduleScriptDir:o,isAbsoluteURL:a,pipelinePath:n,wasmBinary:s})));case 8:case"end":return e.stop()}}),e)}))))}var s=o+"/"+n+".js";return a&&(s=n+".js"),new Promise((function(e,t){var n=document.createElement("script");n.src=s,n.onload=e,n.onerror=t,document.head.appendChild(n)})).then((function(){return window.Module}))}function Uc(){return(Uc=Yl()(Xl.a.mark((function e(t,n,a){var r;return Xl.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null,!(n in Ac)){e.next=5;break}r=Ac[n],e.next=9;break;case 5:return e.next=7,Rc(Bl.itkModulesPath,t,n,a);case 7:Ac[n]=e.sent,r=Ac[n];case 9:return e.abrupt("return",r);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Bc=function(e,t,n,a,r){var o=t instanceof URL;!1===e&&function(e,t,n){return Uc.apply(this,arguments)}("Pipelines",t.toString(),o).then((function(e){return _c()(e,n,a,r)}));var i=e;return Hl("Pipeline",i).then((function(e){var s=e.webworkerPromise,l=e.worker;i=l;var c=[];return r&&r.forEach((function(e){if(e.type===ul.a.Binary){var t=Lc(e.data);t&&c.push(t)}else if(e.type===ul.a.Image){var n=Lc(e.data.data);n&&c.push(n)}else if(e.type===ul.a.Mesh){if(e.data.points){var a=Lc(e.data.points);a&&c.push(a)}if(e.data.pointData){var r=Lc(e.data.pointData);r&&c.push(r)}if(e.data.cells){var o=Lc(e.data.cells);o&&c.push(o)}if(e.data.cellData){var i=Lc(e.data.cellData);i&&c.push(i)}}})),s.postMessage({operation:"runPipeline",config:Bl,pipelinePath:t.toString(),isAbsoluteURL:o,args:n,outputs:a,inputs:r},c).then((function(e){var t=e.stdout,n=e.stderr,a=e.outputs;return Promise.resolve({stdout:t,stderr:n,outputs:a,webWorker:i})}))}))},Hc=n(65),Nc=n.n(Hc),Fc=function(e,t,n,a,r){var o=e;return Hl("ImageIO",o).then((function(e){var i=e.webworkerPromise,s=e.worker;o=s;var l=[],c=Lc(n.data);return c&&l.push(c),i.postMessage({operation:"writeImage",name:a,type:r,image:n,useCompression:t,config:Bl},l).then((function(e){return Promise.resolve({arrayBuffer:e,webWorker:o})}))}))},Vc=function(e,t,n,a,r){var o=t.useCompression,i=t.binaryFileType,s=e;return Hl("MeshIO",s).then((function(e){var t=e.webworkerPromise,l=e.worker;s=l;var c=[];return n.points&&c.push(n.points.buffer),n.pointData&&c.push(n.pointData.buffer),n.cells&&c.push(n.cells.buffer),n.cellData&&c.push(n.cellData.buffer),t.postMessage({operation:"writeMesh",name:a,type:r,mesh:n,useCompression:o,binaryFileType:i,config:Bl},c).then((function(e){return Promise.resolve({arrayBuffer:e,webWorker:s})}))}))},jc=function(e,t,n,a,r){var o=Vs()(a);return!!Bs.a.has(o)||!!Pl.a.has(r)?Vc(e,t,n,a,r).catch((function(){return e.terminate(),Fc(null,t,n,a,r)})):Fc(e,t,n,a,r)},qc={};qc.copyImage=Ls.a,qc.extensionToImageIO=Rs.a,qc.extensionToMeshIO=Bs.a,qc.FloatTypes=Ns.a,qc.getFileExtension=Vs.a,qc.getMatrixElement=qs.a,qc.imageIOComponentToJSComponent=Gs.a,qc.ImageIOIndex=Js.a,qc.imageIOPixelTypeToJSPixelType=Ks.a,qc.Image=Zs.a,qc.imageJSComponentToIOComponent=$s.a,qc.imageJSPixelTypeToIOPixelType=tl.a,qc.imageSharedBufferOrCopy=rl,qc.ImageType=il.a,qc.IntTypes=ll.a,qc.IOTypes=ul.a,qc.Matrix=hl.a,qc.meshIOComponentToJSComponent=vl.a,qc.MeshIOIndex=pl.a,qc.meshIOPixelTypeToJSPixelType=yl.a,qc.Mesh=Tl.a,qc.meshJSComponentToIOComponent=Il.a,qc.meshJSPixelTypeToIOPixelType=Cl.a,qc.MeshType=Ml.a,qc.MimeToImageIO=Sl.a,qc.MimeToMeshIO=Pl.a,qc.PixelTypes=Dl.a,qc.readArrayBuffer=Vl,qc.readBlob=Wl,qc.readFile=rc,qc.readImageArrayBuffer=Nl,qc.readImageBlob=zl,qc.readImageDICOMFileSeries=bc,qc.readImageFile=Zl,qc.readImageHTTP=Ec,qc.readMeshArrayBuffer=Fl,qc.readMeshBlob=Gl,qc.readMeshFile=Ql,qc.readPolyDataArrayBuffer=Mc,qc.readPolyDataBlob=kc,qc.readPolyDataFile=ac,qc.runPipelineBrowser=Bc,qc.setMatrixElement=Nc.a,qc.stackImages=yc,qc.WorkerPool=gc,qc.writeArrayBuffer=jc,qc.writeImageArrayBuffer=Fc,qc.writeMeshArrayBuffer=Vc,window.itk=qc;var zc=window.itk,Gc=(H("tools:InterpolationTool"),Tt("segmentation")),Wc=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"Interpolation",supportedInteractionTypes:["Mouse","Touch"],configuration:{storeHistory:!1},mixins:[]};return u()(this,h()(t).call(this,e,n))}return v()(t,e),l()(t,[{key:"preMouseDownCallback",value:function(e){return this._startPainting(e),!0}},{key:"_startPainting",value:function(e){Gc.configuration;var t=Gc.getters,n=(Gc.setters,e.detail),a=n.element,r=n.image,o=r.rows,i=r.columns,s=D(a,"stack").data[0].imageIds,l=t.labelmap2D(a),c=l.labelmap2D,u=l.labelmap3D,d=l.currentImageIdIndex,h=l.activeLabelmapIndex,f=Array.from({length:s.length},(function(e,t){return t}));this.paintEventData={labelmap2D:c,labelmap3D:u,currentImageIdIndex:d,activeLabelmapIndex:h,imagesInRange:f};var v=n.currentPoints.image,g=v.x,p=v.y;if(!(g<0||g>i||p<0||p>o)){for(var m=C(d).length,x=new Uint16Array(f.length*m),T=0,b=0;b<f.length;b++)x.set(C(b),T),T+=m;var I=new zc.ImageType(3,ll.a.UInt16,Dl.a.Scalar,1),w=new zc.Image(I);w.data=x,w.size=[i,o,f.length],zc.runPipelineBrowser(null,"interpolation",[u.activeSegmentIndex.toString()],[{path:"output.json",type:zc.IOTypes.Image}],[{path:"input.json",type:zc.IOTypes.Image,data:w}]).then((function(n){n.stdout,n.stderr;for(var r=n.outputs,s=(n.webWorker,0);s<f.length;s++){var l=r[0].data.data,c=t.labelmap2DByImageIdIndex(u,f[s],o,i);c.pixelData=l.slice(s*m,(s+1)*m);for(var d=c,h=new Set(d.pixelData).values(),v=[],g=!1;!g;){var p=h.next();(g=p.done)||v.push(p.value)}d.segmentsOnLabelmap=v,d.canvasElementNeedsUpdate=!0}De(a),y.cornerstone.updateImage(e.detail.element)}))}function C(e){return t.labelmap2DByImageIdIndex(u,e,o,i).pixelData}}}]),t}(ca),Jc={},Yc={},Kc={};function Xc(e){if(!e)return"DEFAULT";var t=y.cornerstone.getEnabledElement(e).uuid;if(!t)throw new Error("Something went wrong when getting uuid from element");return t}var Zc={setStartLoadHandler:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!e)throw new Error("The Handler function must be defined");var n=Xc(t);Jc[n]=e},getStartLoadHandler:function(e){var t=Xc(e);return Jc[t]||Jc.DEFAULT},setEndLoadHandler:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!e)throw new Error("The Handler function must be defined");var n=Xc(t);Yc[n]=e},getEndLoadHandler:function(e){var t=Xc(e);return Yc[t]||Yc.DEFAULT},setErrorLoadingHandler:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!e)throw new Error("The Handler function must be defined");var n=Xc(t);Kc[n]=e},getErrorLoadingHandler:function(e){var t=Xc(e);return Kc[t]||Kc.DEFAULT},removeHandlers:function(e){var t=Xc(e);delete Jc[t],delete Yc[t],delete Kc[t]}},Qc={};function $c(e,t){if(!Qc[e])return{};var n=Qc[e].find((function(e){return e.element===t}));return n?n.options:{}}function eu(e,t,n){if(Qc[e]){var a=Qc[e].findIndex((function(e){return e.element===t}));if(-1===a)Qc[e].push({element:t,options:n});else{var r=Qc[e][a].options||{};Qc[e][a].options=Object.assign(r,n)}}else Qc[e]=[{element:t,options:n}]}var tu=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"Crosshairs",supportedInteractionTypes:["Mouse","Touch"],svgCursor:wr};return(e=u()(this,h()(t).call(this,n,a))).mouseDownCallback=e._chooseLocation.bind(Ta()(e)),e.mouseDragCallback=e._chooseLocation.bind(Ta()(e)),e.touchDragCallback=e._chooseLocation.bind(Ta()(e)),e}return v()(t,e),l()(t,[{key:"_chooseLocation",value:function(e){var t=e.detail,n=t.element;e.stopImmediatePropagation();var a=D(n,this.name);if(a){var r=n,o=y.cornerstone.getEnabledElement(r).image.imageId,i=y.cornerstone.metaData.get("imagePlaneModule",o);if(i){var s=nn(t.currentPoints.image,i);a.data[0].synchronizationContext.getSourceElements().forEach((function(e){if(e!==r){var t=Number.MAX_VALUE,n=-1,a=D(e,"stack");if(void 0!==a){var o=a.data[0];if(o.imageIds.forEach((function(e,a){var r=y.cornerstone.metaData.get("imagePlaneModule",e);if(r&&r.imagePositionPatient&&r.rowCosines&&r.columnCosines){var o=en(r.imagePositionPatient),i=en(r.rowCosines),l=en(r.columnCosines).clone().cross(i.clone()),c=Math.abs(l.clone().dot(o)-l.clone().dot(s));c<t&&(t=c,n=a)}})),n!==o.currentImageIdIndex&&-1!==n&&void 0!==o.imageIds[n]){var i=Zc.getStartLoadHandler(e),l=Zc.getEndLoadHandler(e),c=Zc.getErrorLoadingHandler(e);i&&i(e),(!0===o.preventCache?y.cornerstone.loadImage(o.imageIds[n]):y.cornerstone.loadAndCacheImage(o.imageIds[n])).then((function(t){var a=y.cornerstone.getViewport(e);o.currentImageIdIndex=n,y.cornerstone.displayImage(e,t,a),l&&l(e,t)}),(function(t){var a=o.imageIds[n];c&&c(e,a,t)}))}}}}))}}}},{key:"activeCallback",value:function(e,t){var n=t.mouseButtonMask,a=t.synchronizationContext;eu(this.name,e,{mouseButtonMask:n}),A(e,this.name),_(e,this.name,{synchronizationContext:a})}}]),t}(ca),nu=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"DoubleTapFitToWindow",supportedInteractionTypes:["DoubleTap"]};return u()(this,h()(t).call(this,e,n))}return v()(t,e),l()(t,[{key:"doubleTapCallback",value:function(e){var t=e.detail;y.cornerstone.fitToWindow(t.element)}}]),t}(ca),au=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"DragProbe",strategies:{default:ru,minimal:ou},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Tr};return(e=u()(this,h()(t).call(this,n,a))).touchDragCallback=e._movingEventCallback.bind(Ta()(e)),e.touchEndCallback=e._endMovingEventCallback.bind(Ta()(e)),e.mouseDragCallback=e._movingEventCallback.bind(Ta()(e)),e.mouseUpCallback=e._endMovingEventCallback.bind(Ta()(e)),e.dragEventData={},e}return v()(t,e),l()(t,[{key:"_movingEventCallback",value:function(e){var t=e.detail,n=t.element;this.dragEventData=t,y.cornerstone.updateImage(n)}},{key:"_endMovingEventCallback",value:function(e){var t=e.detail.element;this.dragEventData={},y.cornerstone.updateImage(t)}},{key:"renderToolData",value:function(e){this.dragEventData.currentPoints&&e&&e.detail&&Boolean(Object.keys(this.dragEventData.currentPoints).length)&&(e.detail.currentPoints=this.dragEventData.currentPoints,this.applyActiveStrategy(e))}}]),t}(ca);function ru(e){var t=this.configuration,n=y.cornerstone,a=e.detail,r=a.element,o=a.image,i=a.currentPoints,s=a.canvasContext,l=Cn(s.canvas),c=un.getActiveColor(),u=mn.getFontSize(),d=Math.round(i.image.x),h=Math.round(i.image.y);d<0||h<0||d>=o.columns||h>=o.rows||Gt(l,(function(e){Mn(e,t);var a,s,l="".concat(d,", ").concat(h);if(o.color)a=Ui(r,d,h,1,1),s="R: ".concat(a[0]," G: ").concat(a[1]," B: ").concat(a[2]," A: ").concat(a[3]);else{var f=(a=n.getStoredPixels(r,d,h,1,1))[0],v=f*o.slope+o.intercept,g=Go(o,f);s="SP: ".concat(f," MO: ").concat(parseFloat(v.toFixed(3))),g&&(s+=" SUV: ".concat(parseFloat(g.toFixed(3))))}var p={x:i.canvas.x+5,y:i.canvas.y-5};bn(e,s,p.x,p.y+u+5,c),bn(e,l,p.x,p.y,c)}))}function ou(e){var t=this.configuration,n=y.cornerstone,a=e.detail,r=a.element,o=a.image,i=a.currentPoints,s=a.canvasContext,l=a.isTouchEvent,c=Cn(s.canvas),u=un.getActiveColor(),d=i.page.y-mn.getFontSize()/2;l&&(d=i.page.y-4*mn.getFontSize());var h=n.pageToPixel(r,i.page.x,d);h.x<0||h.y<0||h.x>=o.columns||h.y>=o.rows||Gt(c,(function(e){Mn(e,t);var a,i=n.metaData.get("generalSeriesModule",o.imageId),s=i&&i.modality,c="";if(o.color)a=Ui(r,h.x,h.y,1,1),c="R: ".concat(a[0]," G: ").concat(a[1]," B: ").concat(a[2]);else{var d=(a=n.getStoredPixels(r,h.x,h.y,1,1))[0],f=d*o.slope+o.intercept,v=parseFloat(f.toFixed(2));if("CT"===s)c+="HU: ".concat(v);else if("PT"===s){c+=v;var g=Go(o,d);g&&(c+=" SUV: ".concat(parseFloat(g.toFixed(2))))}else c+=v}var p=n.pixelToCanvas(r,h),m={x:12,y:-(mn.getFontSize()+10)/2},y=Tn(e,c,5);l&&(m={x:-y/2,y:-mn.getFontSize()-10-12}),$t(e,r,p,6,{color:u},"canvas"),bn(e,c,p.x+m.x,p.y+m.y,u)}))}var iu=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"Eraser",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Cr};return(e=u()(this,h()(t).call(this,n,a))).preMouseDownCallback=e._deleteAllNearbyTools.bind(Ta()(e)),e.preTouchStartCallback=e._deleteAllNearbyTools.bind(Ta()(e)),e}return v()(t,e),l()(t,[{key:"_deleteAllNearbyTools",value:function(e){var t=e.detail.currentPoints.canvas,n=e.detail.element;mt.tools.forEach((function(e){var a=D(n,e.name);a&&a.data.forEach((function(a){"function"==typeof e.pointNearTool&&e.pointNearTool(n,a,t)&&(L(n,e.name,a),y.cornerstone.updateImage(n))}))}));return!0}}]),t}(ca),su=Ei.FreehandHandleData,lu=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"FreehandRoiSculptor",referencedToolName:"FreehandRoi",supportedInteractionTypes:["Mouse","Touch","DoubleTap"],mixins:["activeOrDisabledBinaryTool"],configuration:cu(),svgCursor:yr};return(e=u()(this,h()(t).call(this,n,a))).updateOnMouseMove=!0,e.isMultiPartTool=!0,e.referencedToolName=e.initialConfiguration.referencedToolName,e._active=!1,e.activeMouseUpCallback=e.activeMouseUpCallback.bind(Ta()(e)),e.activeTouchEndCallback=e.activeTouchEndCallback.bind(Ta()(e)),e.activeMouseDragCallback=e.activeMouseDragCallback.bind(Ta()(e)),e}return v()(t,e),l()(t,[{key:"renderToolData",value:function(e){var t=e.detail;if(null===this.configuration.currentTool)return!1;var n=t.element,a=this.configuration;if(!D(n,this.referencedToolName).data[a.currentTool])return!1;if(this._active){var r=t.canvasContext.canvas.getContext("2d"),o={color:this.configuration.dragColor,fill:null,handleRadius:this._toolSizeCanvas};dn(r,t,this.configuration.mouseLocation.handles,o)}else this.configuration.showCursorOnHover&&!this._recentTouchEnd&&this._renderHoverCursor(e)}},{key:"doubleClickCallback",value:function(e){var t=e.detail;this._selectFreehandTool(t),y.cornerstone.updateImage(t.element)}},{key:"doubleTapCallback",value:function(e){var t=e.detail;this._selectFreehandTool(t),y.cornerstone.updateImage(t.element)}},{key:"preTouchStartCallback",value:function(e){return this._initialiseSculpting(e),!0}},{key:"preMouseDownCallback",value:function(e){if(this.options.mouseButtonMask.includes(e.detail.buttons))return this._initialiseSculpting(e),!0}},{key:"activeMouseDragCallback",value:function(e){var t=this.configuration;if(this._active){var n=e.detail,a=D(n.element,this.referencedToolName);if(a){var r=a.data[t.currentTool].handles.points;this._getMouseLocation(n),this._sculpt(n,r),y.cornerstone.updateImage(n.element)}}}},{key:"activeMouseUpCallback",value:function(e){this._activeEnd(e)}},{key:"activeTouchEndCallback",value:function(e){this._activeEnd(e),this._deselectAllTools(e),this._recentTouchEnd=!0}},{key:"_activeEnd",value:function(e){var t=e.detail,n=t.element,a=this.configuration;this._active=!1,mt.isMultiPartToolActive=!1,this._getMouseLocation(t),this._invalidateToolData(t),a.mouseUpRender=!0,this._deactivateSculpt(n),y.cornerstone.updateImage(t.element),function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}(e)}},{key:"_renderHoverCursor",value:function(e){var t,n=e.detail,a=n.element,r=n.canvasContext.canvas.getContext("2d"),o=D(a,this.referencedToolName).data[this.configuration.currentTool];this._recentTouchEnd=!1,this.configuration.mouseUpRender?(t=this.configuration.mouseLocation.handles.start,this.configuration.mouseUpRender=!1):t=mt.mousePositionImage;var i=It(a,this.referencedToolName).distanceFromPointCanvas(a,o,t);if(this.configuration.mouseLocation.handles.start.x=t.x,this.configuration.mouseLocation.handles.start.y=t.y,this.configuration.limitRadiusOutsideRegion){var s=i;i=this._limitCursorRadiusCanvas(n,i),s>this.configuration.hoverCursorFadeDistance*i&&(r.globalAlpha=this.configuration.hoverCursorFadeAlpha)}var l={fill:null,color:this.configuration.hoverColor,handleRadius:i};dn(r,n,this.configuration.mouseLocation.handles,l),this.configuration.limitRadiusOutsideRegion&&(r.globalAlpha=1)}},{key:"newImageCallback",value:function(e){this._deselectAllTools(e)}},{key:"enabledCallback",value:function(e){this._deselectAllTools(e)}},{key:"passiveCallback",value:function(e){this._deselectAllTools(e)}},{key:"disabledCallback",value:function(e){this._deselectAllTools(e)}},{key:"_selectFreehandTool",value:function(e){var t=this.configuration,n=e.element,a=this._getClosestFreehandToolOnElement(n,e);void 0!==a&&(t.currentTool=a,Et(n))}},{key:"_activateFreehandTool",value:function(e,t){var n=D(e,this.referencedToolName).data;this.configuration.currentTool=t;for(var a=0;a<n.length;a++)n[a].active=a===t}},{key:"_initialiseSculpting",value:function(e){var t=e.detail,n=this.configuration,a=t.element;null===n.currentTool&&(this._selectFreehandTool(t),null===n.currentTool)||(this._active=!0,mt.isMultiPartToolActive=!0,this._configureToolSize(t),this._getMouseLocation(t),this._activateFreehandTool(a,n.currentTool),this._activateSculpt(a),y.cornerstone.updateImage(t.element))}},{key:"_sculpt",value:function(e,t){var n=this.configuration;this._sculptData={element:e.element,image:e.image,mousePoint:e.currentPoints.image,points:t,toolSize:this._toolSizeImage,minSpacing:n.minSpacing,maxSpacing:Math.max(this._toolSizeImage,2*n.minSpacing)};var a=this._pushHandles();void 0!==a.first&&(this._insertNewHandles(a),this._consolidateHandles())}},{key:"_pushHandles",value:function(){for(var e=this._sculptData,t=e.points,n=e.mousePoint,a=e.toolSize,r={},o=0;o<t.length;o++){var i=y.cornerstoneMath.point.distance(t[o],n);i>a||(this._pushOneHandle(o,i),void 0===r.first?(r.first=o,r.last=o):r.last=o)}return r}},{key:"_pushOneHandle",value:function(e,t){var n=this._sculptData,a=n.points,r=n.mousePoint,o=n.toolSize,i=n.image,s=a[e],l=(s.x-r.x)/t,c=(s.y-r.y)/t,u={x:r.x+o*l,y:r.y+o*c};pa(u,i),s.x=u.x,s.y=u.y;var d=this.constructor._getPreviousHandleIndex(e,a.length);a[d].lines.pop(),a[d].lines.push(s)}},{key:"_insertNewHandles",value:function(e){for(var t=this._findNewHandleIndicies(e),n=0,a=0;a<t.length;a++){var r=t[a]+1+n;this._insertHandleRadially(r),n++}}},{key:"_findNewHandleIndicies",value:function(e){for(var t=this._sculptData,n=t.points,a=t.maxSpacing,r=[],o=e.first;o<=e.last;o++)this._checkSpacing(o,n,r,a);var i=this.constructor._getNextHandleIndex(e.last,n.length);if(i!==e.first){this._checkSpacing(i,n,r,a);var s=this.constructor._getPreviousHandleIndex(e.first,n.length);s!==i&&this._checkSpacing(s,n,r,a)}return r}},{key:"_checkSpacing",value:function(e,t,n,a){var r=this.constructor._getNextHandleIndex(e,t.length);y.cornerstoneMath.point.distance(t[e],t[r])>a&&n.push(e)}},{key:"_insertHandleRadially",value:function(e){var t=this._sculptData.points,n=e-1,a=this.constructor._getNextHandleIndexBeforeInsert(e,t.length),r=this._getInsertPosition(e,n,a),o=new su(r);t.splice(e,0,o),t[n].lines.pop(),t[n].lines.push(t[e]),Ei.addLine(t,e)}},{key:"_consolidateHandles",value:function(){if(!(this._sculptData.points.length<=3)){var e=this._findCloseHandlePairs();this._mergeCloseHandles(e)}}},{key:"_findCloseHandlePairs",value:function(){for(var e=this._sculptData,t=e.points,n=e.minSpacing,a=[],r=t.length,o=0;o<r;o++){var i=this.constructor._getNextHandleIndex(o,t.length);if(y.cornerstoneMath.point.distance(t[o],t[i])<n){var s=[o,i];a.push(s),0===o&&(r-=1),o++}}return a}},{key:"_mergeCloseHandles",value:function(e){for(var t=0,n=0;n<e.length;n++){var a=this.constructor._getCorrectedPair(e[n],t);this._combineHandles(a),t++}var r=this._findCloseHandlePairs();r.length&&this._mergeCloseHandles(r)}},{key:"_combineHandles",value:function(e){var t=this._sculptData,n=t.points,a=t.image,r={x:(n[e[0]].x+n[e[1]].x)/2,y:(n[e[0]].y+n[e[1]].y)/2};pa(r,a),n[e[0]].x=r.x,n[e[0]].y=r.y;var o=this.constructor._getNextHandleIndex(e[1],n.length);n[e[0]].lines.pop(),n[e[0]].lines.push(n[o]),n.splice(e[1],1)}},{key:"_configureToolSize",value:function(e){var t=e.element,n=this.configuration,a=n.currentTool,r=e.currentPoints.image,o=D(t,this.referencedToolName).data[a],i=It(t,this.referencedToolName),s=i.distanceFromPoint(t,o,r),l=i.distanceFromPointCanvas(t,o,r);n.limitRadiusOutsideRegion&&(s=this._limitCursorRadiusImage(e,s),l=this._limitCursorRadiusCanvas(e,l)),this._toolSizeImage=s,this._toolSizeCanvas=l}},{key:"_getMouseLocation",value:function(e){var t=this.configuration;t.mouseLocation.handles.start.x=e.currentPoints.image.x,t.mouseLocation.handles.start.y=e.currentPoints.image.y,pa(t.mouseLocation.handles.start,e.image)}},{key:"_activateSculpt",value:function(e){this._deactivateSculpt(e),e.addEventListener(b.MOUSE_UP,this.activeMouseUpCallback),e.addEventListener(b.MOUSE_CLICK,this.activeMouseUpCallback),e.addEventListener(b.MOUSE_DRAG,this.activeMouseDragCallback),e.addEventListener(b.TOUCH_END,this.activeTouchEndCallback),e.addEventListener(b.TOUCH_TAP,this.activeTouchEndCallback),e.addEventListener(b.TOUCH_DRAG,this.activeMouseDragCallback),y.cornerstone.updateImage(e)}},{key:"_deactivateSculpt",value:function(e){e.removeEventListener(b.MOUSE_UP,this.activeMouseUpCallback),e.removeEventListener(b.MOUSE_CLICK,this.activeMouseUpCallback),e.removeEventListener(b.MOUSE_DRAG,this.activeMouseDragCallback),e.removeEventListener(b.TOUCH_END,this.activeTouchEndCallback),e.removeEventListener(b.TOUCH_TAP,this.activeTouchEndCallback),e.removeEventListener(b.TOUCH_DRAG,this.activeMouseDragCallback),y.cornerstone.updateImage(e)}},{key:"_invalidateToolData",value:function(e){var t=this.configuration;D(e.element,this.referencedToolName).data[t.currentTool].invalidated=!0}},{key:"_deselectAllTools",value:function(e){var t=this.configuration,n=D(this.element,this.referencedToolName);if(t.currentTool=null,n)for(var a=0;a<n.data.length;a++)n.data[a].active=!1;Ct(this.element,this.svgCursor),y.cornerstone.updateImage(this.element)}},{key:"_limitCursorRadiusCanvas",value:function(e,t){return this._limitCursorRadius(e,t,!0)}},{key:"_limitCursorRadiusImage",value:function(e,t){return this._limitCursorRadius(e,t,!1)}},{key:"_limitCursorRadius",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=e.element,r=e.image,o=this.configuration,i=D(a,this.referencedToolName),s=i.data[o.currentTool],l=1;if(n){var c=y.cornerstone.pixelToCanvas(a,{x:0,y:0}),u=y.cornerstone.pixelToCanvas(a,{x:r.width,y:r.height}),d=(u.x-c.x)*(u.y-c.y);l=d/(r.width*r.height)}var h=s.area*l,f=Math.pow(h/Math.PI,.5);return Math.min(t,f)}},{key:"_getClosestFreehandToolOnElement",value:function(e,t){var n=It(e,this.referencedToolName),a=D(e,this.referencedToolName);if(a){for(var r=a.data,o=t.currentPoints.image,i={distance:1/0,toolIndex:null},s=0;s<r.length;s++){var l=n.distanceFromPoint(e,r[s],o);-1!==l&&(l<i.distance&&(i.distance=l,i.toolIndex=s))}return i.toolIndex}}},{key:"_getInsertPosition",value:function(e,t,n){var a,r=this._sculptData,o=r.points,i=r.toolSize,s=r.mousePoint,l=r.image,c={x:(o[t].x+o[n].x)/2,y:(o[t].y+o[n].y)/2},u=y.cornerstoneMath.point.distance(s,c);if(u<i){var d={x:(c.x-s.x)/u,y:(c.y-s.y)/u};a={x:s.x+i*d.x,y:s.y+i*d.y}}else a=c;return pa(a,l),a}},{key:"minSpacing",get:function(){return this.configuration.minSpacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter minSpacing to a value other than a number.");this.configuration.minSpacing=e}},{key:"maxSpacing",get:function(){return this.configuration.maxSpacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter maxSpacing to a value other than a number.");this.configuration.maxSpacing=e}},{key:"showCursorOnHover",get:function(){return this.configuration.showCursorOnHover},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehandSculpter showCursorOnHover to a value other than a boolean.");this.configuration.showCursorOnHover=e,y.cornerstone.updateImage(this.element)}},{key:"limitRadiusOutsideRegion",get:function(){return this.configuration.limitRadiusOutsideRegion},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehandSculpter limitRadiusOutsideRegion to a value other than a boolean.");this.configuration.limitRadiusOutsideRegion=e,y.cornerstone.updateImage(this.element)}},{key:"hoverCursorFadeAlpha",get:function(){return this.configuration.hoverCursorFadeAlpha},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter hoverCursorFadeAlpha to a value other than a number.");e=Math.max(Math.min(e,1),0),this.configuration.hoverCursorFadeAlpha=e,y.cornerstone.updateImage(this.element)}},{key:"hoverCursorFadeDistance",get:function(){return this.configuration.hoverCursorFadeDistance},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter hoverCursorFadeDistance to a value other than a number.");e=Math.max(e,1),this.configuration.hoverCursorFadeDistance=e,y.cornerstone.updateImage(this.element)}}],[{key:"_getCorrectedPair",value:function(e,t){var n=[e[0]-t,e[1]-t];return n[1]<0&&(n[1]=0),n}},{key:"_getNextHandleIndex",value:function(e,t){return e===t-1?0:e+1}},{key:"_getPreviousHandleIndex",value:function(e,t){return 0===e?t-1:e-1}},{key:"_getNextHandleIndexBeforeInsert",value:function(e,t){return e===t?0:e}}]),t}(ca);function cu(){return{mouseLocation:{handles:{start:{highlight:!0,active:!0}}},minSpacing:1,currentTool:null,dragColor:un.getActiveColor(),hoverColor:un.getToolColor(),showCursorOnHover:!0,limitRadiusOutsideRegion:!0,hoverCursorFadeAlpha:.5,hoverCursorFadeDistance:1.2}}var uu=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"Magnify",supportedInteractionTypes:["Mouse","Touch"],configuration:{magnifySize:300,magnificationLevel:2},svgCursor:Er};return(e=u()(this,h()(t).call(this,n,a))).zoomCanvas=void 0,e.zoomElement=void 0,e.activeCallback=e._createMagnificationCanvas.bind(Ta()(e)),e.enabledCallback=e._createMagnificationCanvas.bind(Ta()(e)),e.disabledCallback=e._destroyMagnificationCanvas.bind(Ta()(e)),e.postTouchStartCallback=e._addMagnifyingGlass.bind(Ta()(e)),e.touchDragCallback=e._updateMagnifyingGlass.bind(Ta()(e)),e.touchEndCallback=e._removeMagnifyingGlass.bind(Ta()(e)),e.touchDragEndCallback=e._removeMagnifyingGlass.bind(Ta()(e)),e.postMouseDownCallback=e._addMagnifyingGlass.bind(Ta()(e)),e.mouseDragCallback=e._updateMagnifyingGlass.bind(Ta()(e)),e.mouseUpCallback=e._removeMagnifyingGlass.bind(Ta()(e)),e.mouseClickCallback=e._removeMagnifyingGlass.bind(Ta()(e)),e.newImageCallback=e._drawMagnificationTool.bind(Ta()(e)),e}return v()(t,e),l()(t,[{key:"_addMagnifyingGlass",value:function(e){var t=this;this._removeZoomElement(),this._drawZoomedElement(e),window.requestAnimationFrame((function(){return t._drawMagnificationTool(e)})),Et(e.detail.element),e.preventDefault(),e.stopPropagation()}},{key:"_updateMagnifyingGlass",value:function(e){this._drawMagnificationTool(e),e.preventDefault(),e.stopPropagation()}},{key:"_removeMagnifyingGlass",value:function(e){var t=e.detail.element;Ct(this.element,this.svgCursor),t.querySelector(".magnifyTool").style.display="none",this._removeZoomElement()}},{key:"_drawMagnificationTool",value:function(e){var t=e.detail.element,n=t.querySelector(".magnifyTool");if(n||this._createMagnificationCanvas(t),void 0!==this.zoomCanvas){var a=t.querySelector("canvas:not(.magnifyTool)"),r=Cn(n),o=y.cornerstone.pixelToCanvas(e.detail.element,e.detail.currentPoints.image),i=Math.min(this.configuration.magnifySize,a.width,a.height),s=this.configuration.magnificationLevel;n.width=i,n.height=i,o.x=Math.max(o.x,.5*i/s),o.x=Math.min(o.x,a.width-.5*i/s),o.y=Math.max(o.y,.5*i/s),o.y=Math.min(o.y,a.height-.5*i/s);var l={x:o.x*s-.5*i,y:o.y*s-.5*i};l.x=Math.max(l.x,0),l.y=Math.max(l.y,0),r.drawImage(this.zoomCanvas,l.x,l.y,i,i,0,0,i,i);var c=e.detail.isTouchEvent?120:0,u={top:Math.max(o.y-.5*i-c,0),left:Math.max(o.x-.5*i,0)},d=n.getBoundingClientRect();u.top=Math.min(u.top,a.height-d.height),u.left=Math.min(u.left,a.width-d.width),n.style.top="".concat(u.top,"px"),n.style.left="".concat(u.left,"px"),n.style.display="block"}}},{key:"_drawZoomedElement",value:function(e){var t=e.detail.element,n=e.detail.enabledElement;void 0===n&&(n=y.cornerstone.getEnabledElement(t));var a=this.configuration.magnificationLevel,r=n.canvas,o=n.image;this.zoomElement||(this.zoomElement=document.createElement("div"),this.zoomElement.width=r.width*a,this.zoomElement.height=r.height*a,y.cornerstone.enable(this.zoomElement,n.options));var i=y.cornerstone.getEnabledElement(this.zoomElement),s=y.cornerstone.getViewport(n.element);this.zoomCanvas=i.canvas,this.zoomCanvas.width=r.width*a,this.zoomCanvas.height=r.height*a,i.viewport=Object.assign({},s),s.scale*=a,y.cornerstone.displayImage(this.zoomElement,o),y.cornerstone.setViewport(this.zoomElement,s)}},{key:"_removeZoomElement",value:function(){void 0!==this.zoomElement&&(y.cornerstone.disable(this.zoomElement),this.zoomElement=void 0,this.zoomCanvas=void 0)}},{key:"_createMagnificationCanvas",value:function(e){if(null===e.querySelector(".magnifyTool")){var t=document.createElement("canvas");t.classList.add("magnifyTool"),t.width=this.configuration.magnifySize,t.height=this.configuration.magnifySize,t.style.position="absolute",t.style.display="none",e.appendChild(t)}}},{key:"_destroyMagnificationCanvas",value:function(e){var t=e.querySelector(".magnifyTool");t&&e.removeChild(t)}}]),t}(ca),du=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"Overlay",configuration:{},mixins:["enabledOrDisabledBinaryTool"]},r=Object.assign(a,n);return(e=u()(this,h()(t).call(this,r))).initialConfiguration=r,e}return v()(t,e),l()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){y.cornerstone.getEnabledElement(e).image&&y.cornerstone.updateImage(e)}},{key:"renderToolData",value:function(e){var t=e.detail,n=t.enabledElement,a=t.image,r=t.viewport,o=t.canvasContext;if(t&&n&&a){var i=y.cornerstone.metaData.get("overlayPlaneModule",a.imageId);if(i&&i.overlays&&i.overlays.length){var s=r.displayedArea.columnPixelSpacing||1,l=r.displayedArea.rowPixelSpacing||1,c=Math.abs(r.displayedArea.brhc.x-r.displayedArea.tlhc.x)*s,u=Math.abs(r.displayedArea.brhc.y-r.displayedArea.tlhc.y)*l;i.overlays.forEach((function(e){if(!1!==e.visible){var t=document.createElement("canvas");t.width=c,t.height=u;var n=t.getContext("2d");n.fillStyle=e.fillStyle||"white","R"===e.type&&(n.fillRect(0,0,t.width,t.height),n.globalCompositeOperation="xor");for(var a=0,r=0;r<e.rows;r++)for(var i=0;i<e.columns;i++)e.pixelData[a++]>0&&n.fillRect(i,r,1,1);var s=!isNaN(parseFloat(e.x))&&isFinite(e.x)?e.x:0,l=!isNaN(parseFloat(e.y))&&isFinite(e.y)?e.y:0;o.drawImage(t,s,l)}}))}}}}]),t}(ca),hu={getOrientationString:function(e){for(var t=en(e),n="",a=t.x<0?"R":"L",r=t.y<0?"A":"P",o=t.z<0?"F":"H",i=new y.cornerstoneMath.Vector3(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z)),s=1e-4,l=0;l<3;l++)if(i.x>s&&i.x>i.y&&i.x>i.z)n+=a,i.x=0;else if(i.y>s&&i.y>i.x&&i.y>i.z)n+=r,i.y=0;else if(i.z>s&&i.z>i.x&&i.z>i.y)n+=o,i.z=0;else if(i.x>s&&i.y>s&&i.x===i.y)n+=a+r,i.x=0,i.y=0;else if(i.x>s&&i.z>s&&i.x===i.z)n+=a+o,i.x=0,i.z=0;else{if(!(i.y>s&&i.z>s&&i.y===i.z))break;n+=r+o,i.y=0,i.z=0}return n},invertOrientationString:function(e){var t=e.replace("H","f");return t=(t=(t=(t=(t=(t=t.replace("F","h")).replace("R","l")).replace("L","r")).replace("A","p")).replace("P","a")).toUpperCase()}},fu=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"OrientationMarkers",configuration:{drawAllMarkers:!0},mixins:["enabledOrDisabledBinaryTool"]};return u()(this,h()(t).call(this,e,n))}return v()(t,e),l()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){var t=y.cornerstone;t.getEnabledElement(e).image&&t.updateImage(e)}},{key:"renderToolData",value:function(e){var t=e.detail,n=Cn(t.canvasContext.canvas),a=t.element,r=pu(a);if(r){var o=mu(a,r),i=un.getToolColor(),s={top:Tn(n,r.top,0),left:Tn(n,r.left,0),right:Tn(n,r.right,0),bottom:Tn(n,r.bottom,0),height:Tn(n,"M",0)};vu(n,r,o,s,i),this.configuration.drawAllMarkers&&gu(n,r,o,s,i)}}}]),t}(ca),vu=function(e,t,n,a,r){bn(e,t.top,n.top.x-a.top/2,n.top.y,r),bn(e,t.left,n.left.x-a.left/2,n.left.y,r)},gu=function(e,t,n,a,r){bn(e,t.right,n.right.x-a.right,n.right.y,r),bn(e,t.bottom,n.bottom.x-a.bottom/2,n.bottom.y-a.height,r)},pu=function(e){var t=y.cornerstone,n=t.getEnabledElement(e),a=t.metaData.get("imagePlaneModule",n.image.imageId);if(a&&a.rowCosines&&a.columnCosines){var r=hu.getOrientationString(a.rowCosines),o=hu.getOrientationString(a.columnCosines),i=hu.invertOrientationString(r);return{top:hu.invertOrientationString(o),bottom:o,left:i,right:r}}},mu=function(e){var t=y.cornerstone.getEnabledElement(e);return{top:y.cornerstone.pixelToCanvas(e,{x:t.image.width/2,y:5}),bottom:y.cornerstone.pixelToCanvas(e,{x:t.image.width/2,y:t.image.height-15}),left:y.cornerstone.pixelToCanvas(e,{x:5,y:t.image.height/2}),right:y.cornerstone.pixelToCanvas(e,{x:t.image.width-10,y:t.image.height/2})}},yu=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"PanMultiTouch",supportedInteractionTypes:["MultiTouch"],configuration:{touchPointers:2}};return(e=u()(this,h()(t).call(this,n,a))).multiTouchDragCallback=e._dragCallback.bind(Ta()(e)),e}return v()(t,e),l()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,a=t.viewport;if(t.numPointers===this.configuration.touchPointers){var r=this._getTranslation(t);this._applyTranslation(a,r),y.cornerstone.setViewport(n,a)}}},{key:"_getTranslation",value:function(e){var t=e.viewport,n=e.image,a=e.deltaPoints,r=t.scale,o=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?r*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(o*=n.rowPixelSpacing/n.columnPixelSpacing),{x:a.page.x/r,y:a.page.y/o}}},{key:"_applyTranslation",value:function(e,t){e.translation.x+=t.x,e.translation.y+=t.y}}]),t}(ca),xu=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"Pan",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Mr};return(e=u()(this,h()(t).call(this,n,a))).touchDragCallback=e._dragCallback.bind(Ta()(e)),e.mouseDragCallback=e._dragCallback.bind(Ta()(e)),e}return v()(t,e),l()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,a=t.viewport,r=this._getTranslation(t);this._applyTranslation(a,r),y.cornerstone.setViewport(n,a)}},{key:"_getTranslation",value:function(e){var t=e.viewport,n=e.image,a=e.deltaPoints,r=t.scale,o=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?r*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(o*=n.rowPixelSpacing/n.columnPixelSpacing),{x:a.page.x/r,y:a.page.y/o}}},{key:"_applyTranslation",value:function(e,t){e.translation.x+=t.x,e.translation.y+=t.y}}]),t}(ca),Tu=n(34),bu=n.n(Tu),Iu=n(66),wu=n.n(Iu),Cu=function(e,t,n,a){var r=y.cornerstone,o=r.getEnabledElement(n).image,i=r.getEnabledElement(a).image;if(o&&i){var s=r.metaData.get("imagePlaneModule",o.imageId),l=r.metaData.get("imagePlaneModule",i.imageId);if(s&&l&&s.rowCosines&&s.columnCosines&&s.imagePositionPatient&&l.rowCosines&&l.columnCosines&&l.imagePositionPatient&&s.frameOfReferenceUID===l.frameOfReferenceUID){s.rowCosines=en(s.rowCosines),s.columnCosines=en(s.columnCosines),s.imagePositionPatient=en(s.imagePositionPatient),l.rowCosines=en(l.rowCosines),l.columnCosines=en(l.columnCosines),l.imagePositionPatient=en(l.imagePositionPatient);var c=s.rowCosines.clone().cross(s.columnCosines),u=l.rowCosines.clone().cross(l.columnCosines),d=c.angleTo(u);if(!((d=Math.abs(d))<.5)){var h=function(e,t){var n=an(e,t);if(n)return{start:tn(n.start,e),end:tn(n.end,e)}}(s,l);if(h){var f=un.getActiveColor();e.setTransform(1,0,0,1,0,0),Gt(e,(function(e){Xt(e,t.element,h.start,h.end,{color:f})}))}}}}},Eu=function(e){return new Promise((function(t){return setTimeout(t,e)}))};function Mu(e){try{var t=y.cornerstone.getEnabledElement(e);return t.image?t:Eu(250).then((function(){return Mu(e)}))}catch(e){return null}}var ku=H("tools:ReferenceLinesTool"),Su=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"ReferenceLines",mixins:["enabledOrDisabledBinaryTool"],configuration:{renderer:Cu}};return(e=u()(this,h()(t).call(this,n,a))).renderer=null,e.synchronizationContext=null,e}var n;return v()(t,e),l()(t,[{key:"enabledCallback",value:(n=wu()(bu.a.mark((function e(t){var n,a,r,o=arguments;return bu.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},a=n.synchronizationContext,r=this.configuration.renderer,e.next=4,Mu(t);case 4:if(e.sent&&r&&a){e.next=8;break}return ku.warn("Unable to enable ".concat(this.name,". Exiting enable callback. Tool will be enabled, but will not render.")),e.abrupt("return");case 8:this.renderer=r,this.synchronizationContext=a,this.forceImageUpdate(t);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){y.cornerstone.getEnabledElement(e).image&&y.cornerstone.updateImage(e)}},{key:"renderToolData",value:function(e){var t=this,n=e.detail;if(this.renderer&&this.synchronizationContext){var a=this.synchronizationContext.getSourceElements(),r=Cn(n.canvasContext.canvas);y.cornerstone.setToPixelCoordinateSystem(n.enabledElement,r),a.forEach((function(a){a!==e.currentTarget&&t.renderer(r,n,e.currentTarget,a)}))}}}]),t}(ca),Ou=function(e,t,n){var a=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),r=Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2)),o=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2));return{angle:180*Math.acos((Math.pow(a,2)+Math.pow(r,2)-Math.pow(o,2))/(2*a*r))/Math.PI,direction:(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)}},Pu=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"Rotate",strategies:{default:_u,horizontal:Du,vertical:Lu},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{roundAngles:!1,flipHorizontal:!1,flipVertical:!1,rotateScale:1},svgCursor:kr};return u()(this,h()(t).call(this,e,n))}return v()(t,e),l()(t,[{key:"touchDragCallback",value:function(e){this.dragCallback(e)}},{key:"mouseDragCallback",value:function(e){this.dragCallback(e)}},{key:"postMouseDownCallback",value:function(e){this.initialRotation=e.detail.viewport.rotation}},{key:"dragCallback",value:function(e){e.detail.viewport.initialRotation=this.initialRotation,this.applyActiveStrategy(e),y.cornerstone.setViewport(e.detail.element,e.detail.viewport)}}]),t}(ca);function _u(e){var t=this.configuration,n=t.roundAngles,a=t.rotateScale,r=e.detail,o=r.element,i=r.viewport,s=r.startPoints,l=r.currentPoints,c=i.initialRotation,u=o.getBoundingClientRect(o),d=o.clientWidth,h=o.clientHeight,f=i.scale,v=i.translation,g={x:u.left+d/2+v.x*f,y:u.top+h/2+v.y*f},p=Ou(g,s.client,l.client);p.angle*=a,n&&(p.angle=Math.ceil(p.angle)),p.direction<0&&(p.angle=-p.angle),i.rotation=c+p.angle}function Du(e){var t=this.configuration,n=t.roundAngles,a=t.flipHorizontal,r=t.rotateScale,o=e.detail,i=o.viewport,s=o.startPoints,l=o.currentPoints,c=i.initialRotation,u=s.client.x,d=(l.client.x-u)*r;n&&(d=Math.round(Math.abs(d))*(d>0?1:-1)),a&&(d=-d),i.rotation=c+d}function Lu(e){var t=this.configuration,n=t.roundAngles,a=t.flipVertical,r=t.rotateScale,o=e.detail,i=o.viewport,s=o.startPoints,l=o.currentPoints,c=i.initialRotation,u=s.client.y,d=(l.client.y-u)*r;n&&(d=Math.round(Math.abs(d))*(d>0?1:-1)),a&&(d=-d),i.rotation=c+d}var Au,Ru=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"RotateTouch",supportedInteractionTypes:["TouchRotate"]};return u()(this,h()(t).call(this,e,n))}return v()(t,e),l()(t,[{key:"touchRotateCallback",value:function(e){var t=e.detail,n=t.element,a=t.viewport,r=t.rotation;a.rotation+=r,y.cornerstone.setViewport(n,a)}}]),t}(ca),Uu=H("tools:ScaleOverlayTool"),Bu=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"ScaleOverlay",configuration:{minorTickLength:12.5,majorTickLength:25},mixins:["enabledOrDisabledBinaryTool"]};return u()(this,h()(t).call(this,e,n))}return v()(t,e),l()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){y.cornerstone.getEnabledElement(e).image&&y.cornerstone.updateImage(e)}},{key:"renderToolData",value:function(e){var t=e.detail,n=Cn(t.canvasContext.canvas),a=t.image,r=t.viewport,o=t.element,i=a.rowPixelSpacing,s=a.columnPixelSpacing,l=y.cornerstone.metaData.get("imagePlaneModule",a.imageId);if(l&&(i=l.rowPixelSpacing||l.rowImagePixelSpacing,s=l.columnPixelSpacing||l.colImagePixelSpacing),i&&s){var c={width:n.canvas.width,height:n.canvas.height},u=10/i*r.scale,d=10/s*r.scale,h=Hu(c,.25,.05),f=Hu(c,.05,.15);if(c.width&&c.height&&h&&f){var v=un.getToolColor(),g=Yt.getToolWidth(),p=Object.assign({},{hscaleBounds:h,vscaleBounds:f,verticalMinorTick:u,horizontalMinorTick:d,verticalLine:{start:{x:f.bottomRight.x,y:f.topLeft.y},end:{x:f.bottomRight.x,y:f.bottomRight.y}},horizontalLine:{start:{x:h.topLeft.x,y:h.bottomRight.y},end:{x:h.bottomRight.x,y:h.bottomRight.y}},color:v,lineWidth:g},this.configuration);Gt(n,(function(e){Mn(e,p),Xt(e,o,p.verticalLine.start,p.verticalLine.end,{color:p.color,lineWidth:p.lineWidth},"canvas"),Nu(e,o,p),Xt(e,o,p.horizontalLine.start,p.horizontalLine.end,{color:p.color,lineWidth:p.lineWidth},"canvas"),Fu(e,o,p)}))}}else Uu.warn("unable to define rowPixelSpacing or colPixelSpacing from data on ".concat(this.name,"'s renderToolData"))}}]),t}(ca),Hu=function(e,t,n){var a=t*Math.min(1e3,e.width),r=n*Math.min(1e3,e.height),o={left:a,top:r,width:e.width-2*a,height:e.height-2*r};return{topLeft:{x:o.left,y:o.top},bottomRight:{x:o.left+o.width,y:o.top+o.height}}},Nu=function(e,t,n){for(var a=0;n.verticalLine.start.y+a*n.verticalMinorTick<=n.vscaleBounds.bottomRight.y;){var r=n.color,o=n.lineWidth,i={x:n.verticalLine.start.x,y:n.verticalLine.start.y+a*n.verticalMinorTick},s={x:0,y:n.verticalLine.start.y+a*n.verticalMinorTick};s.x=a%5==0?n.verticalLine.start.x-n.majorTickLength:n.verticalLine.start.x-n.minorTickLength,Xt(e,t,i,s,{color:r,lineWidth:o},"canvas"),a++}},Fu=function(e,t,n){for(var a=0;n.horizontalLine.start.x+a*n.horizontalMinorTick<=n.hscaleBounds.bottomRight.x;){var r=n.color,o=n.lineWidth,i={x:n.horizontalLine.start.x+a*n.horizontalMinorTick,y:n.horizontalLine.start.y},s={x:n.horizontalLine.start.x+a*n.horizontalMinorTick,y:0};s.y=a%5==0?n.horizontalLine.start.y-n.majorTickLength:n.horizontalLine.start.y-n.minorTickLength,Xt(e,t,i,s,{color:r,lineWidth:o},"canvas"),a++}},Vu={default:6,IE:{9:6,10:8,default:8},Firefox:{default:6},Opera:{10:8,11:6,12:6,default:6},Chrome:{default:6},Safari:{default:6}};function ju(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],"IE ".concat(e[1]||"")):"Chrome"===n[1]&&null!==(e=t.match(/\b(OPR|Edge)\/(\d+)/))?e.slice(1).join(" ").replace("OPR","Opera"):(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n.join(" "))}function qu(){return Au||zu()}function zu(){var e=ju().split(" "),t=e[0],n=e[1],a=Vu[t];return a?a[n]?a[n]:a.default:Vu.default}var Gu={interaction:[],thumbnail:[],prefetch:[]},Wu={interaction:0,thumbnail:0,prefetch:0},Ju={interaction:6,thumbnail:6,prefetch:5},Yu=!1;function Ku(){Yu&&setTimeout((function(){Zu()}),20)}function Xu(e){var t=y.cornerstone,n=e.type;Wu[n]++,Yu=!0;var a=e.imageId,r=e.doneCallback,o=e.failCallback,i=t.imageCache.getImageLoadObject(a);if(i)i.promise.then((function(e){Wu[n]--,r(e),Ku()}),(function(e){Wu[n]--,o(e),Ku()}));else{var s=function(e){return"prefetch"===e.type?-5:"interactive"===e.type?0:"thumbnail"===e.type?5:void 0}(e),l=Object.assign({},e.options,{priority:s,type:e.type});(!0===e.preventCache?t.loadImage(a,l):t.loadAndCacheImage(a,l)).then((function(e){Wu[n]--,r(e),Ku()}),(function(e){Wu[n]--,o(e),Ku()}))}}function Zu(){var e=qu();Ju={interaction:Math.max(e,1),thumbnail:Math.max(e-2,1),prefetch:Math.max(e-1,1)};for(var t=e-(Wu.interaction+Wu.thumbnail+Wu.prefetch),n=0;n<t;n++){var a=Qu();a&&Xu(a)}}function Qu(){return Gu.interaction.length&&Wu.interaction<Ju.interaction?Gu.interaction.shift():Gu.thumbnail.length&&Wu.thumbnail<Ju.thumbnail?Gu.thumbnail.shift():Gu.prefetch.length&&Wu.prefetch<Ju.prefetch?Gu.prefetch.shift():(Gu.interaction.length||Gu.thumbnail.length||Gu.prefetch.length||(Yu=!1),!1)}var $u={addRequest:function(e,t,n,a,r,o,i){var s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{};if(!Gu.hasOwnProperty(n))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");if(e&&t){var l={type:n,imageId:t,preventCache:a,doneCallback:r,failCallback:o,options:s},c=y.cornerstone.imageCache.getImageLoadObject(t);c?c.promise.then((function(e){r(e)}),(function(e){o(e)})):(i?Gu[n].unshift(l):Gu[n].push(l),Yu=!0)}},clearRequestStack:function(e){if(!Gu.hasOwnProperty(e))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");Gu[e]=[]},startGrabbing:Zu,getRequestPool:function(){return Gu}},ed=function(e,t){var n=D(e,"stack");if(n&&n.data&&n.data.length){var a,r=y.cornerstone;if(n.data.length>1){var o=D(e,"stackRenderer");o&&o.data&&o.data.length&&(a=o.data[0])}var i=n.data[0];t<0&&(t+=i.imageIds.length);var s=Zc.getStartLoadHandler(e),l=Zc.getEndLoadHandler(e),c=Zc.getErrorLoadingHandler(e);if(t!==i.currentImageIdIndex){s&&s(e);var u={newImageIdIndex:t,direction:t-i.currentImageIdIndex};i.currentImageIdIndex=t;var d=i.imageIds[t];(Boolean(i.preventCache)?r.loadImage(d):r.loadAndCacheImage(d)).then((function(o){if(i.currentImageIdIndex===t){try{r.getEnabledElement(e)}catch(e){return}a?(a.currentImageIdIndex=t,a.render(e,n.data)):r.displayImage(e,o),l&&l(e,o)}}),(function(n){var a=i.imageIds[t];c&&c(e,a,n)})),$u.startGrabbing(),I(e,b.STACK_SCROLL,u)}}},td=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=D(e,"stack");if(r&&r.data&&r.data.length){var o=r.data[0];o.pending||(o.pending=[]);var i=o.currentImageIdIndex+t;if(n){var s=o.imageIds.length;i%=s}else i=ma(i,0,o.imageIds.length-1);if(a)ed(e,i);else{var l={index:i};o.pending.push(l),nd(o,l,e)}}};function nd(e,t,n){if(e.pending[0]===t){if(e.currentImageIdIndex===t.index)return e.pending.splice(e.pending.indexOf(t),1),void(e.pending.length>0&&nd(e,e.pending[0],n));n.addEventListener(y.cornerstone.EVENTS.NEW_IMAGE,(function a(r){e.imageIds.indexOf(r.detail.image.imageId)===t.index&&(e.pending.splice(e.pending.indexOf(t),1),n.removeEventListener(y.cornerstone.EVENTS.NEW_IMAGE,a),e.pending.length>0&&nd(e,e.pending[0],n))})),ed(n,t.index)}}var ad=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"StackScrollMouseWheel",supportedInteractionTypes:["MouseWheel"],configuration:{loop:!1,allowSkipping:!0,invert:!1}};return u()(this,h()(t).call(this,e,n))}return v()(t,e),l()(t,[{key:"mouseWheelCallback",value:function(e){var t=e.detail,n=t.direction,a=t.element,r=this.configuration,o=r.loop,i=r.allowSkipping,s=r.invert;td(a,s?-n:n,o,i)}}]),t}(ca),rd=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"StackScrollMultiTouch",supportedInteractionTypes:["MultiTouch"],configuration:{loop:!1,allowSkipping:!0,touchPointers:3}};return(e=u()(this,h()(t).call(this,n,a))).multiTouchDragCallback=e._dragCallback.bind(Ta()(e)),e}return v()(t,e),l()(t,[{key:"_dragCallback",value:function(e){var t=e.detail;if(t.numPointers===this.configuration.touchPointers){var n=t.element,a=t.deltaPoints,r=this.configuration,o=r.loop,i=r.allowSkipping,s=$c(this.name,n),l=this._getPixelPerImage(n),c=this._getDeltaY(n,a.page.y);if(!l)return;if(Math.abs(c)>=l){var u=Math.round(c/l);td(n,u,o,i),s.deltaY=c%l}else s.deltaY=c;eu(this.name,n,s)}}},{key:"_getDeltaY",value:function(e,t){return($c(this.name,e).deltaY||0)+t}},{key:"_getPixelPerImage",value:function(e){var t=D(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];return this.configuration.stackScrollSpeed||Math.max(2,e.offsetHeight/Math.max(n.imageIds.length,8))}}}]),t}(ca),od=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"StackScroll",supportedInteractionTypes:["Mouse","Touch"],configuration:{loop:!1,allowSkipping:!0},svgCursor:Sr};return(e=u()(this,h()(t).call(this,n,a))).mouseDragCallback=e._dragCallback.bind(Ta()(e)),e.touchDragCallback=e._dragCallback.bind(Ta()(e)),e}return v()(t,e),l()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,a=t.deltaPoints,r=this.configuration,o=r.loop,i=r.allowSkipping,s=$c(this.name,n),l=this._getPixelPerImage(n),c=this._getDeltaY(n,a.page.y);if(l){if(Math.abs(c)>=l){var u=Math.round(c/l);td(n,u,o,i),s.deltaY=c%l}else s.deltaY=c;eu(this.name,n,s)}}},{key:"_getDeltaY",value:function(e,t){return($c(this.name,e).deltaY||0)+t}},{key:"_getPixelPerImage",value:function(e){var t=D(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];return this.configuration.stackScrollSpeed||Math.max(2,e.offsetHeight/Math.max(n.imageIds.length,8))}}}]),t}(ca),id=function(e,t,n,a,r){if(!e)throw new Error("getLuminance: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var o,i,s,l=y.cornerstone.getEnabledElement(e).image,c=[],u=0,d=l.getPixelData();if(l.color)for(i=0;i<r;i++)for(s=0;s<a;s++){var h=d[o=4*((i+n)*l.columns+(s+t))],f=d[o+1],v=d[o+2];c[u++]=.2126*h+.7152*f+.0722*v}else for(i=0;i<r;i++)for(s=0;s<a;s++)o=(i+n)*l.columns+(s+t),c[u++]=d[o]*l.slope+l.intercept;return c},sd=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"WwwcRegion",supportedInteractionTypes:["Mouse","Touch"],configuration:{minWindowWidth:10},svgCursor:Or};return(e=u()(this,h()(t).call(this,n,a)))._resetHandles(),e.postTouchStartCallback=e._startOutliningRegion.bind(Ta()(e)),e.touchDragCallback=e._setHandlesAndUpdate.bind(Ta()(e)),e.touchEndCallback=e._applyStrategy.bind(Ta()(e)),e.postMouseDownCallback=e._startOutliningRegion.bind(Ta()(e)),e.mouseClickCallback=e._startOutliningRegion.bind(Ta()(e)),e.mouseDragCallback=e._setHandlesAndUpdate.bind(Ta()(e)),e.mouseMoveCallback=e._setHandlesAndUpdate.bind(Ta()(e)),e.mouseUpCallback=e._applyStrategy.bind(Ta()(e)),e}return v()(t,e),l()(t,[{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=n.element,r=un.getColorIfActive({active:!0}),o=Cn(n.canvasContext.canvas);Gt(o,(function(e){wn(e,a,t.handles.start,t.handles.end,{color:r})}))}},{key:"_startOutliningRegion",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.image;return ld(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),y.cornerstone.updateImage(t),!0}},{key:"_setHandlesAndUpdate",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.image;this.handles.end=n,y.cornerstone.updateImage(t)}},{key:"_applyStrategy",value:function(e){ld(this.handles.start)||ld(this.handles.end)||(e.detail.handles=this.handles,cd(e,this.configuration),this._resetHandles())}},{key:"_resetHandles",value:function(){this.handles={start:{},end:{}}}}]),t}(ca),ld=function(e){return 0===Object.keys(e).length&&e.constructor===Object},cd=function(e,t){var n=e.detail,a=n.image,r=n.element,o=e.detail.handles,i=o.start,s=o.end,l=Math.min(i.x,s.x),c=Math.min(i.y,s.y),u=Math.abs(i.x-s.x),d=Math.abs(i.y-s.y);l=ma(l,0,a.width),c=ma(c,0,a.height),u=Math.floor(Math.min(u,Math.abs(a.width-l))),d=Math.floor(Math.min(d,Math.abs(a.height-c)));var h=id(r,l,c,u,d),f=ud(h,a.minPixelValue,a.maxPixelValue),v=n.viewport;void 0===t.minWindowWidth&&(t.minWindowWidth=10),v.voi.windowWidth=Math.max(Math.abs(f.max-f.min),t.minWindowWidth),v.voi.windowCenter=f.mean,v.voiLUT=void 0,y.cornerstone.setViewport(r,v),y.cornerstone.updateImage(r)},ud=function(e,t,n){var a=e.length,r=n,o=t,i=0;if(a<2)return{min:r,max:o,mean:(t+n)/2};for(var s=0;s<a;s++){var l=e[s];r=Math.min(r,l),o=Math.max(o,l),i+=l}return{min:r,max:o,mean:i/a}},dd=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"Wwwc",strategies:{basicLevelingStrategy:hd},supportedInteractionTypes:["Mouse","Touch"],configuration:{orientation:0},svgCursor:Pr};return u()(this,h()(t).call(this,e,n))}return v()(t,e),l()(t,[{key:"mouseDragCallback",value:function(e){this.applyActiveStrategy(e),y.cornerstone.setViewport(e.detail.element,e.detail.viewport)}},{key:"touchDragCallback",value:function(e){e.stopImmediatePropagation(),this.applyActiveStrategy(e),y.cornerstone.setViewport(e.detail.element,e.detail.viewport)}}]),t}(ca);function hd(e){var t=this.configuration.orientation,n=e.detail,a=(n.image.maxPixelValue*n.image.slope+n.image.intercept-(n.image.minPixelValue*n.image.slope+n.image.intercept))/1024,r=n.deltaPoints.page.x*a,o=n.deltaPoints.page.y*a;0===t?(n.viewport.voi.windowWidth+=r,n.viewport.voi.windowCenter+=o):(n.viewport.voi.windowWidth+=o,n.viewport.voi.windowCenter+=r),n.viewport.voiLUT=void 0}var fd=function(e,t,n){var a=n.maxScale,r=n.minScale,o=Math.log(e.scale)/Math.log(1.7)+t,i=Math.pow(1.7,o);return e.scale=a&&i>a?a:r&&i<r?r:i,e},vd={changeViewportScale:fd,correctShift:function(e,t){var n=t.hflip,a=t.vflip,r=t.rotation;if(e.x*=n?-1:1,e.y*=a?-1:1,0!==r){var o=r*Math.PI/180,i=Math.cos(o),s=Math.sin(o),l=e.x*i-e.y*s,c=e.x*s+e.y*i;e.x=l,e.y=c}return e}},gd=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"ZoomMouseWheel",supportedInteractionTypes:["MouseWheel"],configuration:{minScale:.25,maxScale:20,invert:!1}};return u()(this,h()(t).call(this,e,n))}return v()(t,e),l()(t,[{key:"mouseWheelCallback",value:function(e){var t=e.detail,n=t.element,a=t.viewport,r=t.spinY,o=this.configuration,i=o.invert,s=o.maxScale,l=o.minScale,c=fd(a,i?r/4:-r/4,{maxScale:s,minScale:l});y.cornerstone.setViewport(n,c)}}]),t}(ca),pd=vd.correctShift,md=vd.changeViewportScale,yd=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"Zoom",strategies:{default:Td,translate:bd,zoomToCenter:Id},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,preventZoomOutsideImage:!1,minScale:.25,maxScale:20},svgCursor:_r};return u()(this,h()(t).call(this,e,n))}return v()(t,e),l()(t,[{key:"touchDragCallback",value:function(e){xd.call(this,e)}},{key:"mouseDragCallback",value:function(e){xd.call(this,e)}}]),t}(ca),xd=function(e){if(!e.detail.deltaPoints.page.y)return!1;this.applyActiveStrategy(e,this.configuration),y.cornerstone.setViewport(e.detail.element,e.detail.viewport)};function Td(e){var t=this.configuration,n=t.invert,a=t.maxScale,r=t.minScale,o=e.detail.deltaPoints.page.y,i=n?-o/100:o/100,s=e.detail,l=s.element,c=s.viewport,u=[e.detail.startPoints.page.x,e.detail.startPoints.page.y,e.detail.startPoints.image.x,e.detail.startPoints.image.y],d=u[0],h=u[1],f=u[2],v=u[3],g=md(c,i,{maxScale:a,minScale:r});y.cornerstone.setViewport(l,g);var p=y.cornerstone.pageToPixel(l,d,h),m={x:f-p.x,y:v-p.y};m=pd(m,g),c.translation.x-=m.x,c.translation.y-=m.y}function bd(e){var t=this.configuration,n=t.invert,a=t.preventZoomOutsideImage,r=t.maxScale,o=t.minScale,i=e.detail.deltaPoints.page.y,s=n?-i/100:i/100,l=e.detail.image,c=e.detail.viewport,u=[e.detail.startPoints.image.x,e.detail.startPoints.image.y],d=u[0],h=u[1],f=md(c,s,{maxScale:r,minScale:o}),v={x:0,y:0};if(s<0)f.scale<3&&(Math.abs(f.translation.x)<.01?f.translation.x=0:v.x=f.translation.x/8,Math.abs(f.translation.y)<.01?f.translation.y=0:v.y=f.translation.y/8);else{a&&pa(e.detail.startPoints.image,l);var g={x:l.width/2-d,y:l.height/2-h};g=pd(g,f);var p={x:f.translation.x-g.x,y:f.translation.y-g.y};Math.abs(p.x)<.01?f.translation.x=g.x:v.x=p.x/8,Math.abs(p.y)<.01?f.translation.y=g.y:v.y=p.y/8}f.translation.x-=v.x,f.translation.y-=v.y}function Id(e){var t=this.configuration,n=t.invert,a=t.maxScale,r=t.minScale,o=e.detail.deltaPoints.page.y,i=n?-o/100:o/100,s=e.detail.viewport;md(s,i,{maxScale:a,minScale:r})}var wd=vd.correctShift,Cd=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"ZoomTouchPinch",supportedInteractionTypes:["TouchPinch"],configuration:{minScale:.25,maxScale:20}};return u()(this,h()(t).call(this,e,n))}return v()(t,e),l()(t,[{key:"touchPinchCallback",value:function(e){var t=e.detail,n=t.element,a=t.viewport,r=t.scaleChange,o=[e.detail.startPoints.page.x,e.detail.startPoints.page.y,e.detail.startPoints.image.x,e.detail.startPoints.image.y],i=o[0],s=o[1],l=o[2],c=o[3],u=this.configuration,d=u.maxScale,h=u.minScale;a.scale+=r*a.scale,d&&a.scale>d?a.scale=d:h&&a.scale<h&&(a.scale=h),y.cornerstone.setViewport(n,a);var f=y.cornerstone.pageToPixel(n,i,s),v={x:l-f.x,y:c-f.y};v=wd(v,a),a.translation.x-=v.x,a.translation.y-=v.y,y.cornerstone.setViewport(n,a)}}]),t}(ca),Ed=function(e){return{page:Md(e.page),image:Md(e.image),client:Md(e.client),canvas:Md(e.canvas)}};function Md(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.x,n=e.y;return{x:t,y:n}}var kd,Sd=H("eventListeners:mouseEventListeners"),Od=!0;function Pd(e){if("number"==typeof e.buttons)return e.buttons;switch(e.which){case 0:return 0;case 1:return 1;case 2:return 4;case 3:return 2}return 0}function _d(){Od=!1}function Dd(e){var t=e.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image){var a=b.MOUSE_DOUBLE_CLICK,r={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};r.canvas=y.cornerstone.pixelToCanvas(t,r.image);var o=Ed(r);Sd.log("double-click: %o",Pd(e)),I(t,a,{event:e,buttons:Pd(e),viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:r,lastPoints:o,currentPoints:r,deltaPoints:{x:0,y:0},type:a})}}function Ld(e){var t=e.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image){kd=setTimeout(_d,200),t.removeEventListener("mousemove",Ad);var a={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};a.canvas=y.cornerstone.pixelToCanvas(t,a.image);var r=Ed(a),o={event:e,buttons:Pd(e),viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:a,lastPoints:r,currentPoints:a,deltaPoints:{x:0,y:0},type:b.MOUSE_DOWN};I(o.element,b.MOUSE_DOWN,o)&&(o.type=b.MOUSE_DOWN_ACTIVATE,I(o.element,b.MOUSE_DOWN_ACTIVATE,o)),document.addEventListener("mousemove",i),document.addEventListener("mouseup",(function e(o){clearTimeout(kd);var s=b.MOUSE_UP;Od&&(s=b.MOUSE_CLICK);var l={page:y.cornerstoneMath.point.pageToPoint(o),image:y.cornerstone.pageToPixel(t,o.pageX,o.pageY),client:{x:o.clientX,y:o.clientY}};l.canvas=y.cornerstone.pixelToCanvas(t,l.image);var c={page:y.cornerstoneMath.point.subtract(l.page,r.page),image:y.cornerstoneMath.point.subtract(l.image,r.image),client:y.cornerstoneMath.point.subtract(l.client,r.client),canvas:y.cornerstoneMath.point.subtract(l.canvas,r.canvas)};Sd.log("mouseup: %o",Pd(o));var u={event:o,buttons:Pd(o),viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:a,lastPoints:r,currentPoints:l,deltaPoints:c,type:s};I(u.element,s,u),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",e),t.addEventListener("mousemove",Ad),Od=!0}))}function i(e){var o=b.MOUSE_DRAG,i={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};i.canvas=y.cornerstone.pixelToCanvas(t,i.image);var s={page:y.cornerstoneMath.point.subtract(i.page,r.page),image:y.cornerstoneMath.point.subtract(i.image,r.image),client:y.cornerstoneMath.point.subtract(i.client,r.client),canvas:y.cornerstoneMath.point.subtract(i.canvas,r.canvas)};Sd.log("mousemove: %o",Pd(e));var l={buttons:Pd(e),viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:a,lastPoints:r,currentPoints:i,deltaPoints:s,type:o,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey};I(l.element,o,l),r=Ed(i)}}function Ad(e){var t=e.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image){var a=b.MOUSE_MOVE,r={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};r.canvas=y.cornerstone.pixelToCanvas(t,r.image);var o=Ed(r),i={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};i.canvas=y.cornerstone.pixelToCanvas(t,i.image);var s={page:y.cornerstoneMath.point.subtract(i.page,o.page),image:y.cornerstoneMath.point.subtract(i.image,o.image),client:y.cornerstoneMath.point.subtract(i.client,o.client),canvas:y.cornerstoneMath.point.subtract(i.canvas,o.canvas)};I(t,a,{viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:r,lastPoints:o,currentPoints:i,deltaPoints:s,type:a}),o=Ed(i)}}function Rd(e){e.removeEventListener("mousedown",Ld),e.removeEventListener("mousemove",Ad),e.removeEventListener("dblclick",Dd)}var Ud={enable:function(e){Rd(e),e.addEventListener("mousedown",Ld),e.addEventListener("mousemove",Ad),e.addEventListener("dblclick",Dd)},disable:Rd};function Bd(e){var t=e.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image&&!(e.deltaY>-1&&e.deltaY<1)){e.preventDefault();var a=e.pageX,r=e.pageY,o=y.cornerstone.pageToPixel(t,a,r),i=function(e){var t=0,n=0,a=0,r=0;return"detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),a=10*t,r=10*n,"deltaY"in e&&(r=e.deltaY),"deltaX"in e&&(a=e.deltaX),(a||r)&&e.deltaMode&&(1===e.deltaMode?(a*=40,r*=40):(a*=800,r*=800)),a&&!t&&(t=a<1?-1:1),r&&!n&&(n=r<1?-1:1),{spinX:t,spinY:n,pixelX:a,pixelY:r}}(e),s=i.spinX,l=i.spinY,c=i.pixelX,u=i.pixelY,d=l<0?-1:1,h={element:t,viewport:y.cornerstone.getViewport(t),detail:e,image:n.image,direction:d,spinX:s,spinY:l,pixelX:c,pixelY:u,pageX:a,pageY:r,imageX:o.x,imageY:o.y};I(t,b.MOUSE_WHEEL,h)}}function Hd(e){e.removeEventListener("wheel",Bd,{passive:!1})}var Nd,Fd,Vd={enable:function(e){Hd(e),e.addEventListener("wheel",Bd,{passive:!1})},disable:Hd},jd=0,qd=1;function zd(e,t){var n=Date.now();if(e!==Nd){if(n-Fd<=2e3)return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1;Nd=e}Fd=n}var Gd=zd.bind(null,jd),Wd=zd.bind(null,qd);function Jd(e,t,n){var a=n?Gd:Wd;t.forEach((function(t){e.addEventListener(t,a,{passive:!1})}))}function Yd(e,t,n){var a=n?Gd:Wd;t.forEach((function(t){e.removeEventListener(t,a)}))}var Kd=["mousedown","mouseup"],Xd=["touchstart","touchend"];function Zd(e){Yd(e,Kd,jd),Yd(e,Xd,qd)}var Qd,$d,eh,th,nh,ah,rh,oh,ih,sh={enable:function(e){Zd(e),Jd(e,Kd,jd),Jd(e,Xd,qd)},disable:Zd},lh=1,ch=0,uh=!1,dh=!1;function hh(e){var t=e.currentTarget||e.srcEvent.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image){var a,r,o,i;switch(e.preventDefault(),(e.pointers&&e.pointers.length>1||e.touches&&e.touches.length>1)&&(dh=!1,clearTimeout(rh)),e.type){case"tap":dh=!1,clearTimeout(rh),($d={page:y.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:y.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,$d.image),a=b.TAP,nh={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:$d,type:a,isTouchEvent:!0},I(t,a,nh);break;case"doubletap":dh=!1,clearTimeout(rh),($d={page:y.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:y.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,$d.image),a=b.DOUBLE_TAP,nh={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:$d,type:a,isTouchEvent:!0},I(t,a,nh);break;case"pinchstart":dh=!1,clearTimeout(rh),lh=1;break;case"pinchmove":if(dh=!1,clearTimeout(rh),!0===uh){lh=e.scale,uh=!1;break}r=(e.scale-lh)/lh,(Qd={page:e.center,image:y.cornerstone.pageToPixel(t,e.center.x,e.center.y)}).canvas=y.cornerstone.pixelToCanvas(t,Qd.image),a=b.TOUCH_PINCH,nh={event:e,startPoints:Qd,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,direction:e.scale<1?1:-1,scaleChange:r,type:a,isTouchEvent:!0},I(t,a,nh),lh=e.scale;break;case"touchstart":lh=1,clearTimeout(rh),clearTimeout(ah),ah=setTimeout((function(){(Qd={page:y.cornerstoneMath.point.pageToPoint(e.touches[0]),image:y.cornerstone.pageToPixel(t,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Qd.image),a=b.TOUCH_START,e.touches.length>1&&(a=b.MULTI_TOUCH_START),nh={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Qd,currentPoints:Qd,type:a,isTouchEvent:!0},!0===I(t,a,nh)&&(a=b.TOUCH_START_ACTIVE,e.touches.length>1&&(a=b.MULTI_TOUCH_START_ACTIVE),nh.type=a,I(t,a,nh)),eh=Ed(Qd)}),50),dh=!0,oh=0,rh=setTimeout((function(){dh&&(($d={page:y.cornerstoneMath.point.pageToPoint(e.touches[0]),image:y.cornerstone.pageToPixel(t,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Qd.image),a=b.TOUCH_PRESS,nh={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:$d,type:a,isTouchEvent:!0},I(t,a,nh))}),700);break;case"touchend":lh=1,dh=!1,clearTimeout(rh),setTimeout((function(){(Qd={page:y.cornerstoneMath.point.pageToPoint(e.changedTouches[0]),image:y.cornerstone.pageToPixel(t,e.changedTouches[0].pageX,e.changedTouches[0].pageY),client:{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Qd.image),a=b.TOUCH_END,nh={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Qd,currentPoints:Qd,type:a,isTouchEvent:!0},I(t,a,nh)}),50);break;case"panmove":o={x:e.deltaX-ih.x,y:e.deltaY-ih.y},ih={x:e.deltaX,y:e.deltaY},($d={page:{x:eh.page.x+o.x,y:eh.page.y+o.y},image:y.cornerstone.pageToPixel(t,eh.page.x+o.x,eh.page.y+o.y),client:{x:eh.client.x+o.x,y:eh.client.y+o.y}}).canvas=y.cornerstone.pixelToCanvas(t,$d.image),th={page:y.cornerstoneMath.point.subtract($d.page,eh.page),image:y.cornerstoneMath.point.subtract($d.image,eh.image),client:y.cornerstoneMath.point.subtract($d.client,eh.client),canvas:y.cornerstoneMath.point.subtract($d.canvas,eh.canvas)},(oh+=Math.sqrt(th.page.x*th.page.x+th.page.y*th.page.y))>5&&(dh=!1,clearTimeout(rh)),a=b.TOUCH_DRAG,e.pointers.length>1&&(a=b.MULTI_TOUCH_DRAG),nh={viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Qd,lastPoints:eh,currentPoints:$d,deltaPoints:th,numPointers:e.pointers.length,type:a,isTouchEvent:!0},I(t,a,nh),eh=Ed($d);break;case"panstart":ih={x:e.deltaX,y:e.deltaY},($d={page:y.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:y.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,$d.image),eh=Ed($d);break;case"panend":if(dh=!1,clearTimeout(rh),!eh)return!1;($d={page:y.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:y.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,$d.image),th={page:y.cornerstoneMath.point.subtract($d.page,eh.page),image:y.cornerstoneMath.point.subtract($d.image,eh.image),client:y.cornerstoneMath.point.subtract($d.client,eh.client),canvas:y.cornerstoneMath.point.subtract($d.canvas,eh.canvas)},a=b.TOUCH_DRAG_END,nh={event:e.srcEvent,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Qd,lastPoints:eh,currentPoints:$d,deltaPoints:th,type:a,isTouchEvent:!0},I(t,a,nh),2===e.pointers.length-e.changedPointers.length&&(uh=!0);break;case"rotatemove":dh=!1,clearTimeout(rh),i=e.rotation-ch,ch=e.rotation,a=b.TOUCH_ROTATE,nh={event:e.srcEvent,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,rotation:i,type:a},I(t,a,nh)}return!1}}function fh(e){sh.disable(e);["touchstart","touchend"].forEach((function(t){e.removeEventListener(t,hh)}));var t=$c("touchInput",e).hammer;t&&t.off("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",hh)}var vh={enable:function(e){fh(e);var t=y.Hammer,n={inputClass:t.SUPPORT_POINTER_EVENTS?t.PointerEventInput:t.TouchInput},a=new t.Manager(e,n),r={pointers:0,direction:t.DIRECTION_ALL,threshold:0},o=new t.Pan(r),i=new t.Pinch({threshold:0}),s=new t.Rotate({threshold:0});i.recognizeWith(o),i.recognizeWith(s),s.recognizeWith(o);var l=new t.Tap({event:"doubletap",taps:2,interval:1500,threshold:50,posThreshold:50});l.recognizeWith(o),a.add([l,o,s,i]),a.on("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",hh),sh.enable(e),["touchstart","touchend"].forEach((function(t){e.addEventListener(t,hh,{passive:!1})}));var c=$c("touchInput",e);c.hammer=a,eu("touchInput",e,c)},disable:fh},gh=Tt("segmentation");function ph(e,t,n,a,r){!function(e,t,n){var a=gh.configuration,r=e.detail,o=Cn(r.canvasContext.canvas),i=y.cornerstone.pixelToCanvas(r.element,{x:0,y:0}),s=y.cornerstone.pixelToCanvas(r.element,{x:r.image.width,y:0}),l=y.cornerstone.pixelToCanvas(r.element,{x:r.image.width,y:r.image.height}),c=y.cornerstoneMath.point.distance(i,s),u=y.cornerstoneMath.point.distance(s,l),d=r.canvasContext.canvas,h=r.viewport,f=o.imageSmoothingEnabled,v=o.globalAlpha;o.imageSmoothingEnabled=!1,o.globalAlpha=n?a.fillAlpha:a.fillAlphaInactive,function(e,t,n){if(n.hflip||n.vflip||n.rotation){var a={x:t.width/2+n.translation.x*n.scale,y:t.height/2+n.translation.y*n.scale};e.translate(a.x,a.y),n.rotation&&e.rotate(n.rotation*Math.PI/180),n.vflip&&e.scale(1,-1),n.hflip&&e.scale(-1,1),e.translate(-a.x,-a.y)}}(o,d,h);var g=function(e){var t=e.viewport,n=e.image,a=t.scale,r=t.scale;n.rowPixelSpacing<n.columnPixelSpacing?a*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(r*=n.rowPixelSpacing/n.columnPixelSpacing);return{x:t.translation.x*a,y:t.translation.y*r}}(r);o.drawImage(t,d.width/2-c/2+g.x,d.height/2-u/2+g.y,c,u),o.globalAlpha=v,o.imageSmoothingEnabled=f,function(e){e.setTransform(1,0,0,1,0,0)}(o)}(e,function(e,t,n){var a=gh.state,r=e.detail.image,o=r.width,i=r.height,s=t.segmentsHidden,l=n.pixelData,c=a.colorLutTables[t.colorLUTIndex];n.canvasElement&&n.canvasElement.width==o&&n.canvasElement.height==i||(n.canvasElement=document.createElement("canvas"),n.canvasElement.width=o,n.canvasElement.height=i,n.ctx=Cn(n.canvasElement),n.imageData=new ImageData(o,i),n.canvasElementNeedsUpdate=!0);if(n.canvasElementNeedsUpdate){for(var u=n.imageData.data,d=0;d<l.length;d++){var h=l[d];if(0===h||s[h])u[4*d]=0,u[4*d+1]=0,u[4*d+2]=0,u[4*d+3]=0;else{var f=c[l[d]];u[4*d]=f[0],u[4*d+1]=f[1],u[4*d+2]=f[2],u[4*d+3]=f[3]}}n.canvasElementNeedsUpdate=!1,n.ctx.putImageData(n.imageData,0,0)}return n.canvasElement}(e,t,n),r)}var mh=Tt("segmentation");function yh(e,t,n,a,r){!function(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=mh.configuration,o=mh.state,i=e.detail,s=i.element,l=i.canvasContext,c=r.outlineWidth||1,u=Cn(l.canvas),d=o.colorLutTables[n],h=u.globalAlpha;u.globalAlpha=a?r.outlineAlpha:r.outlineAlphaInactive,Gt(u,(function(e){for(var n=1;n<t.length;n++)if(t[n]){var a=d[n];hn(e,s,t[n],{color:"rgba(".concat(a[0],", ").concat(a[1],", ").concat(a[2],", 1.0 )"),lineWidth:c},"canvas")}})),u.globalAlpha=h}(e,function(e,t,n,a){var r=e.detail,o=r.element,i=r.image,s=r.viewport,l=i.width,c=i.height;a=a||1;var u=t.segmentsHidden,d=n.pixelData,h=t.activeSegmentIndex,f=[];n.segmentsOnLabelmap.forEach((function(e){!u[e]&&(f[e]=[])})),f[h]||(f[h]=[]);for(var v=function(e,t){var n=t/2,a=e.rotation;a*=Math.PI/180;var r=Math.cos(a),o=Math.sin(a),i=[r,o],s=[-o,r],l={x:n*i[0],y:n*i[1]},c={x:n*s[0],y:n*s[1]};e.hflip&&(l.x*=-1,l.y*=-1);e.vflip&&(c.x*=-1,c.y*=-1);return{i:l,j:c}}(s,a),g=0;g<d.length;g++){var p=d[g];if(0!==p)if(!u[p]){var m={x:(x=g)%l,y:Math.floor(x/l)},y=xh(m,c,l);void 0!==y.top&&d[y.top]===p||Ch(f[p],o,m,v),void 0!==y.bottom&&d[y.bottom]===p||Eh(f[p],o,m,v),void 0!==y.left&&d[y.left]===p||Mh(f[p],o,m,v),void 0!==y.right&&d[y.right]===p||kh(f[p],o,m,v),void 0!==y.topLeft&&d[y.topLeft]!==p&&d[y.top]===p&&d[y.left]===p&&Th(f[p],o,m,v),void 0!==y.topRight&&d[y.topRight]!==p&&d[y.top]===p&&d[y.right]===p&&bh(f[p],o,m,v),void 0!==y.bottomLeft&&d[y.bottomLeft]!==p&&d[y.bottom]===p&&d[y.left]===p&&Ih(f[p],o,m,v),void 0!==y.bottomRight&&d[y.bottomRight]!==p&&d[y.bottom]===p&&d[y.right]===p&&wh(f[p],o,m,v)}}var x;return f}(e,t,n,mh.configuration.outlineWidth),t.colorLUTIndex,r)}function xh(e,t,n){var a=e.y*n+e.x,r={},o=e.y-1>=0,i=e.y+1<t,s=e.x-1>=0,l=e.x+1<n;return o&&(r.top=a-n,l&&(r.topRight=r.top+1),s&&(r.topLeft=r.top-1)),i&&(r.bottom=a+n,l&&(r.bottomRight=r.bottom+1),s&&(r.bottomLeft=r.bottom-1)),s&&(r.left=a-1),l&&(r.right=a+1),r}function Th(e,t,n,a){var r=(0,y.cornerstone.pixelToCanvas)(t,n);r.x+=a.j.x,r.y+=a.j.y;var o={x:r.x,y:r.y};o.x+=2*a.i.x,o.y+=2*a.i.y,e.push({start:r,end:o})}function bh(e,t,n,a){var r=(0,y.cornerstone.pixelToCanvas)(t,{x:n.x+1,y:n.y});r.x+=a.j.x,r.y+=a.j.y;var o={x:r.x,y:r.y};o.x-=2*a.i.x,o.y-=2*a.i.y,e.push({start:r,end:o})}function Ih(e,t,n,a){var r=(0,y.cornerstone.pixelToCanvas)(t,{x:n.x,y:n.y+1});r.x-=a.j.x,r.y-=a.j.y;var o={x:r.x,y:r.y};o.x+=2*a.i.x,o.y+=2*a.i.y,e.push({start:r,end:o})}function wh(e,t,n,a){var r=(0,y.cornerstone.pixelToCanvas)(t,{x:n.x+1,y:n.y+1});r.x-=a.j.x,r.y-=a.j.y;var o={x:r.x,y:r.y};o.x-=2*a.i.x,o.y-=2*a.i.y,e.push({start:r,end:o})}function Ch(e,t,n,a){var r=y.cornerstone.pixelToCanvas,o=r(t,n),i=r(t,{x:n.x+1,y:n.y});o.x+=a.j.x,o.y+=a.j.y,i.x+=a.j.x,i.y+=a.j.y,e.push({start:o,end:i})}function Eh(e,t,n,a){var r=y.cornerstone.pixelToCanvas,o=r(t,{x:n.x,y:n.y+1}),i=r(t,{x:n.x+1,y:n.y+1});o.x-=a.j.x,o.y-=a.j.y,i.x-=a.j.x,i.y-=a.j.y,e.push({start:o,end:i})}function Mh(e,t,n,a){var r=y.cornerstone.pixelToCanvas,o=r(t,n),i=r(t,{x:n.x,y:n.y+1});o.x+=a.i.x,o.y+=a.i.y,i.x+=a.i.x,i.y+=a.i.y,e.push({start:o,end:i})}function kh(e,t,n,a){var r=y.cornerstone.pixelToCanvas,o=r(t,{x:n.x+1,y:n.y}),i=r(t,{x:n.x+1,y:n.y+1});o.x-=a.i.x,o.y-=a.i.y,i.x-=a.i.x,i.y-=a.i.y,e.push({start:o,end:i})}var Sh=Tt("segmentation");function Oh(e,t,n,a,r){(function(e){var t=Sh.configuration;return t.renderFill&&(e&&0!==t.fillAlpha||!e&&0!==t.fillAlphaInactive)})(r)&&ph(e,t,a,0,r),function(e){var t=Sh.configuration;return t.renderOutline&&(e&&0!==t.outlineAlpha||!e&&0!==t.outlineAlphaInactive)}(r)&&yh(e,t,a,0,r)}var Ph=Tt("segmentation"),_h=function(e){var t=e.detail.element,n=Ph.configuration,a=Ph.getters.labelmaps3D(t),r=a.activeLabelmapIndex,o=a.labelmaps3D,i=a.currentImageIdIndex;o&&(n.shouldRenderInactiveLabelmaps&&function(e,t,n,a){for(var r=0;r<t.length;r++){var o=t[r];if(r!==n&&o){var i=o.labelmaps2D[a];i&&Oh(e,o,0,i,!1)}}}(e,o,r,i),function(e,t,n,a){var r=t[n];if(!r)return;var o=r.labelmaps2D[a];o&&Oh(e,r,0,o,!0)}(e,o,r,i))};var Dh=Tt("segmentation"),Lh=function(e){var t=e.detail,n=t.element,a=mt.tools.filter((function(e){return e.element===n&&("active"===e.mode||"passive"===e.mode||"enabled"===e.mode)})),r=D(n,"stack"),o=Dh.configuration;r&&(o.renderFill||o.renderOutline)&&_h(e);var i=t.canvasContext.canvas.getContext("2d");a.forEach((function(t){t.renderToolData&&(i.save(),t.renderToolData(e),i.restore())}))},Ah=function(e){e.addEventListener(y.cornerstone.EVENTS.IMAGE_RENDERED,Lh)},Rh=function(e){e.removeEventListener(y.cornerstone.EVENTS.IMAGE_RENDERED,Lh)},Uh=function(e,t,n){if(mt.isToolLocked)return!1;var a=n.detail.element,r=mt.tools.filter((function(t){return t.supportedInteractionTypes.includes(e)}));if(r=(r=ya(a,r,e)).filter((function(e){return"function"==typeof e[t]})),mt.isMultiPartToolActive&&(r=Ca(r)),0===r.length)return!1;r[0][t](n)},Bh=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",r="mouse"===a?mt.clickProximity:mt.touchProximity;return t.filter((function(t){for(var a=D(e,t.name),o=0;o<a.data.length;o++)if(void 0!==ha(e,a.data[o].handles,n,r))return!0;return!1}))},Hh=function(e,t){return t.filter((function(t){return t.element===e&&("active"===t.mode||"passive"===t.mode)}))},Nh=function(e,t){return t.filter((function(t){var n=D(e,t.name);return n&&n.data.length>0}))},Fh=function(e){if(!mt.isToolLocked){var t=e.detail,n=e.detail.element,a=e.detail.currentPoints.canvas,r=Hh(n,yt.mouseTools()),o=r.filter((function(e){return"active"===e.mode&&Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.includes(t.buttons)&&e.options.isMouseActive}));if(mt.isMultiPartToolActive&&(o=Ca(o)),o.length>0){var i=o.find((function(e){return"function"==typeof e.preMouseDownCallback}));if(i)if(i.preMouseDownCallback(e))return}if(!mt.isMultiPartToolActive){var s=Nh(n,r),l=Bh(n,s,a,"mouse");if(l.length>0){var c=l[0],u=D(n,c.name),d=ar(n,u,c.name,a),h=d.handle,f=d.data;c.handleSelectedCallback(e,f,h,"mouse")}else{var v=r.filter((function(e){var t=D(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some((function(t){return e.pointNearTool(n,t,a,"mouse")}))}));if(v.length>0){var g=v[0],p=D(n,g.name).data.find((function(e){return g.pointNearTool(n,e,a)}));g.toolSelectedCallback(e,p,"mouse")}else if(o.length>0){var m=o.find((function(e){return"function"==typeof e.postMouseDownCallback}));if(m)if(m.postMouseDownCallback(e))return}}}}},Vh=H("eventDispatchers:mouseEventHandlers"),jh=function(e){if(!mt.isToolLocked){var t=e.detail,n=Ea(t.element,t.buttons,"mouse");if(n){if("function"==typeof n.preMouseDownActivateCallback)if(n.preMouseDownActivateCallback(e))return;mt.isMultiPartToolActive||(n.addNewMeasurement?n.addNewMeasurement(e,"mouse"):n instanceof ir&&function(e,t){Vh.log("addNewMeasurement"),e.preventDefault(),e.stopPropagation();var n=e.detail,a=n.element,r=t.createNewMeasurement(n);r&&(_(a,t.name,r),y.cornerstone.updateImage(a),(1===Object.keys(r.handles).length?Fa:Xa)(n,t.name,r,r.handles.end,t.options,"mouse",(function(e){if(!r.cancelled)if(e){var n=b.MEASUREMENT_COMPLETED,o={toolName:t.name,toolType:t.name,element:a,measurementData:r};I(a,n,o)}else L(a,t.name,r)})))}(e,n))}}},qh=function(e){if(!mt.isToolLocked){var t,n=e.detail,a=n.element;if(t=(t=(t=ya(a,yt.mouseTools())).filter((function(e){return Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.includes(n.buttons)&&e.options.isMouseActive}))).filter((function(e){return"function"==typeof e.mouseDragCallback})),mt.isMultiPartToolActive&&(t=Ca(t)),0!==t.length)t[0].mouseDragCallback(e)}},zh=function(e){if(!mt.isToolLocked&&!mt.isMultiPartToolActive){var t,n=e.detail,a=n.element,r=n.currentPoints;mt.mousePositionImage=r.image;var o=(t=Hh(a,yt.mouseTools())).filter((function(e){return"active"===e.mode&&e.options.isMouseActive})),i=!1;o.length>0&&(i=o.some((function(e){return e.updateOnMouseMove}))),t=Nh(a,t);for(var s=0;s<t.length;s++){var l=t[s];"function"==typeof l.mouseMoveCallback&&(i=l.mouseMoveCallback(e)||i)}!0===i&&y.cornerstone.updateImage(a)}},Gh=Uh.bind(null,"Mouse","mouseClickCallback"),Wh=Uh.bind(null,"Mouse","doubleClickCallback"),Jh=Uh.bind(null,"Mouse","mouseUpCallback"),Yh=Uh.bind(null,"MouseWheel","mouseWheelCallback"),Kh=function(e){e.addEventListener(b.MOUSE_CLICK,Gh),e.addEventListener(b.MOUSE_DOWN,Fh),e.addEventListener(b.MOUSE_DOWN_ACTIVATE,jh),e.addEventListener(b.MOUSE_DOUBLE_CLICK,Wh),e.addEventListener(b.MOUSE_DRAG,qh),e.addEventListener(b.MOUSE_MOVE,zh),e.addEventListener(b.MOUSE_UP,Jh),e.addEventListener(b.MOUSE_WHEEL,Yh)},Xh=function(e){e.removeEventListener(b.MOUSE_CLICK,Gh),e.removeEventListener(b.MOUSE_DOWN,Fh),e.removeEventListener(b.MOUSE_DOWN_ACTIVATE,jh),e.removeEventListener(b.MOUSE_DOUBLE_CLICK,Wh),e.removeEventListener(b.MOUSE_DRAG,qh),e.removeEventListener(b.MOUSE_MOVE,zh),e.removeEventListener(b.MOUSE_UP,Jh),e.removeEventListener(b.MOUSE_WHEEL,Yh)},Zh=function(e){if(mt.isToolLocked)return!1;var t=e.detail.element,n=mt.tools.filter((function(e){return e.element===t&&("active"===e.mode||"passive"===e.mode||"enabled"===e.mode)}));if(0===n.length)return!1;n.forEach((function(t){t.newImageCallback&&t.newImageCallback(e)}))},Qh=function(e){e.addEventListener(y.cornerstone.EVENTS.NEW_IMAGE,Zh)},$h=function(e){e.removeEventListener(y.cornerstone.EVENTS.NEW_IMAGE,Zh)},ef=function(e){if(mt.isToolLocked)return!1;var t=e.detail,n=t.element,a=t.numPointers,r=mt.tools.filter((function(e){return e.supportedInteractionTypes.includes("MultiTouch")}));if(r=(r=ya(n,r,"MultiTouch")).filter((function(e){return"function"==typeof e.multiTouchDragCallback&&a===e.configuration.touchPointers})),mt.isMultiPartToolActive&&(r=Ca(r)),0===r.length)return!1;r[0].multiTouchDragCallback(e)},tf=H("eventDispatchers:touchEventHandlers"),nf=function(e){if(!mt.isToolLocked&&!mt.isMultiPartToolActive){var t=Ea(e.detail.element,null,"touch");t&&t.addNewMeasurement?t.addNewMeasurement(e,"touch"):t instanceof ir&&function(e,t){tf.log("addNewMeasurement"),e.preventDefault(),e.stopPropagation();var n=e.detail,a=n.element,r=t.createNewMeasurement(n);if(r){if(_(a,t.name,r),1===Object.keys(r.handles).length&&n.type===b.TAP)return r.active=!1,r.handles.end.active=!1,r.handles.end.highlight=!1,r.invalidated=!0,(mt.deleteIfHandleOutsideImage||t.options.deleteIfHandleOutsideImage)&&va(n,r.handles)&&L(a,t.name,r),void y.cornerstone.updateImage(a);y.cornerstone.updateImage(a),Xa(n,t.name,r,r.handles.end,t.options,"touch",(function(){var e=b.MEASUREMENT_COMPLETED,n={toolName:t.name,toolType:t.name,element:a,measurementData:r};I(a,e,n)}))}}(e,t)}},af=function(e){if(e)for(var t=0;t<e.data.length;t++){var n=e.data[t];n.active=!1,n.handles&&rf(n.handles)}};function rf(e){Object.keys(e).forEach((function(t){e[t].active=!1}))}var of=function(e){if(!mt.isToolLocked&&!mt.isMultiPartToolActive){var t,n=e.detail.element,a=e.detail.currentPoints.canvas;t=ya(n,yt.touchTools());var r=(t=Nh(n,t)).filter((function(e){for(var t=D(n,e.name),r=0;r<t.data.length;r++)if(void 0!==ha(n,t.data[r].handles,a,28))return!0;return!1}));if(r.length>0){var o=r[0],i=D(n,o.name),s=i.data.find((function(e){return void 0!==ha(n,e.handles,a,28)}));return i.data.active=!0,s.active=!0,y.cornerstone.updateImage(n),Fa(e.detail,o.name,i.data,s,o.options,"touch",(function(){return af(i)})),e.stopImmediatePropagation(),void e.preventDefault()}var l=t.filter((function(e){var t=D(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some((function(t){return e.pointNearTool(n,t,a)}))}));if(l.length>0){var c=l[0],u=D(n,c.name),d=u.data.find((function(e){return c.pointNearTool(n,e,a)}));return d.active=!0,y.cornerstone.updateImage(n),Pa(e.detail,c.name,d,null,c.options,"touch",(function(){return af(u)})),e.stopImmediatePropagation(),void e.preventDefault()}var h=ya(n,yt.touchTools());return h.length>0&&h[0].touchStartActiveCallback?h[0].touchStartActiveCallback(e):nf(e),!1}},sf=function(e){if(!mt.isToolLocked){var t=e.detail,n=t.element,a=t.startPoints.canvas,r=Hh(n,yt.touchTools()),o=r.filter((function(e){return"active"===e.mode&&e.options.isTouchActive}));if(mt.isMultiPartToolActive&&(o=Ca(o)),o.length>0){var i=o.find((function(e){return"function"==typeof e.preTouchStartCallback}));if(i)if(i.preTouchStartCallback(e))return}if(!mt.isMultiPartToolActive){var s=Nh(n,r),l=Bh(n,s,a,"touch");if(l.length>0){var c=l[0],u=D(n,c.name),d=ar(n,u,c.name,a,"touch"),h=d.handle,f=d.data;c.handleSelectedCallback(e,f,h,"touch")}else{var v=s.filter((function(e){var t=D(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some((function(t){return e.pointNearTool(n,t,a,"touch")}))}));if(v.length>0){var g=v[0],p=D(n,g.name).data.find((function(e){return g.pointNearTool(n,e,a)}));g.toolSelectedCallback(e,p,"touch")}else if(o.length>0){var m=o.find((function(e){return"function"==typeof e.postTouchStartCallback}));if(m)if(m.postTouchStartCallback(e))return}}}}},lf=Uh.bind(null,"DoubleTap","doubleTapCallback"),cf=Uh.bind(null,"Touch","touchDragCallback"),uf=Uh.bind(null,"Touch","touchEndCallback"),df=Uh.bind(null,"TouchPinch","touchPinchCallback"),hf=Uh.bind(null,"Touch","touchPressCallback"),ff=Uh.bind(null,"TouchRotate","touchRotateCallback"),vf=function(e){e.addEventListener(b.TAP,of),e.addEventListener(b.TOUCH_START,sf,{passive:!1}),e.addEventListener(b.TOUCH_DRAG,cf,{passive:!1}),e.addEventListener(b.TOUCH_END,uf),e.addEventListener(b.TOUCH_START_ACTIVE,nf),e.addEventListener(b.TOUCH_PRESS,hf),e.addEventListener(b.DOUBLE_TAP,lf),e.addEventListener(b.TOUCH_PINCH,df),e.addEventListener(b.TOUCH_ROTATE,ff),e.addEventListener(b.MULTI_TOUCH_DRAG,ef)},gf=function(e){e.removeEventListener(b.TAP,of),e.removeEventListener(b.TOUCH_START,sf),e.removeEventListener(b.TOUCH_DRAG,cf),e.removeEventListener(b.TOUCH_END,uf),e.removeEventListener(b.TOUCH_START_ACTIVE,nf),e.removeEventListener(b.TOUCH_PRESS,hf),e.removeEventListener(b.DOUBLE_TAP,lf),e.removeEventListener(b.TOUCH_PINCH,df),e.removeEventListener(b.TOUCH_ROTATE,ff),e.removeEventListener(b.MULTI_TOUCH_DRAG,ef)},pf=H("addTool"),mf=function(e,t,n){var a=new t(n);It(e,a.name)?pf.warn("%s has already been added to the target element",a.name):(a.element=e,bt.state.tools.push(a))},yf=function(e,t){xf(e,t),bt.state.enabledElements.forEach((function(n){mf(n,e,t)}))},xf=function(e,t){if(Tt("globalConfiguration").configuration.globalToolSyncEnabled){var n=new e(t);void 0!==bt.state.globalTools[n.name]?pf.warn("%s has already been added globally",n.name):bt.state.globalTools[n.name]={tool:e,props:t,activeBindings:[]}}},Tf=H("internals:addEnabledElement"),bf=function(e){Tf.log("EVENT:ELEMENT_ENABLED");var t=e.detail.element;Ah(t),Qh(t);var n=Tt("globalConfiguration").configuration;n.mouseEnabled&&(Ud.enable(t),Vd.enable(t),Kh(t)),n.touchEnabled&&(vh.enable(t),vf(t)),If(t)},If=function(e){bt.state.enabledElements.push(e),bt.modules&&function(e){var t=bt.modules;Object.keys(t).forEach((function(n){"function"==typeof t[n].enabledElementCallback&&t[n].enabledElementCallback(e)}))}(e),function(e){if(!Tt("globalConfiguration").configuration.globalToolSyncEnabled)return;Object.keys(bt.state.globalTools).forEach((function(t){var n=bt.state.globalTools[t],a=n.tool,r=n.props;mf(e,a,r)}))}(e),function(e){if(!Tt("globalConfiguration").configuration.globalToolSyncEnabled)return;var t={active:Ot,passive:Rt,enabled:Lt,disabled:_t};bt.state.globalToolChangeHistory.forEach((function(n){var a=n.args.slice(0);a.unshift(e),t[n.mode].apply(null,a)}))}(e)};var wf=H("internals:removeEnabledElement"),Cf=function(e){wf.log("EVENT:ELEMENT_DISABLED");var t=e.detail.element,n=Tt("globalConfiguration").configuration;Rh(t),$h(t),n.mouseEnabled&&(Ud.disable(t),Vd.disable(t),Xh(t)),n.touchEnabled&&(vh.disable(t),gf(t)),Ef(t),Mf(t),kf(t)},Ef=function(e){bt.state.tools.forEach((function(t){t.element===e&&_t(t.element,t.name)})),bt.state.tools=bt.state.tools.filter((function(t){return t.element!==e}))},Mf=function(e){bt.modules&&function(e){var t=bt.modules;Object.keys(t).forEach((function(n){"function"==typeof t[n].removeEnabledElementCallback&&t[n].removeEnabledElementCallback(e)}))}(e);var t=bt.state.enabledElements.findIndex((function(t){return t===e}));t>-1?bt.state.enabledElements.splice(t,1):wf.warn("unable to remove element")},kf=function(e){Zc.removeHandlers(e)};var Sf,Of=function(){window.removeEventListener("resize",Pf,!1)};function Pf(){Sf||(Sf=setTimeout((function(){Sf=null,_f()}),66))}var _f=function(){mt.enabledElements.forEach((function(e){y.cornerstone.resize(e)}))},Df=function(){Of(),window.addEventListener("resize",Pf,!1)},Lf=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Af(),Rf();var t=Tt("globalConfiguration");Array.isArray(e)?e.forEach((function(e){var t=e.moduleName,n=e.configuration,a=Tt(t);a&&(a.configuration=Object.assign({},a.configuration,n))})):t.configuration=Object.assign({},t.configuration,e),t.configuration.autoResizeViewports&&Df()};function Af(){!function(){var e=y.cornerstone,t=e.EVENTS.ELEMENT_ENABLED,n=e.EVENTS.ELEMENT_DISABLED;e.events.removeEventListener(t,bf),e.events.removeEventListener(n,Cf)}();var e=y.cornerstone,t=e.EVENTS.ELEMENT_ENABLED,n=e.EVENTS.ELEMENT_DISABLED;e.events.addEventListener(t,bf),e.events.addEventListener(n,Cf)}function Rf(){var e=bt.modules;Object.keys(e).forEach((function(t){"function"==typeof e[t].onRegisterCallback&&e[t].onRegisterCallback()}))}var Uf,Bf=H("stackTools:stackPrefetch"),Hf={maxImagesToPrefetch:1/0,preserveExistingPool:!1};function Nf(e,t){e=Math.round(e)||0;var n=[],a=(t=Math.round(t)||0)-e+1;if(a<=0)return n;for(;a--;)n[a]=t--;return n}var Ff=function(e){return Math.max.apply(null,e)},Vf=function(e){return Math.min.apply(null,e)};function jf(e){var t=D(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0],a=D(e,"stackPrefetch");if(a){var r=a.data[0]||{};if(r.indicesToRequest&&r.indicesToRequest.length||(r.enabled=!1),!1!==r.enabled)if(a.data[0].indicesToRequest.sort((function(e,t){return e-t})),r.indicesToRequest.slice().forEach((function(e){var t=n.imageIds[e];t&&(y.cornerstone.imageCache.getImageLoadObject(t)&&C(e))})),r.indicesToRequest.length){Hf.preserveExistingPool||$u.clearRequestStack("prefetch");for(var o,i,s=function(e,t){var n=[],a=[];return e.forEach((function(e){e<t?n.push(e):e>t&&a.push(e)})),{low:e.indexOf(Ff(n)),high:e.indexOf(Vf(a))}}(r.indicesToRequest,n.currentImageIdIndex),l=Zc.getErrorLoadingHandler(e),c=s.low,u=s.high,d=[];c>=0||u<r.indicesToRequest.length;){var h=n.currentImageIdIndex,f=!(h-r.indicesToRequest[c]>Hf.maxImagesToPrefetch)&&c>=0,v=!(r.indicesToRequest[u]-h>Hf.maxImagesToPrefetch)&&u<r.indicesToRequest.length;if(!v&&!f)break;f&&(i=r.indicesToRequest[c--],o=n.imageIds[i],d.push(o)),v&&(i=r.indicesToRequest[u++],o=n.imageIds[i],d.push(o))}var g=!0,p=!1,m=void 0;try{for(var x,T=d.reverse()[Symbol.iterator]();!(g=(x=T.next()).done);g=!0){var w=x.value;$u.addRequest(e,w,"prefetch",!1,E,M,!0)}}catch(e){p=!0,m=e}finally{try{g||null==T.return||T.return()}finally{if(p)throw m}}$u.startGrabbing()}}}function C(e){var t=r.indicesToRequest.indexOf(e);t>-1&&r.indicesToRequest.splice(t,1)}function E(t){Bf.log("prefetch done: %s",t.imageId);var a=n.imageIds.indexOf(t.imageId);C(a),I(e,b.STACK_PREFETCH_IMAGE_LOADED,{element:e,imageId:t.imageId,imageIndex:a,stackPrefetch:r,stack:n}),r.indicesToRequest&&r.indicesToRequest.length>0||I(e,b.STACK_PREFETCH_DONE,{element:e,stackPrefetch:r,stack:n})}function M(t){Bf.log("prefetch errored: %o",t),l&&l(e,o,t,"stackPrefetch")}}function qf(e){return function(t){var n,a=t.detail;try{n=D(e,"stack")}catch(e){return}if(n&&n.data&&n.data.length){var r=n.data[0].imageIds.indexOf(a.imageId);if(!(r<0)){var o=D(e,"stackPrefetch");o&&o.data&&o.data.length&&o.data[0].indicesToRequest.push(r)}}}}function zf(e){clearTimeout(Uf),Uf=setTimeout((function(){var t=e.target;try{jf(t)}catch(e){return}}),10)}var Gf={enable:function(e){D(e,"stackPrefetch").data=[];var t=D(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];if(!0!==n.preventCache){var a={indicesToRequest:Nf(0,n.imageIds.length-1),enabled:!0,direction:1},r=a.indicesToRequest.indexOf(n.currentImageIdIndex);a.indicesToRequest.splice(r,1),_(e,"stackPrefetch",a),jf(e),e.removeEventListener(y.cornerstone.EVENTS.NEW_IMAGE,zf),e.addEventListener(y.cornerstone.EVENTS.NEW_IMAGE,zf);var o=qf(e);y.cornerstone.events.removeEventListener(y.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,o),y.cornerstone.events.addEventListener(y.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,o)}else Bf.warn("A stack that should not be cached was given the stackPrefetch")}},disable:function(e){clearTimeout(Uf),e.removeEventListener(y.cornerstone.EVENTS.NEW_IMAGE,zf);var t=qf(e);y.cornerstone.events.removeEventListener(y.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,t);var n=D(e,"stackPrefetch");n&&n.data.length&&(n.data[0].enabled=!1,$u.clearRequestStack("prefetch"))},getConfiguration:function(){return Hf},setConfiguration:function(e){var t;Hf=e,e.maxSimultaneousRequests&&(t=e.maxSimultaneousRequests,Au=t)}},Wf=function(){function e(){i()(this,e),this.currentImageIdIndex=0,this.layerIds=[],this.findImageFn=void 0}return l()(e,[{key:"render",value:function(e,t){var n=this;if(!Number.isInteger(this.currentImageIdIndex))throw new Error("FusionRenderer: render - Image ID Index is not an integer");if(!this.findImageFn)throw new Error("No findImage function has been defined");t||(t=D(e,"stack").data);var a=y.cornerstone,r=t[0],o=r.imageIds[this.currentImageIdIndex],i=t.slice(1,t.length);a.loadAndCacheImage(o).then((function(t){var s=n.layerIds[0];s?a.setLayerImage(e,t,s):(s=a.addLayer(e,t,r.options),n.layerIds.push(s)),a.displayImage(e,t),i.forEach((function(t,r){var i=n.findImageFn(t.imageIds,o),l=r+1,c=n.layerIds[l];c||(c=a.addLayer(e,void 0,t.options),n.layerIds.push(c)),i?a.loadAndCacheImage(i).then((function(t){a.setLayerImage(e,t,c),a.updateImage(e)})):(a.setLayerImage(e,void 0,c),a.setActiveLayer(e,s),a.updateImage(e))}))}))}}]),e}(),Jf={};Jf.FusionRenderer=Wf;var Yf=Jf;function Kf(e){var t=e.intervalId;void 0!==t&&(e.intervalId=void 0,e.usingFrameTimeVector?clearTimeout(t):clearInterval(t))}function Xf(e,t){var n,a;if(void 0===e)throw new Error("playClip: element must not be undefined");var r=D(e,"stack");if(r&&r.data&&r.data.length){var o,i=y.cornerstone;if(r.data.length>1){var s=D(e,"stackRenderer");s&&s.data&&s.data.length&&(o=s.data[0])}var l=r.data[0],c=D(e,"playClip");c&&c.data&&c.data.length?Kf(n=c.data[0]):_(e,"playClip",n={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,frameRate:0,frameTimeVector:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,speed:1,reverse:!1,loop:!0}),(t<0||t>0)&&(n.framesPerSecond=Number(t),n.reverse=n.framesPerSecond<0,n.ignoreFrameTimeVector=!0),!0!==n.ignoreFrameTimeVector&&n.frameTimeVector&&n.frameTimeVector.length===l.imageIds.length&&(a=function(e,t){var n,a,r,o=0,i=e.length,s=[];for(s.isTimeVarying=!1,("number"!=typeof t||t<=0)&&(t=1),n=1;n<i;n++)r=Number(e[n])/t|0,s.push(r),1===n?a=r:r!==a&&(s.isTimeVarying=!0),o+=r;return s.length>0&&(r=s.isTimeVarying?o/s.length|0:s[0],s.push(r)),s}(n.frameTimeVector,n.speed));var u=function(){var t,a,s,c=l.currentImageIdIndex,u=l.imageIds.length;if(n.reverse?c--:c++,!n.loop&&(c<0||c>=u))return Kf(n),void function(e){I(e,b.CLIP_STOPPED,{element:e})}(e);c>=u&&(c=0),c<0&&(c=u-1),c!==l.currentImageIdIndex&&(t=Zc.getStartLoadHandler(e),a=Zc.getEndLoadHandler(e),s=Zc.getErrorLoadingHandler(e),t&&t(e),(!0===l.preventCache?i.loadImage(l.imageIds[c]):i.loadAndCacheImage(l.imageIds[c])).then((function(t){try{l.currentImageIdIndex=c,o?(o.currentImageIdIndex=c,o.render(e,r.data)):i.displayImage(e,t),a&&a(e,t)}catch(e){return}}),(function(t){var n=l.imageIds[c];s&&s(e,n,t)})))};a&&a.length>0&&a.isTimeVarying?(n.usingFrameTimeVector=!0,n.intervalId=setTimeout((function e(){n.intervalId=setTimeout(e,a[l.currentImageIdIndex]),u()}),0)):(n.usingFrameTimeVector=!1,n.intervalId=setInterval(u,1e3/Math.abs(n.framesPerSecond)))}}function Zf(e){var t=D(e,"playClip");t&&t.data&&t.data.length&&Kf(t.data[0])}var Qf=function(e,t){var n=bt.state.tools.findIndex((function(n){return n.element===e&&n.name===t}));n>=0&&bt.state.tools.splice(n,1)},$f=function(e){ev(e),bt.state.enabledElements.forEach((function(t){Qf(t,e)}))},ev=function(e){Tt("globalConfiguration").configuration.globalToolSyncEnabled&&bt.state.globalTools[e]&&delete bt.state.globalTools[e]},tv=function(e,t,n){var a=It(e,t);a&&a.mergeOptions(n)},nv=function(e,t){mt.enabledElements.forEach((function(n){tv(n,e,t)}))};function av(e,t){var n={};return{get:function(a,r){return e.indexOf(r)>=0?(!1===n.hasOwnProperty(r)&&(n[r]={data:[]}),n[r]):t.get(a,r)},add:function(a,r,o){if(!(e.indexOf(r)>=0))return t.add(a,r,o);!1===n.hasOwnProperty(r)&&(n[r]={data:[]}),n[r].data.push(o)},saveToolState:function(){return n},restoreToolState:function(e){n=e},toolState:n}}var rv=[];function ov(e,t){var n=P(e);n||(n=O);var a=["stack","stackPrefetch","playClip","volume","slab","referenceLines","crosshairs","stackRenderer"];t&&(a=a.concat(t));var r=av(a,n);rv.push(r),R(e,r)}var iv={newStackSpecificToolStateManager:av,addStackStateManager:ov};function sv(){var e={};return{get:function(t,n){if(!1!==e.hasOwnProperty(t)){var a=e[t];if(!1!==a.hasOwnProperty(n))return a[n]}},add:function(t,n,a){!1===e.hasOwnProperty(t)&&(e[t]={});var r=e[t];!1===r.hasOwnProperty(n)&&(r[n]={data:[]}),r[n].data.push(a)},remove:function(t,n,a){if(!1!==e.hasOwnProperty(t)){var r=e[t];if(!1!==r.hasOwnProperty(n)){for(var o=r[n],i=-1,s=0;s<o.data.length;s++)o.data[s]===a&&(i=s);-1!==i&&o.data.splice(i,1)}}}}}var lv=sv(),cv=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",a=e.querySelector("canvas");if(a.msToBlob){var r=a.msToBlob();return window.navigator.msSaveBlob(r,t)}var o=document.createElement("a");if(o.download=t,o.href=a.toDataURL(n,1),document.createEvent){var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),o.dispatchEvent(i)}else o.fireEvent&&o.fireEvent("onclick")},uv=H("thirdParty:registerModule"),dv=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=hv(e);!a||n?(a&&uv.warn("Overwriting module %s",e),xt[e]=t,"function"==typeof xt[e].onRegisterCallback&&xt[e].onRegisterCallback()):uv.warn("A module with the name %s is already registered",e)};function hv(e){return void 0!==xt[e]}var fv={"base/BaseTool":ca,"base/BaseAnnotationTool":ir,"base/BaseBrushTool":wa,"tools/cursors/MouseCursor":ur,"tools/cursors":r,"manipulators/anyHandlesOutsideImage":va,"manipulators/getHandleNearImagePoint":ha,"manipulators/handleActivator":fa,"manipulators/moveAllHandles":Pa,"manipulators/moveHandle":Fa,"manipulators/moveNewHandle":Xa,"manipulators/moveHandleNearImagePoint":nr,"manipulators/findHandleDataNearImagePoint":ar,"manipulators/moveAnnotation":rr,"mixins/activeOrDisabledBinaryTool":ea.activeOrDisabledBinaryTool,"mixins/enabledOrDisabledBinaryTool":ea.enabledOrDisabledBinaryTool,"drawing/getNewContext":Cn,"drawing/draw":Gt,"drawing/path":Kt,"drawing/setShadow":Mn,"drawing/drawLine":Xt,"drawing/drawLines":hn,"drawing/drawJoinedLines":Zt,"drawing/drawCircle":$t,"drawing/drawEllipse":on,"drawing/drawRect":wn,"drawing/fillOutsideRect":function(e,t,n,a,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";if("pixel"===o){var i=y.cornerstone;n=i.pixelToCanvas(t,n),a=i.pixelToCanvas(t,a)}var s=Math.min(n.x,a.x),l=Math.min(n.y,a.y),c=Math.abs(n.x-a.x),u=Math.abs(n.y-a.y);Kt(e,r,(function(e){e.rect(0,0,e.canvas.clientWidth,e.canvas.clientHeight),e.rect(s+c,l,-c,u)}))},"drawing/drawTextBox":bn,"drawing/drawArrow":Qt,"drawing/fillBox":xn,"drawing/fillTextLines":yn,"drawing/drawLink":fn,"drawing/drawLinkedTextBox":In,"drawing/drawHandles":dn,"drawing/textBoxWidth":Tn,"util/getLuminance":id,"util/getROITextBoxCoords":Xo,"util/copyPoints":Ed,"util/calculateSUV":Go,"util/setContextToDisplayFontSize":function(e,t,n){return y.cornerstone.setToPixelCoordinateSystem(e,t,.1),{fontSize:n/e.viewport.scale/.1,lineHeight:n/e.viewport.scale/.1,fontScale:.1}},"util/scrollToIndex":ed,"util/scroll":td,"util/roundToDecimal":lr,"util/projectPatientPointToImagePlane":tn,"util/imagePointToPatientPoint":nn,"util/planePlaneIntersection":an,"util/pointInsideBoundingBox":ua,"util/makeUnselectable":function(e,t){e.style.webkitUserSelect="none",e.style.webkitTouchCallout="none",e.style.mozUserSelect="none",e.style.msUserSelect="none",e.style.oUserSelect="none",e.style.khtmlUserSelect="none",e.style.userSelect="none",e.unselectable="on",e.oncontextmenu=function(){return!1},!0===t&&(e.style.pointerEvents="none")},"util/getRGBPixels":Ui,"util/getDefaultSimultaneousRequests":zu,"util/getMaxSimultaneousRequests":qu,"util/getBrowserInfo":ju,"util/isMobileDevice":function(){return new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini").test(navigator.userAgent)},"util/angleBetweenPoints":Ou,"util/numbersWithCommas":Zo,"util/lineSegDistance":sr,"util/triggerEvent":I,"util/convertToVector3":en,"util/clip":ga,"util/clipToBox":pa,"util/debounce":Qr,"util/deepmerge":ia,"util/getDefault":En,"util/getPixelSpacing":Xr,"util/isEmptyObject":kn,"util/isObject":Zr,"util/isPointInImage":We,"util/isPointInPolygon":as,"util/getLogger":H,"util/throttle":$r,"util/wait":Eu,"util/waitForEnabledElementImageToLoad":Mu,"util/getKeyPressData":function(e){var t=y.cornerstone,n=e.currentTarget,a=t.getEnabledElement(n);if(a&&a.image){var r=bt.state.mousePositionImage;return{event:window.event||e,element:n,viewport:t.getViewport(n),image:a.image,currentPoints:{image:r,canvas:t.pixelToCanvas(n,r)},keyCode:e.keyCode,which:e.which}}},"util/ellipseUtils":Ko,"util/freehandUtils":Ei,"util/segmentationUtils":a,"util/zoomUtils":vd},vv=H("thirdParty:registerMixin"),gv=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=pv(e);!a||n?(a&&vv.warn("Overwriting mixins/%s",e),ea[e]=t,fv["mixins/".concat(e)]=ea[e]):vv.warn("mixins/%s is already registered",e)};function pv(e){return void 0!==ea[e]}var mv=H("thirdParty:registerType"),yv=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r="".concat(e,"/").concat(t),o=xv(r);!o||a?(o&&mv.warn("Overwriting %s",r),fv[r]=n):mv.warn("%s is already registered",r)};function xv(e){return void 0!==fv[e]}var Tv=H("thirdParty:register"),bv=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Iv(e,t,n))switch(e){case"module":dv(t,n,a);break;case"mixin":gv(t,n,a);break;default:yv(e,t,n,a)}};function Iv(e,t,n){return e?t?"object"===T()(n)||"function"==typeof n||(Tv.warn("The %s is a %s, it should be an Object or a function.",n,T()(n)),!1):(Tv.warn("The %s must have a name in order to register.",e),!1):(Tv.warn("The type must be given in order to register."),!1)}var wv=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.forEach((function(e){var n=e.type,a=e.name,r=e.item;bv(n,a,r,t)}))},Cv=function(e,t,n){if(n!==t){var a=y.cornerstone,r=a.getViewport(t),o=a.getViewport(n);o.voi.windowWidth===r.voi.windowWidth&&o.voi.windowCenter===r.voi.windowCenter&&o.invert===r.invert||(o.voi.windowWidth=r.voi.windowWidth,o.voi.windowCenter=r.voi.windowCenter,o.invert=r.invert,e.setViewport(n,o))}},Ev=function(e,t,n){n!==t&&y.cornerstone.updateImage(n)};function Mv(e){return e.filter((function(e,t,n){return n.indexOf(e)===t}))}var kv=function(e,t){y.cornerstone;var n=this,a=[],r=[],o=!1,i={},s=t;function l(e){var t=e.detail.element;n.remove(t),function(e){for(var t in Qc)Qc[t]=Qc[t].filter((function(t){return t.element!==e}))}(t)}this.enabled=!0,this.setHandler=function(e){s=e},this.getHandler=function(){return s},this.getDistances=function(){if(a.length&&r.length){var e=y.cornerstone;i.distances={},i.imageIds={sourceElements:[],targetElements:[]},a.forEach((function(t){var n=e.getEnabledElement(t);if(n&&n.image){var a=n.image.imageId,o=e.metaData.get("imagePlaneModule",a);if(o&&o.imagePositionPatient){var s=en(o.imagePositionPatient);i.hasOwnProperty(n)||(i.distances[a]={},i.imageIds.sourceElements.push(a),r.forEach((function(n){var r=e.getEnabledElement(n);if(r&&r.image){var o=r.image.imageId;if(i.imageIds.targetElements.push(o),t!==n&&a!==o&&!i.distances[a].hasOwnProperty(o)){var l=e.metaData.get("imagePlaneModule",o);if(l&&l.imagePositionPatient){var c=en(l.imagePositionPatient);i.distances[a][o]=c.clone().sub(s)}}}})),Object.keys(i.distances[a]).length||delete i.distances[a])}}}))}},this.fireEvent=function(e,t){var l=!n.enabled,c=!a.length||!r.length;l||c||(o=!0,r.forEach((function(o){var l=r.indexOf(o);if(-1!==l){var c=i.imageIds.targetElements[l],u=a.indexOf(e);if(-1!==u){var d,h=i.imageIds.sourceElements[u];h===c?d=0:void 0!==i.distances[h]&&(d=i.distances[h][c]),s(n,e,o,t,d)}}})),o=!1)},this.onEvent=function(e){var t=e.detail;!0!==o&&n.fireEvent(e.currentTarget,t)},this.addSource=function(t){-1===a.indexOf(t)&&(a.push(t),e.split(" ").forEach((function(e){t.addEventListener(e,n.onEvent)})),n.getDistances(),n.updateDisableHandlers())},this.addTarget=function(e){-1===r.indexOf(e)&&(r.push(e),n.getDistances(),s(n,e,e,0),n.updateDisableHandlers())},this.add=function(e){n.addSource(e),n.addTarget(e)},this.removeSource=function(t){var r=a.indexOf(t);-1!==r&&(a.splice(r,1),e.split(" ").forEach((function(e){t.removeEventListener(e,n.onEvent)})),n.getDistances(),n.fireEvent(t),n.updateDisableHandlers())},this.removeTarget=function(e){var t=r.indexOf(e);-1!==t&&(r.splice(t,1),n.getDistances(),s(n,e,e,0),n.updateDisableHandlers())},this.remove=function(e){n.removeTarget(e),n.removeSource(e)},this.getSourceElements=function(){return a},this.getTargetElements=function(){return r},this.displayImage=function(e,t,n){o=!0,y.cornerstone.displayImage(e,t,n),o=!1},this.setViewport=function(e,t){o=!0,y.cornerstone.setViewport(e,t),o=!1},this.updateDisableHandlers=function(){Mv(a.concat(r)).forEach((function(e){e.removeEventListener(y.cornerstone.EVENTS.ELEMENT_DISABLED,l),e.addEventListener(y.cornerstone.EVENTS.ELEMENT_DISABLED,l)}))},this.destroy=function(){Mv(a.concat(r)).forEach((function(e){n.remove(e)}))}},Sv=function(e,t,n,a){if(t!==n&&a&&a.direction){var r=y.cornerstone,o=D(n,"stack").data[0],i=o.currentImageIdIndex+a.direction;if(i=ma(i,0,o.imageIds.length-1),o.currentImageIdIndex!==i){var s=Zc.getStartLoadHandler(n),l=Zc.getEndLoadHandler(n),c=Zc.getErrorLoadingHandler(n);o.currentImageIdIndex=i;var u=o.imageIds[i];s&&s(n),(!0===o.preventCache?r.loadImage(u):r.loadAndCacheImage(u)).then((function(t){var a=r.getViewport(n);o.currentImageIdIndex===i&&(e.displayImage(n,t,a),l&&l(n,t))}),(function(e){var t=o.imageIds[i];c&&c(n,t,e)}))}}},Ov=function(e,t,n){if(n!==t){var a=y.cornerstone,r=D(t,"stack").data[0],o=r.imageIds[r.currentImageIdIndex],i=a.metaData.get("imagePlaneModule",o);if(void 0!==i&&void 0!==i.imagePositionPatient){var s=en(i.imagePositionPatient),l=D(n,"stack").data[0],c=Number.MAX_VALUE,u=-1;if(l.imageIds.forEach((function(e,t){var n=a.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var r=en(n.imagePositionPatient).distanceToSquared(s);r<c&&(c=r,u=t)}})),u!==l.currentImageIdIndex){var d=Zc.getStartLoadHandler(n),h=Zc.getEndLoadHandler(n),f=Zc.getErrorLoadingHandler(n);l.currentImageIdIndex=u;var v=l.imageIds[u];if(d&&d(n),-1!==u)(!0===l.preventCache?a.loadImage(v):a.loadAndCacheImage(v)).then((function(t){var r=a.getViewport(n);l.currentImageIdIndex===u&&(e.displayImage(n,t,r),h&&h(n,t))}),(function(e){var t=l.imageIds[u];f&&f(n,t,e)}))}}}},Pv=function(e,t,n,a,r){if(n!==t){var o=y.cornerstone,i=D(t,"stack").data[0],s=i.imageIds[i.currentImageIdIndex],l=o.metaData.get("imagePlaneModule",s);if(void 0!==l&&void 0!==l.imagePositionPatient){var c=en(l.imagePositionPatient),u=D(n,"stack").data[0],d=Number.MAX_VALUE,h=-1;if(r){var f=c.clone().add(r);if(u.imageIds.forEach((function(e,t){var n=o.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var a=en(n.imagePositionPatient),r=f.distanceToSquared(a);r<d&&(d=r,h=t)}})),h!==u.currentImageIdIndex&&-1!==h){var v=Zc.getStartLoadHandler(n),g=Zc.getEndLoadHandler(n),p=Zc.getErrorLoadingHandler(n);u.currentImageIdIndex=h;var m=u.imageIds[h];v&&v(n),(!0===u.preventCache?o.loadImage(m):o.loadAndCacheImage(m)).then((function(t){var a=o.getViewport(n);u.currentImageIdIndex===h&&(e.displayImage(n,t,a),g&&g(n,t))}),(function(e){var t=u.imageIds[h];p&&p(n,t,e)}))}}}}},_v=function(e,t,n){if(n!==t){var a=y.cornerstone,r=D(t,"stack").data[0],o=D(n,"stack").data[0],i=r.currentImageIdIndex;if((i=ma(i,0,o.imageIds.length-1))!==o.currentImageIdIndex){var s=Zc.getStartLoadHandler(n),l=Zc.getEndLoadHandler(n),c=Zc.getErrorLoadingHandler(n);s&&s(n),(!0===o.preventCache?a.loadImage(o.imageIds[i]):a.loadAndCacheImage(o.imageIds[i])).then((function(t){var r=a.getViewport(n);o.currentImageIdIndex=i,e.displayImage(n,t,r),l&&l(n,t)}),(function(e){var t=o.imageIds[i];c&&c(n,t,e)}))}}},Dv=function(e,t,n){if(n!==t){var a=y.cornerstone,r=a.getViewport(t),o=a.getViewport(n);o.scale===r.scale&&o.translation.x===r.translation.x&&o.translation.y===r.translation.y||(o.scale=r.scale,o.translation.x=r.translation.x,o.translation.y=r.translation.y,e.setViewport(n,o))}},Lv=function(e){return fv[e]};n.d(t,"AngleTool",(function(){return eo})),n.d(t,"ArrowAnnotateTool",(function(){return ao})),n.d(t,"BidirectionalTool",(function(){return zo})),n.d(t,"CircleRoiTool",(function(){return $o})),n.d(t,"CobbAngleTool",(function(){return ai})),n.d(t,"EllipticalRoiTool",(function(){return oi})),n.d(t,"FreehandRoiTool",(function(){return Di})),n.d(t,"LengthTool",(function(){return Ri})),n.d(t,"ProbeTool",(function(){return Hi})),n.d(t,"RectangleRoiTool",(function(){return Fi})),n.d(t,"TextMarkerTool",(function(){return Gi})),n.d(t,"BrushTool",(function(){return Yi})),n.d(t,"SphericalBrushTool",(function(){return Zi})),n.d(t,"RectangleScissorsTool",(function(){return Os})),n.d(t,"FreehandScissorsTool",(function(){return Ss})),n.d(t,"CircleScissorsTool",(function(){return Ps})),n.d(t,"CorrectionScissorsTool",(function(){return _s})),n.d(t,"InterpolationTool",(function(){return Wc})),n.d(t,"CrosshairsTool",(function(){return tu})),n.d(t,"DoubleTapFitToWindowTool",(function(){return nu})),n.d(t,"DragProbeTool",(function(){return au})),n.d(t,"EraserTool",(function(){return iu})),n.d(t,"FreehandRoiSculptorTool",(function(){return lu})),n.d(t,"MagnifyTool",(function(){return uu})),n.d(t,"OverlayTool",(function(){return du})),n.d(t,"OrientationMarkersTool",(function(){return fu})),n.d(t,"PanMultiTouchTool",(function(){return yu})),n.d(t,"PanTool",(function(){return xu})),n.d(t,"ReferenceLinesTool",(function(){return Su})),n.d(t,"RotateTool",(function(){return Pu})),n.d(t,"RotateTouchTool",(function(){return Ru})),n.d(t,"ScaleOverlayTool",(function(){return Bu})),n.d(t,"StackScrollMouseWheelTool",(function(){return ad})),n.d(t,"StackScrollMultiTouchTool",(function(){return rd})),n.d(t,"StackScrollTool",(function(){return od})),n.d(t,"WwwcRegionTool",(function(){return sd})),n.d(t,"WwwcTool",(function(){return dd})),n.d(t,"ZoomMouseWheelTool",(function(){return gd})),n.d(t,"ZoomTool",(function(){return yd})),n.d(t,"ZoomTouchPinchTool",(function(){return Cd})),n.d(t,"init",(function(){return Lf})),n.d(t,"stackPrefetch",(function(){return Gf})),n.d(t,"stackRenderers",(function(){return Yf})),n.d(t,"playClip",(function(){return Xf})),n.d(t,"stopClip",(function(){return Zf})),n.d(t,"store",(function(){return bt})),n.d(t,"getModule",(function(){return Tt})),n.d(t,"getToolForElement",(function(){return It})),n.d(t,"addTool",(function(){return yf})),n.d(t,"addToolForElement",(function(){return mf})),n.d(t,"removeTool",(function(){return $f})),n.d(t,"removeToolForElement",(function(){return Qf})),n.d(t,"setToolOptions",(function(){return nv})),n.d(t,"setToolOptionsForElement",(function(){return tv})),n.d(t,"isToolActiveForElement",(function(){return ba})),n.d(t,"setToolActive",(function(){return Pt})),n.d(t,"setToolActiveForElement",(function(){return Ot})),n.d(t,"setToolEnabled",(function(){return At})),n.d(t,"setToolEnabledForElement",(function(){return Lt})),n.d(t,"setToolDisabled",(function(){return Dt})),n.d(t,"setToolDisabledForElement",(function(){return _t})),n.d(t,"setToolPassive",(function(){return Ut})),n.d(t,"setToolPassiveForElement",(function(){return Rt})),n.d(t,"addToolState",(function(){return _})),n.d(t,"getToolState",(function(){return D})),n.d(t,"removeToolState",(function(){return L})),n.d(t,"clearToolState",(function(){return A})),n.d(t,"setElementToolStateManager",(function(){return R})),n.d(t,"getElementToolStateManager",(function(){return P})),n.d(t,"textStyle",(function(){return mn})),n.d(t,"toolStyle",(function(){return Yt})),n.d(t,"toolColors",(function(){return un})),n.d(t,"toolCoordinates",(function(){return yo})),n.d(t,"stackSpecificStateManager",(function(){return iv})),n.d(t,"newStackSpecificToolStateManager",(function(){return av})),n.d(t,"addStackStateManager",(function(){return ov})),n.d(t,"loadHandlerManager",(function(){return Zc})),n.d(t,"newImageIdSpecificToolStateManager",(function(){return S})),n.d(t,"globalImageIdSpecificToolStateManager",(function(){return O})),n.d(t,"newFrameOfReferenceSpecificToolStateManager",(function(){return sv})),n.d(t,"globalFrameOfReferenceSpecificToolStateManager",(function(){return lv})),n.d(t,"forceEnabledElementResize",(function(){return _f})),n.d(t,"orientation",(function(){return hu})),n.d(t,"SaveAs",(function(){return cv})),n.d(t,"enableLogger",(function(){return N})),n.d(t,"disableLogger",(function(){return F})),n.d(t,"register",(function(){return bv})),n.d(t,"registerSome",(function(){return wv})),n.d(t,"wwwcSynchronizer",(function(){return Cv})),n.d(t,"updateImageSynchronizer",(function(){return Ev})),n.d(t,"Synchronizer",(function(){return kv})),n.d(t,"stackScrollSynchronizer",(function(){return Sv})),n.d(t,"stackImagePositionSynchronizer",(function(){return Ov})),n.d(t,"stackImagePositionOffsetSynchronizer",(function(){return Pv})),n.d(t,"stackImageIndexSynchronizer",(function(){return _v})),n.d(t,"panZoomSynchronizer",(function(){return Dv})),n.d(t,"requestPoolManager",(function(){return $u})),n.d(t,"importInternal",(function(){return Lv})),n.d(t,"external",(function(){return y})),n.d(t,"EVENTS",(function(){return b})),n.d(t,"version",(function(){return"4.0.1"})),n.d(t,"import",(function(){return Lv}));var Av={AngleTool:eo,ArrowAnnotateTool:ao,BidirectionalTool:zo,CircleRoiTool:$o,CobbAngleTool:ai,EllipticalRoiTool:oi,FreehandRoiTool:Di,LengthTool:Ri,ProbeTool:Hi,RectangleRoiTool:Fi,TextMarkerTool:Gi,BrushTool:Yi,SphericalBrushTool:Zi,RectangleScissorsTool:Os,FreehandScissorsTool:Ss,CircleScissorsTool:Ps,CorrectionScissorsTool:_s,InterpolationTool:Wc,CrosshairsTool:tu,DoubleTapFitToWindowTool:nu,DragProbeTool:au,EraserTool:iu,FreehandRoiSculptorTool:lu,MagnifyTool:uu,OverlayTool:du,OrientationMarkersTool:fu,PanMultiTouchTool:yu,PanTool:xu,ReferenceLinesTool:Su,RotateTool:Pu,RotateTouchTool:Ru,ScaleOverlayTool:Bu,StackScrollMouseWheelTool:ad,StackScrollMultiTouchTool:rd,StackScrollTool:od,WwwcRegionTool:sd,WwwcTool:dd,ZoomMouseWheelTool:gd,ZoomTool:yd,ZoomTouchPinchTool:Cd,init:Lf,stackPrefetch:Gf,stackRenderers:Yf,playClip:Xf,stopClip:Zf,store:bt,getModule:Tt,getToolForElement:It,addTool:yf,addToolForElement:mf,removeTool:$f,removeToolForElement:Qf,setToolOptions:nv,setToolOptionsForElement:tv,isToolActiveForElement:ba,setToolActive:Pt,setToolActiveForElement:Ot,setToolEnabled:At,setToolEnabledForElement:Lt,setToolDisabled:Dt,setToolDisabledForElement:_t,setToolPassive:Ut,setToolPassiveForElement:Rt,addToolState:_,getToolState:D,removeToolState:L,clearToolState:A,setElementToolStateManager:R,getElementToolStateManager:P,textStyle:mn,toolStyle:Yt,toolColors:un,toolCoordinates:yo,stackSpecificStateManager:iv,newStackSpecificToolStateManager:av,addStackStateManager:ov,loadHandlerManager:Zc,newImageIdSpecificToolStateManager:S,globalImageIdSpecificToolStateManager:O,newFrameOfReferenceSpecificToolStateManager:sv,globalFrameOfReferenceSpecificToolStateManager:lv,forceEnabledElementResize:_f,orientation:hu,SaveAs:cv,enableLogger:N,disableLogger:F,importInternal:Lv,import:Lv,register:bv,registerSome:wv,wwwcSynchronizer:Cv,updateImageSynchronizer:Ev,Synchronizer:kv,stackScrollSynchronizer:Sv,stackImagePositionSynchronizer:Ov,stackImagePositionOffsetSynchronizer:Pv,stackImageIndexSynchronizer:_v,panZoomSynchronizer:Dv,requestPoolManager:$u,external:y,EVENTS:b,version:"4.0.1"};t.default=Av}])}));
//# sourceMappingURL=cornerstoneTools.min.js.map